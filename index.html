<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÖŸÜÿµÿ© B2B ŸÑŸÑŸÖŸàÿßÿØ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© - ÿßŸÑÿπÿ±ÿßŸÇ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; }
        
        .header { background: linear-gradient(135deg, #2c5f2d 0%, #97bc62 100%); color: white; padding: 1.5rem 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header.admin { background: linear-gradient(135deg, #1a237e 0%, #3f51b5 100%); }
        .header.buyer { background: linear-gradient(135deg, #1b5e20 0%, #43a047 100%); }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.75; } }
        .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .logo { font-size: 1.8rem; font-weight: bold; display: flex; align-items: center; gap: 0.5rem; }
        .nav-tabs { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .nav-tab { background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.7rem 1.2rem; border-radius: 8px; cursor: pointer; transition: all 0.3s; font-size: 0.95rem; }
        .nav-tab:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }
        .nav-tab.active { background: white; color: #2c5f2d; font-weight: bold; }
        .header.admin .nav-tab.active { color: #1a237e; }
        .badge { background: #ff4444; color: white; border-radius: 50%; padding: 0.2rem 0.5rem; font-size: 0.75rem; margin-right: 0.3rem; }
        .user-info { background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 8px; display: flex; align-items: center; gap: 0.5rem; }
        
        .container { max-width: 1400px; margin: 2rem auto; padding: 0 1rem; }
        .section { background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        
        .search-filter-bar { background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .search-box { display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .search-input { flex: 1; min-width: 250px; padding: 0.8rem 1.2rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .search-input:focus { outline: none; border-color: #2c5f2d; }
        .filter-group { display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; }
        .filter-dropdown { position: relative; }
        .filter-btn { padding: 0.8rem 1.2rem; background: #f5f5f5; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-size: 0.95rem; }
        .filter-btn:hover { background: #e8e8e8; }
        .filter-btn.active { background: #2c5f2d; color: white; border-color: #2c5f2d; }
        .dropdown-menu { position: absolute; top: 100%; right: 0; margin-top: 0.5rem; background: white; border: 2px solid #ddd; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); min-width: 200px; max-height: 300px; overflow-y: auto; z-index: 100; }
        .dropdown-item { padding: 0.8rem 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; }
        .dropdown-item:hover { background: #f5f5f5; }
        .dropdown-item input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
        
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .product-card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: all 0.3s; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.15); }
        .product-image { width: 100%; height: 200px; background: #f5f5f5; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; overflow: hidden; position: relative; }
        .product-name { font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem; color: #333; }
        .product-company { color: #666; font-size: 0.9rem; margin-bottom: 0.5rem; }
        .product-price { font-size: 1.5rem; font-weight: bold; color: #2c5f2d; margin: 1rem 0; }
        .product-badges { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
        .product-badge { padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.85rem; display: inline-block; }
        .badge-success { background: #e8f5e9; color: #2e7d32; }
        .badge-warning { background: #fff3e0; color: #f57c00; }
        .badge-danger { background: #ffebee; color: #c62828; }
        .badge-info { background: #e3f2fd; color: #1976d2; }
        
        .btn { padding: 0.8rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all 0.3s; font-weight: 500; }
        .btn-primary { background: #2c5f2d; color: white; }
        .btn-primary:hover { background: #1e4620; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .btn-secondary { background: #f5f5f5; color: #333; }
        .btn-secondary:hover { background: #e0e0e0; }
        .btn-danger { background: #c62828; color: white; }
        .btn-danger:hover { background: #a02020; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(4px); }
        .modal-box { background: white; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .modal-close { float: left; background: none; border: none; font-size: 2rem; cursor: pointer; color: #999; }
        .modal-close:hover { color: #333; }
        
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #333; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #2c5f2d; }
        
        .image-upload-area { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; border: 3px dashed #ddd; border-radius: 12px; background: #f9f9f9; transition: all 0.3s; cursor: pointer; }
        .image-upload-area:hover { border-color: #2c5f2d; background: #f0f8f0; transform: scale(1.01); }
        .upload-icon { font-size: 3rem; margin-bottom: 0.5rem; }
        .upload-text { font-weight: bold; margin-bottom: 0.3rem; font-size: 1.1rem; color: #333; }
        .upload-hint { font-size: 0.85rem; color: #666; text-align: center; line-height: 1.6; }
        .images-preview-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .preview-image-item { position: relative; border-radius: 8px; overflow: hidden; border: 2px solid #ddd; transition: all 0.3s; background: #f5f5f5; }
        .preview-image-item:hover { border-color: #2c5f2d; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .preview-image-item img { width: 100%; height: 120px; object-fit: cover; display: block; }
        .remove-preview-btn { position: absolute; top: 5px; left: 5px; background: rgba(255, 68, 68, 0.9); color: white; border: none; border-radius: 50%; width: 28px; height: 28px; cursor: pointer; font-size: 1.1rem; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .remove-preview-btn:hover { background: #c62828; transform: scale(1.1); }
        
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid #eee; }
        .quantity-selector { display: flex; align-items: center; gap: 0.5rem; }
        .quantity-btn { width: 30px; height: 30px; border: 2px solid #2c5f2d; background: white; border-radius: 5px; cursor: pointer; font-weight: bold; color: #2c5f2d; }
        .quantity-btn:hover { background: #2c5f2d; color: white; }
        
        .empty-state { text-align: center; padding: 3rem; color: #999; }
        .empty-state-icon { font-size: 4rem; margin-bottom: 1rem; }
        
        .admin-tabs { display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid #eee; padding-bottom: 1rem; flex-wrap: wrap; }
        .admin-tab { padding: 0.7rem 1.5rem; background: #f5f5f5; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .admin-tab:hover { background: #e0e0e0; }
        .admin-tab.active { background: #1a237e; color: white; }
        
        .supplier-card { background: white; padding: 1.5rem; border-radius: 12px; border: 1px solid #ddd; margin-bottom: 1rem; }
        .supplier-card.pending { background: #fff3e0; border-color: #f57c00; }
        .supplier-card.inactive { background: #ffebee; border-color: #c62828; }
        
        .order-status-select { padding: 0.5rem; border: 2px solid #ddd; border-radius: 6px; font-size: 0.9rem; }
        .category-item { background: #f5f5f5; padding: 1rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        
        .scanner-container { position: relative; width: 100%; max-width: 500px; margin: 0 auto; }
        .scanner-video { width: 100%; border-radius: 12px; background: #000; }
        .scanner-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70%; height: 50%; border: 3px solid #4caf50; border-radius: 12px; box-shadow: 0 0 0 9999px rgba(0,0,0,0.5); }
        .scanner-line { position: absolute; width: 100%; height: 2px; background: #4caf50; top: 0; animation: scan 2s linear infinite; }
        @keyframes scan { 0%, 100% { top: 0; } 50% { top: 100%; } }
        .scanner-hint { text-align: center; margin-top: 1rem; color: #666; font-size: 0.9rem; }
        .barcode-result { background: #e8f5e9; padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 2px solid #4caf50; }
        .scan-btn { background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); }
        
        @media (max-width: 768px) {
            .header-content { flex-direction: column; align-items: stretch; }
            .nav-tabs { justify-content: center; }
            .products-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        function ImageSlider({ images, defaultImage }) {
            const [current, setCurrent] = useState(0);
            
            if (!images || images.length === 0) {
                return <div style={{fontSize: '4rem'}}>{defaultImage || 'üì¶'}</div>;
            }
            
            if (images.length === 1) {
                const img = images[0];
                return img && img.startsWith('data:image') ? 
                    <img src={img} alt="ŸÖŸÜÿ™ÿ¨" style={{width: '100%', height: '100%', objectFit: 'cover', borderRadius: '8px'}} /> : 
                    <div style={{fontSize: '4rem'}}>{img || defaultImage || 'üì¶'}</div>;
            }
            
            return (
                <div style={{position: 'relative', width: '100%', height: '100%'}}>
                    {images.map((img, i) => (
                        <div key={i} style={{
                            position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',
                            opacity: i === current ? 1 : 0, transition: 'opacity 0.3s',
                            display: 'flex', alignItems: 'center', justifyContent: 'center'
                        }}>
                            {img && img.startsWith('data:image') ? 
                                <img src={img} alt={`ÿµŸàÿ±ÿ© ${i+1}`} style={{width: '100%', height: '100%', objectFit: 'cover', borderRadius: '8px'}} /> : 
                                <span style={{fontSize: '4rem'}}>{img}</span>
                            }
                        </div>
                    ))}
                    <button onClick={() => setCurrent((current - 1 + images.length) % images.length)} style={{
                        position: 'absolute', top: '50%', right: '5px', transform: 'translateY(-50%)',
                        background: 'rgba(0,0,0,0.5)', color: 'white', border: 'none',
                        width: '30px', height: '30px', borderRadius: '50%', cursor: 'pointer',
                        fontSize: '1.2rem', zIndex: 2
                    }}>‚Äπ</button>
                    <button onClick={() => setCurrent((current + 1) % images.length)} style={{
                        position: 'absolute', top: '50%', left: '5px', transform: 'translateY(-50%)',
                        background: 'rgba(0,0,0,0.5)', color: 'white', border: 'none',
                        width: '30px', height: '30px', borderRadius: '50%', cursor: 'pointer',
                        fontSize: '1.2rem', zIndex: 2
                    }}>‚Ä∫</button>
                    <div style={{
                        position: 'absolute', bottom: '10px', left: '50%', transform: 'translateX(-50%)',
                        display: 'flex', gap: '0.3rem', background: 'rgba(0,0,0,0.5)',
                        padding: '0.3rem 0.5rem', borderRadius: '10px', zIndex: 2
                    }}>
                        {images.map((_, i) => (
                            <button key={i} onClick={() => setCurrent(i)} style={{
                                width: '8px', height: '8px', borderRadius: '50%',
                                background: i === current ? 'white' : 'rgba(255,255,255,0.5)',
                                border: 'none', cursor: 'pointer', padding: 0
                            }} />
                        ))}
                    </div>
                </div>
            );
        }

        function ExpiryBadge({ expiryDate }) {
            if (!expiryDate) return null;
            const today = new Date();
            const expiry = new Date(expiryDate);
            const diffDays = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
            
            let className = 'product-badge ';
            let text = '';
            
            if (diffDays < 0) {
                className += 'badge-danger';
                text = '‚ö†Ô∏è ŸÖŸÜÿ™ŸáŸä ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©';
            } else if (diffDays <= 30) {
                className += 'badge-warning';
                text = `‚è∞ ŸäŸÜÿ™ŸáŸä ÿÆŸÑÿßŸÑ ${diffDays} ŸäŸàŸÖ`;
            } else if (diffDays <= 90) {
                className += 'badge-info';
                text = `üìÖ ${expiry.toLocaleDateString('ar-IQ')}`;
            } else {
                className += 'badge-success';
                text = `‚úì ${expiry.toLocaleDateString('ar-IQ')}`;
            }
            
            return <span className={className}>{text}</span>;
        }

        // ===== Safe Storage - Ÿäÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© Edge Tracking Prevention =====
        // ŸÜÿ≥ÿ™ÿÆÿØŸÖ in-memory + localStorage ŸÖÿπ fallback ŸÉÿßŸÖŸÑ
        const _memStore = {};
        const _storage = {
            getItem: (k) => { try { return localStorage.getItem(k); } catch(e) { return _memStore[k] || null; } },
            setItem: (k, v) => { try { localStorage.setItem(k, v); } catch(e) {} _memStore[k] = v; },
            removeItem: (k) => { try { localStorage.removeItem(k); } catch(e) {} delete _memStore[k]; },
            clear: () => { try { localStorage.clear(); } catch(e) {} Object.keys(_memStore).forEach(k => delete _memStore[k]); }
        };
        const safeStorage = (action, key, value) => {
            if (action === 'get') return _storage.getItem(key);
            if (action === 'set') return _storage.setItem(key, value);
            if (action === 'remove') return _storage.removeItem(key);
            if (action === 'clear') return _storage.clear();
        };
        const safeGetJSON = (key, fallback = null) => {
            try { const v = _storage.getItem(key); return v ? JSON.parse(v) : fallback; } catch(e) { return fallback; }
        };
        const safeSetJSON = (key, value) => {
            try { _storage.setItem(key, JSON.stringify(value)); } catch(e) {}
        };

        function App() {
            const [currentTab, setCurrentTab] = useState('shop');
            const [adminTab, setAdminTab] = useState('suppliers');
            
            const [products, setProducts] = useState(() => {
                return safeGetJSON('products', []);
            });
            
            // ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ™ÿßÿ¨ÿ± (ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸäŸÜ)
            const [buyers, setBuyers] = useState(() => {
                return safeGetJSON('buyers', []);
            });
            const [currentBuyer, setCurrentBuyer] = useState(() => safeGetJSON('currentBuyer', null));
            const [showBuyerAuth, setShowBuyerAuth] = useState(false);
            const [buyerAuthMode, setBuyerAuthMode] = useState('login'); // 'login' | 'register'
            const [buyerAuthData, setBuyerAuthData] = useState({ username: '', password: '', storeName: '', ownerName: '', phone: '' });

            const [cart, setCart] = useState(() => {
                const buyer = safeGetJSON('currentBuyer', null);
                const key = buyer ? 'cart_' + buyer.id : 'cart_guest';
                return safeGetJSON(key, []);
            });
            const [orders, setOrders] = useState(() => {
                return safeGetJSON('orders', []);
            });
            const [archivedOrders, setArchivedOrders] = useState(() => {
                return safeGetJSON('archivedOrders', []);
            });
            const [showArchived, setShowArchived] = useState(false);
            
            const [searchTerm, setSearchTerm] = useState('');
            const [categoryFilter, setCategoryFilter] = useState('ÿßŸÑŸÉŸÑ');
            const [selectedSuppliers, setSelectedSuppliers] = useState([]);
            const [selectedCompanies, setSelectedCompanies] = useState([]);
            const [showSupplierDropdown, setShowSupplierDropdown] = useState(false);
            const [showCompanyDropdown, setShowCompanyDropdown] = useState(false);
            
            const [categories, setCategories] = useState(() => {
                return safeGetJSON('categories', ['ÿßŸÑŸÉŸÑ', 'ÿ≠ÿ®Ÿàÿ®', 'ÿ®ŸÇÿßŸÑÿ©', 'ÿ≤ŸäŸàÿ™', 'ŸÖÿπŸÉÿ±ŸàŸÜÿ©', 'ÿ£ŸÑÿ®ÿßŸÜ']);
            });
            const [newCategory, setNewCategory] = useState('');
            
            const [newProduct, setNewProduct] = useState({ 
                name: '', company: '', category: '', price: '', unit: '', stock: '', expiryDate: '', images: [], imagePreviews: [] 
            });
            const [isEditing, setIsEditing] = useState(false);
            const [editingProductId, setEditingProductId] = useState(null);
            
            const [productQuantities, setProductQuantities] = useState({});
            
            const [currentSupplier, setCurrentSupplier] = useState(() => safeGetJSON('currentSupplier', null));
            const [suppliers, setSuppliers] = useState(() => {
                return safeGetJSON('suppliers', []);
            });
            const [admin, setAdmin] = useState(null);
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [showLogin, setShowLogin] = useState(true);
            const [authData, setAuthData] = useState({ username: '', password: '', companyName: '' });
            
            const [showCheckout, setShowCheckout] = useState(false);
            const [buyerData, setBuyerData] = useState({ 
                storeName: '', 
                ownerName: '', 
                phone: '', 
                address: '', 
                notes: '', 
                deliveryMethod: 'standard',
                latitude: null,
                longitude: null,
                locationAccuracy: null
            });
            const [showOrderDetail, setShowOrderDetail] = useState(false);
            const [selectedOrder, setSelectedOrder] = useState(null);
            const [showSupplierOrders, setShowSupplierOrders] = useState(false);
            const [isGettingLocation, setIsGettingLocation] = useState(false);
            const [selectedSupplier, setSelectedSupplier] = useState(null);
            
            const [showScanner, setShowScanner] = useState(false);
            const [orderSearchTerm, setOrderSearchTerm] = useState('');
            const [supplierOrderSearchTerm, setSupplierOrderSearchTerm] = useState('');
            const [selectedBuyerOrders, setSelectedBuyerOrders] = useState(new Set());
            const [selectedBuyersAdmin, setSelectedBuyersAdmin] = useState(new Set());
            const [buyerSearchAdmin, setBuyerSearchAdmin] = useState('');
            const [scannedBarcode, setScannedBarcode] = useState('');
            const [isScanning, setIsScanning] = useState(false);
            const [scannerError, setScannerError] = useState('');
            const [isUploadingImages, setIsUploadingImages] = useState(false);
            const [uploadProgress, setUploadProgress] = useState(0);
            
            const [deliveryDrivers, setDeliveryDrivers] = useState(() => {
                return safeGetJSON('deliveryDrivers', []);
            });
            const [showTrackingModal, setShowTrackingModal] = useState(false);
            const [trackingNumber, setTrackingNumber] = useState('');
            const [trackingResult, setTrackingResult] = useState(null);
            const [showOrderConfirmation, setShowOrderConfirmation] = useState(false);
            const [confirmedOrders, setConfirmedOrders] = useState([]);
            
            useEffect(() => {
                safeSetJSON('products', products);
            }, [products]);
            
            useEffect(() => {
                const key = currentBuyer ? 'cart_' + currentBuyer.id : 'cart_guest';
                safeSetJSON(key, cart);
            }, [cart, currentBuyer]);
            
            useEffect(() => {
                safeSetJSON('orders', orders);
            }, [orders]);
            
            useEffect(() => {
                safeSetJSON('archivedOrders', archivedOrders);
            }, [archivedOrders]);
            
            useEffect(() => {
                safeSetJSON('categories', categories);
            }, [categories]);
            
            useEffect(() => {
                if (currentSupplier) {
                    safeSetJSON('currentSupplier', currentSupplier);
                }
            }, [currentSupplier]);
            
            useEffect(() => {
                safeSetJSON('deliveryDrivers', deliveryDrivers);
            }, [deliveryDrivers]);
            
            const uniqueSuppliers = [...new Set(products.map(p => {
                const supplier = suppliers.find(s => s.id === p.supplierId);
                return supplier?.companyName || 'ŸÖŸàÿ±ÿØ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';
            }))];
            
            const uniqueCompanies = [...new Set(products.map(p => p.company))];
            
            const filteredProducts = products.filter(p => {
                const matchesSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                    p.company.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = categoryFilter === 'ÿßŸÑŸÉŸÑ' || p.category === categoryFilter;
                
                const supplier = suppliers.find(s => s.id === p.supplierId);
                const supplierName = supplier?.companyName || 'ŸÖŸàÿ±ÿØ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';
                const matchesSupplier = selectedSuppliers.length === 0 || selectedSuppliers.includes(supplierName);
                
                const matchesCompany = selectedCompanies.length === 0 || selectedCompanies.includes(p.company);
                
                return matchesSearch && matchesCategory && matchesSupplier && matchesCompany;
            });
            
            const addToCart = (product) => {
                const qty = productQuantities[product.id] || 1;
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ
                if (product.stock < qty) {
                    alert(`‚ö†Ô∏è ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸç!\nÿßŸÑŸÖÿ™ŸàŸÅÿ±: ${product.stock}`);
                    return;
                }
                
                const existing = cart.find(i => i.id === product.id);
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ ŸÖÿπ ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ© ŸÅŸä ÿßŸÑÿ≥ŸÑÿ©
                if (existing) {
                    const totalQty = existing.qty + qty;
                    if (product.stock < totalQty) {
                        alert(`‚ö†Ô∏è ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸç!\nÿßŸÑŸÖÿ™ŸàŸÅÿ±: ${product.stock}\nŸÅŸä ÿßŸÑÿ≥ŸÑÿ©: ${existing.qty}\nÿ™ÿ≠ÿßŸàŸÑ ÿ•ÿ∂ÿßŸÅÿ©: ${qty}`);
                        return;
                    }
                    setCart(cart.map(i => i.id === product.id ? {...i, qty: totalQty} : i));
                } else {
                    setCart([...cart, {...product, qty}]);
                }
                
                setProductQuantities({...productQuantities, [product.id]: 1});
                alert(`‚úì ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ${qty} ŸÖŸÜ ${product.name} ŸÑŸÑÿ≥ŸÑÿ©`);
            };
            
            const updateCartQty = (id, newQty) => {
                if (newQty < 1) return;
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ
                const product = products.find(p => p.id === id);
                if (product && product.stock < newQty) {
                    alert(`‚ö†Ô∏è ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸç!\nÿßŸÑŸÖÿ™ŸàŸÅÿ±: ${product.stock}`);
                    return;
                }
                
                setCart(cart.map(i => i.id === id ? {...i, qty: newQty} : i));
            };
            
            const removeFromCart = (id) => {
                setCart(cart.filter(i => i.id !== id));
            };
            
            const totalItems = cart.reduce((sum, i) => sum + i.qty, 0);
            const totalAmount = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);
            
            const login = (e) => {
                e.preventDefault();
                if (authData.username === 'admin' && authData.password === 'admin123') {
                    setCurrentSupplier(null);
                    safeStorage('remove', 'currentSupplier');
                    setAdmin({ name: 'ÿßŸÑŸÖÿØŸäÿ±' });
                    setShowAuthModal(false);
                    setCurrentTab('adminPanel');
                    setAuthData({ username: '', password: '', companyName: '' });
                    alert('ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ÿ£ŸäŸáÿß ÿßŸÑŸÖÿØŸäÿ±');
                } else {
                    const found = suppliers.find(s => s.username === authData.username && s.password === authData.password);
                    if (found) {
                        if (found.status === 'pending') {
                            alert('ÿ≠ÿ≥ÿßÿ®ŸÉ ŸÇŸäÿØ ÿßŸÑŸÖÿ±ÿßÿ¨ÿπÿ© ŸÖŸÜ ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿØÿßÿ±ÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±.');
                            return;
                        }
                        if (found.status === 'inactive') {
                            alert('ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ ÿ≠ÿ≥ÿßÿ®ŸÉ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπ ÿßŸÑÿ•ÿØÿßÿ±ÿ©.');
                            return;
                        }
                        setAdmin(null);
                        setCurrentSupplier(found);
                        safeSetJSON('currentSupplier', found);
                        setShowAuthModal(false);
                        setCurrentTab('products');
                        setAuthData({ username: '', password: '', companyName: '' });
                        alert('ŸÖÿ±ÿ≠ÿ®ÿßŸã ' + found.companyName + '\nŸÖÿπÿ±ŸÅ ÿßŸÑŸÖŸàÿ±ÿØ: ' + found.id);
                    } else {
                        alert('ÿ®ŸäÿßŸÜÿßÿ™ ÿÆÿßÿ∑ÿ¶ÿ©');
                    }
                }
            };
            
            const register = (e) => {
                e.preventDefault();
                if (suppliers.find(s => s.username === authData.username)) {
                    alert('ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸàÿ¨ŸàÿØ');
                    return;
                }
                
                // ÿ•ŸÜÿ¥ÿßÿ° ID ŸÅÿ±ŸäÿØ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ timestamp + random
                const uniqueId = Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                
                const newSupplier = { 
                    id: uniqueId,
                    ...authData,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                const updatedSuppliers = [...suppliers, newSupplier];
                safeSetJSON('suppliers', updatedSuppliers);
                setSuppliers(updatedSuppliers);
                setShowAuthModal(false);
                setAuthData({ username: '', password: '', companyName: '' });
                alert('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ!\nÿ≥Ÿäÿ™ŸÖ ŸÖÿ±ÿßÿ¨ÿπÿ™Ÿá ŸÖŸÜ ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿØÿßÿ±ÿ©.\n\nŸÖÿπÿ±ŸÅŸÉ ÿßŸÑŸÅÿ±ŸäÿØ: ' + uniqueId);
            };
            
            const logout = () => {
                setCurrentSupplier(null);
                setAdmin(null);
                safeStorage('remove', 'currentSupplier');
                setCurrentTab('shop');
                alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠');
            };

            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑŸÖÿ™ÿ¨ÿ± (ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä)
            const buyerLogin = (e) => {
                e.preventDefault();
                const found = buyers.find(b => b.username === buyerAuthData.username && b.password === buyerAuthData.password);
                if (!found) { alert('‚ùå ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ£Ÿà ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©'); return; }
                setCurrentBuyer(found);
                safeSetJSON('currentBuyer', found);
                // ÿ™ÿ≠ŸÖŸäŸÑ ÿ≥ŸÑÿ© Ÿáÿ∞ÿß ÿßŸÑŸÖÿ™ÿ¨ÿ±
                setCart(safeGetJSON('cart_' + found.id, []));
                setShowBuyerAuth(false);
                setBuyerAuthData({ username: '', password: '', storeName: '', ownerName: '', phone: '' });
                alert('‚úÖ ÿ£ŸáŸÑÿßŸã ' + found.storeName + '!\nÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿ≥ŸÑÿ™ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠ üõí');
            };

            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ≠ÿ≥ÿßÿ® ŸÖÿ™ÿ¨ÿ± ÿ¨ÿØŸäÿØ
            const buyerRegister = (e) => {
                e.preventDefault();
                if (!buyerAuthData.username || !buyerAuthData.password || !buyerAuthData.storeName) {
                    alert('‚ö†Ô∏è Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                    return;
                }
                if (buyers.find(b => b.username === buyerAuthData.username)) {
                    alert('‚ö†Ô∏è ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã');
                    return;
                }
                const newBuyer = {
                    id: 'buyer_' + Date.now(),
                    username: buyerAuthData.username,
                    password: buyerAuthData.password,
                    storeName: buyerAuthData.storeName,
                    ownerName: buyerAuthData.ownerName,
                    phone: buyerAuthData.phone,
                    createdAt: new Date().toISOString()
                };
                const updated = [...buyers, newBuyer];
                setBuyers(updated);
                safeSetJSON('buyers', updated);
                setCurrentBuyer(newBuyer);
                safeSetJSON('currentBuyer', newBuyer);
                setCart([]);
                setShowBuyerAuth(false);
                setBuyerAuthData({ username: '', password: '', storeName: '', ownerName: '', phone: '' });
                alert('‚úÖ ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠!\nÿ£ŸáŸÑÿßŸã ' + newBuyer.storeName + ' üéâ');
            };

            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨ ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä
            const buyerLogout = () => {
                if (currentBuyer) {
                    safeStorage('set', 'cart_' + currentBuyer.id, JSON.stringify(cart));
                }
                setCurrentBuyer(null);
                safeStorage('remove', 'currentBuyer');
                setCart([]);
                alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨. ÿ≥ŸÑÿ™ŸÉ ŸÖÿ≠ŸÅŸàÿ∏ÿ© ‚úÖ');
            };

            // ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿØŸÅÿπ ŸÖÿπ ŸÖŸÑÿ° ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
            function openCheckout() {
                if (currentBuyer) {
                    setBuyerData(prev => ({
                        ...prev,
                        storeName: prev.storeName || currentBuyer.storeName || '',
                        ownerName: prev.ownerName || currentBuyer.ownerName || '',
                        phone: prev.phone || currentBuyer.phone || ''
                    }));
                }
                setShowCheckout(true);
            }
            
            const handleImageUpload = (e) => {
                const files = Array.from(e.target.files);
                const maxFiles = 10;
                const maxSizePerFile = 10 * 1024 * 1024; // 10MB
                const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif'];
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØÿØ ÿßŸÑÿµŸàÿ±
                if (newProduct.images.length + files.length > maxFiles) {
                    alert(`‚ö†Ô∏è ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑŸÑÿµŸàÿ± ŸáŸà ${maxFiles} ÿµŸàÿ±ÿ©`);
                    return;
                }
                
                setIsUploadingImages(true);
                setUploadProgress(0);
                
                let processedCount = 0;
                let errorMessages = [];
                
                files.forEach((file, index) => {
                    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÜŸàÿπ ÿßŸÑŸÖŸÑŸÅ
                    if (!allowedTypes.includes(file.type)) {
                        errorMessages.push(`ÿßŸÑŸÖŸÑŸÅ ${file.name}: ŸÜŸàÿπ ÿ∫Ÿäÿ± ŸÖÿØÿπŸàŸÖ`);
                        processedCount++;
                        setUploadProgress(Math.round((processedCount / files.length) * 100));
                        if (processedCount === files.length) {
                            setIsUploadingImages(false);
                            if (errorMessages.length > 0) {
                                alert('‚ö†Ô∏è ÿ®ÿπÿ∂ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ŸÑŸÖ Ÿäÿ™ŸÖ ÿ±ŸÅÿπŸáÿß:\n' + errorMessages.join('\n'));
                            }
                        }
                        return;
                    }
                    
                    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿ¨ŸÖ ÿßŸÑŸÖŸÑŸÅ
                    if (file.size > maxSizePerFile) {
                        errorMessages.push(`ÿßŸÑŸÖŸÑŸÅ ${file.name}: ÿ≠ÿ¨ŸÖ ŸÉÿ®Ÿäÿ± ÿ¨ÿØÿßŸã (ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ 10MB)`);
                        processedCount++;
                        setUploadProgress(Math.round((processedCount / files.length) * 100));
                        if (processedCount === files.length) {
                            setIsUploadingImages(false);
                            if (errorMessages.length > 0) {
                                alert('‚ö†Ô∏è ÿ®ÿπÿ∂ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ŸÑŸÖ Ÿäÿ™ŸÖ ÿ±ŸÅÿπŸáÿß:\n' + errorMessages.join('\n'));
                            }
                        }
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            // ÿ•ŸÜÿ¥ÿßÿ° canvas ŸÑÿ∂ÿ∫ÿ∑ ÿßŸÑÿµŸàÿ±ÿ© ÿ®ÿ¨ŸàÿØÿ© ÿπÿßŸÑŸäÿ©
                            const canvas = document.createElement('canvas');
                            let width = img.width;
                            let height = img.height;
                            
                            // ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑŸÑÿ£ÿ®ÿπÿßÿØ ŸÖÿπ ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑÿ¨ŸàÿØÿ©
                            const maxDimension = 2048; // ÿØŸÇÿ© ÿπÿßŸÑŸäÿ© ÿ¨ÿØÿßŸã
                            
                            if (width > height) {
                                if (width > maxDimension) {
                                    height = (height * maxDimension) / width;
                                    width = maxDimension;
                                }
                            } else {
                                if (height > maxDimension) {
                                    width = (width * maxDimension) / height;
                                    height = maxDimension;
                                }
                            }
                            
                            canvas.width = width;
                            canvas.height = height;
                            
                            const ctx = canvas.getContext('2d');
                            
                            // ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ¨ŸàÿØÿ© ÿßŸÑÿ±ÿ≥ŸÖ
                            ctx.imageSmoothingEnabled = true;
                            ctx.imageSmoothingQuality = 'high';
                            
                            // ÿ±ÿ≥ŸÖ ÿßŸÑÿµŸàÿ±ÿ©
                            ctx.drawImage(img, 0, 0, width, height);
                            
                            // ÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸâ base64 ÿ®ÿ¨ŸàÿØÿ© ÿπÿßŸÑŸäÿ©
                            // 0.95 = ÿ¨ŸàÿØÿ© 95% (ÿ¨ŸàÿØÿ© ÿπÿßŸÑŸäÿ© ÿ¨ÿØÿßŸã)
                            const compressedImage = canvas.toDataURL(file.type, 0.95);
                            
                            setNewProduct(prev => ({
                                ...prev,
                                images: [...prev.images, compressedImage],
                                imagePreviews: [...prev.imagePreviews, compressedImage]
                            }));
                            
                            processedCount++;
                            setUploadProgress(Math.round((processedCount / files.length) * 100));
                            
                            // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠ ÿπŸÜÿØ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ°
                            if (processedCount === files.length) {
                                setIsUploadingImages(false);
                                const successCount = files.length - errorMessages.length;
                                if (successCount > 0) {
                                    alert(`‚úÖ ÿ™ŸÖ ÿ±ŸÅÿπ ${successCount} ÿµŸàÿ±ÿ© ÿ®ŸÜÿ¨ÿßÿ≠ ÿ®ÿ¨ŸàÿØÿ© ÿπÿßŸÑŸäÿ©!`);
                                }
                                if (errorMessages.length > 0) {
                                    alert('‚ö†Ô∏è ÿ®ÿπÿ∂ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ŸÑŸÖ Ÿäÿ™ŸÖ ÿ±ŸÅÿπŸáÿß:\n' + errorMessages.join('\n'));
                                }
                            }
                        };
                        
                        img.onerror = () => {
                            errorMessages.push(`ÿßŸÑŸÖŸÑŸÅ ${file.name}: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©`);
                            processedCount++;
                            setUploadProgress(Math.round((processedCount / files.length) * 100));
                            if (processedCount === files.length) {
                                setIsUploadingImages(false);
                                if (errorMessages.length > 0) {
                                    alert('‚ö†Ô∏è ÿ®ÿπÿ∂ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ŸÑŸÖ Ÿäÿ™ŸÖ ÿ±ŸÅÿπŸáÿß:\n' + errorMessages.join('\n'));
                                }
                            }
                        };
                        
                        img.src = event.target.result;
                    };
                    
                    reader.onerror = () => {
                        errorMessages.push(`ÿßŸÑŸÖŸÑŸÅ ${file.name}: ŸÅÿ¥ŸÑ ŸÅŸä ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖŸÑŸÅ`);
                        processedCount++;
                        setUploadProgress(Math.round((processedCount / files.length) * 100));
                        if (processedCount === files.length) {
                            setIsUploadingImages(false);
                            if (errorMessages.length > 0) {
                                alert('‚ö†Ô∏è ÿ®ÿπÿ∂ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ŸÑŸÖ Ÿäÿ™ŸÖ ÿ±ŸÅÿπŸáÿß:\n' + errorMessages.join('\n'));
                            }
                        }
                    };
                    
                    reader.readAsDataURL(file);
                });
                
                // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ input ŸÑÿ™ŸÖŸÉŸäŸÜ ÿ±ŸÅÿπ ŸÜŸÅÿ≥ ÿßŸÑÿµŸàÿ±ÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ
                e.target.value = '';
            };
            
            const removeImage = (index) => {
                setNewProduct(prev => ({
                    ...prev,
                    images: prev.images.filter((_, i) => i !== index),
                    imagePreviews: prev.imagePreviews.filter((_, i) => i !== index)
                }));
            };
            
            const handleAddProduct = (e) => {
                e.preventDefault();
                
                // ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸäŸÖ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÅÿßÿ±ÿ∫ÿ©
                const productData = {
                    name: newProduct.name || 'ŸÖŸÜÿ™ÿ¨ ÿ®ÿØŸàŸÜ ÿßÿ≥ŸÖ',
                    company: newProduct.company || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ',
                    category: newProduct.category || 'ÿ∫Ÿäÿ± ŸÖÿµŸÜŸÅ',
                    price: parseInt(newProduct.price) || 0,
                    unit: newProduct.unit || 'Ÿàÿ≠ÿØÿ©',
                    stock: parseInt(newProduct.stock) || 0,
                    expiryDate: newProduct.expiryDate || '',
                    images: newProduct.images.length > 0 ? newProduct.images : ['üì¶']
                };
                
                if (isEditing) {
                    setProducts(products.map(p => p.id === editingProductId ? {
                        ...productData,
                        id: editingProductId,
                        supplierId: p.supplierId
                    } : p));
                    alert('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÜÿ™ÿ¨!');
                    setIsEditing(false);
                    setEditingProductId(null);
                } else {
                    const product = {
                        ...productData,
                        id: Date.now(),
                        supplierId: currentSupplier.id
                    };
                    setProducts([...products, product]);
                    alert('‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨!\nÿßÿ≥ŸÖ ÿßŸÑÿ¥ÿ±ŸÉÿ©: ' + currentSupplier.companyName + '\nŸÖÿπÿ±ŸÅ ÿßŸÑŸÖŸàÿ±ÿØ: ' + currentSupplier.id);
                }
                setNewProduct({ name: '', company: '', category: '', price: '', unit: '', stock: '', expiryDate: '', images: [], imagePreviews: [] });
                setScannedBarcode('');
            };
            
            const editProduct = (product) => {
                setNewProduct({
                    name: product.name,
                    company: product.company,
                    category: product.category,
                    price: product.price.toString(),
                    unit: product.unit,
                    stock: product.stock.toString(),
                    expiryDate: product.expiryDate || '',
                    images: product.images || ['üì¶'],
                    imagePreviews: product.images || ['üì¶']
                });
                setIsEditing(true);
                setEditingProductId(product.id);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            
            const deleteProduct = (id) => {
                if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨ÿü')) {
                    setProducts(products.filter(p => p.id !== id));
                    alert('ÿ™ŸÖ ÿßŸÑÿ≠ÿ∞ŸÅ!');
                }
            };
            
            const addCategory = () => {
                if (newCategory && !categories.includes(newCategory)) {
                    setCategories([...categories, newCategory]);
                    setNewCategory('');
                    alert('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ!');
                }
            };
            
            const deleteCategory = (cat) => {
                if (cat === 'ÿßŸÑŸÉŸÑ') {
                    alert('ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ™ÿµŸÜŸäŸÅ "ÿßŸÑŸÉŸÑ"');
                    return;
                }
                if (confirm(`ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ™ÿµŸÜŸäŸÅ "${cat}"ÿü`)) {
                    setCategories(categories.filter(c => c !== cat));
                    setProducts(products.map(p => p.category === cat ? {...p, category: 'ÿ∫Ÿäÿ± ŸÖÿµŸÜŸÅ'} : p));
                }
            };
            
            const checkout = (e) => {
                e.preventDefault();
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ŸàŸÅÿ± ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ ŸÇÿ®ŸÑ ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®
                for (let cartItem of cart) {
                    const product = products.find(p => p.id === cartItem.id);
                    if (!product) {
                        alert(`‚ö†Ô∏è ÿßŸÑŸÖŸÜÿ™ÿ¨ ${cartItem.name} ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ`);
                        return;
                    }
                    if (product.stock < cartItem.qty) {
                        alert(`‚ö†Ô∏è ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸç ŸÑŸÑŸÖŸÜÿ™ÿ¨ "${product.name}"\nÿßŸÑŸÖÿ™ŸàŸÅÿ±: ${product.stock}\nÿßŸÑŸÖÿ∑ŸÑŸàÿ®: ${cartItem.qty}`);
                        return;
                    }
                }
                
                const deliveryFee = buyerData.deliveryMethod === 'express' ? 5000 : buyerData.deliveryMethod === 'pickup' ? 0 : 2000;
                const mainOrderNumber = 'ORD-' + Date.now();
                const mainTrackingNumber = 'TRK-' + Date.now();
                
                // ÿ™ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸàÿ±ÿØ
                const ordersBySupplier = {};
                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        const supplierId = product.supplierId;
                        if (!ordersBySupplier[supplierId]) {
                            ordersBySupplier[supplierId] = [];
                        }
                        // ŸÜÿ≥ÿÆ ÿ¨ŸÖŸäÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿπŸÜÿµÿ± ŸÖÿπ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÉŸÖŸäÿ©
                        const orderItem = {
                            id: item.id,
                            name: item.name,
                            company: item.company,
                            price: item.price,
                            qty: item.qty || 1,  // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÉŸÖŸäÿ©
                            unit: item.unit,
                            image: item.image,
                            images: item.images
                        };
                        console.log('ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÜÿµÿ± ŸÑŸÑÿ∑ŸÑÿ®:', orderItem); // ŸÑŸÑÿ™ÿ™ÿ®ÿπ
                        ordersBySupplier[supplierId].push(orderItem);
                    }
                });
                
                // ÿ•ŸÜÿ¥ÿßÿ° ÿ∑ŸÑÿ® ŸÖŸÜŸÅÿµŸÑ ŸÑŸÉŸÑ ŸÖŸàÿ±ÿØ
                const supplierIds = Object.keys(ordersBySupplier);
                const deliveryFeePerSupplier = Math.ceil(deliveryFee / supplierIds.length);
                const newOrders = [];
                
                supplierIds.forEach((supplierId, index) => {
                    const items = ordersBySupplier[supplierId];
                    const subtotal = items.reduce((sum, item) => sum + (item.price * item.qty), 0);
                    const orderFee = index === 0 ? deliveryFee - (deliveryFeePerSupplier * (supplierIds.length - 1)) : deliveryFeePerSupplier;
                    
                    const order = {
                        id: Date.now() + index,
                        buyerId: currentBuyer ? currentBuyer.id : null,
                        buyerStoreName: currentBuyer ? currentBuyer.storeName : null,
                        orderNumber: supplierIds.length > 1 ? `${mainOrderNumber}-${index + 1}` : mainOrderNumber,
                        mainOrderNumber: mainOrderNumber,
                        trackingNumber: supplierIds.length > 1 ? `${mainTrackingNumber}-${index + 1}` : mainTrackingNumber,
                        supplierId: supplierId,
                        ...buyerData,
                        items: items,
                        subtotal: subtotal,
                        deliveryFee: orderFee,
                        total: subtotal + orderFee,
                        status: 'pending',
                        deliveryStatus: 'pending',
                        date: new Date().toISOString(),
                        trackingHistory: [
                            {
                                status: 'pending',
                                date: new Date().toISOString(),
                                note: 'ÿ™ŸÖ ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®'
                            }
                        ]
                    };
                    newOrders.push(order);
                });
                
                setOrders([...orders, ...newOrders]);
                safeSetJSON('orders', [...orders, ...newOrders]);
                
                // ÿÆÿµŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÜ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ
                const updatedProducts = products.map(product => {
                    const cartItem = cart.find(item => item.id === product.id);
                    if (cartItem) {
                        return {
                            ...product,
                            stock: product.stock - cartItem.qty
                        };
                    }
                    return product;
                });
                setProducts(updatedProducts);
                safeSetJSON('products', updatedProducts);
                
                setCart([]);
                setBuyerData({ 
                    storeName: '', 
                    ownerName: '', 
                    phone: '', 
                    address: '', 
                    notes: '', 
                    deliveryMethod: 'standard',
                    latitude: null,
                    longitude: null,
                    locationAccuracy: null
                });
                setShowCheckout(false);
                
                // ÿπÿ±ÿ∂ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿ£ŸÉŸäÿØ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ alert
                setConfirmedOrders(newOrders);
                setShowOrderConfirmation(true);
            };
            
            const getCurrentLocation = () => {
                if (!navigator.geolocation) {
                    alert('‚ö†Ô∏è ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÑÿß ŸäÿØÿπŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàÿßŸÇÿπ GPS');
                    return;
                }
                
                setIsGettingLocation(true);
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude, accuracy } = position.coords;
                        setBuyerData({
                            ...buyerData,
                            latitude: latitude,
                            longitude: longitude,
                            locationAccuracy: accuracy
                        });
                        setIsGettingLocation(false);
                        alert(
                            '‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ŸÖŸàŸÇÿπŸÉ ÿ®ŸÜÿ¨ÿßÿ≠!\n\n' +
                            'üìç ÿßŸÑÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™:\n' +
                            `ÿÆÿ∑ ÿßŸÑÿπÿ±ÿ∂: ${latitude.toFixed(6)}\n` +
                            `ÿÆÿ∑ ÿßŸÑÿ∑ŸàŸÑ: ${longitude.toFixed(6)}\n` +
                            `ÿßŸÑÿØŸÇÿ©: ${Math.round(accuracy)} ŸÖÿ™ÿ±`
                        );
                    },
                    (error) => {
                        setIsGettingLocation(false);
                        let errorMsg = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMsg = '‚ö†Ô∏è ÿ™ŸÖ ÿ±ŸÅÿ∂ ÿßŸÑÿ•ÿ∞ŸÜ ŸÑŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖŸàŸÇÿπ.\n\nŸäÿ±ÿ¨Ÿâ ÿßŸÑÿ≥ŸÖÿßÿ≠ ŸÑŸÑŸÖÿ™ÿµŸÅÿ≠ ÿ®ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÖŸàŸÇÿπŸÉ ŸÖŸÜ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMsg = '‚ö†Ô∏è ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸàŸÇÿπ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ© ÿ≠ÿßŸÑŸäÿßŸã.';
                                break;
                            case error.TIMEOUT:
                                errorMsg = '‚ö†Ô∏è ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿ∑ŸÑÿ® ÿßŸÑŸÖŸàŸÇÿπ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.';
                                break;
                            default:
                                errorMsg = '‚ö†Ô∏è ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ ŸÅŸä ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ.';
                        }
                        alert(errorMsg);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            };
            
            const updateDeliveryStatus = (orderId, newStatus, note) => {
                // ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ ÿ•ÿ∞ÿß ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ∑ŸÑÿ®
                if (newStatus === 'cancelled') {
                    const order = orders.find(o => o.id === orderId) || archivedOrders.find(o => o.id === orderId);
                    if (order && order.deliveryStatus !== 'cancelled') {
                        // ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÑŸÑŸÖÿÆÿ≤ŸàŸÜ
                        const updatedProducts = products.map(product => {
                            const orderItem = order.items.find(item => item.id === product.id);
                            if (orderItem) {
                                return {
                                    ...product,
                                    stock: product.stock + orderItem.qty
                                };
                            }
                            return product;
                        });
                        setProducts(updatedProducts);
                        safeSetJSON('products', updatedProducts);
                    }
                }
                
                setOrders(orders.map(o => {
                    if (o.id === orderId) {
                        const updatedHistory = [...(o.trackingHistory || []), {
                            status: newStatus,
                            date: new Date().toISOString(),
                            note: note || getStatusNote(newStatus)
                        }];
                        return {...o, deliveryStatus: newStatus, trackingHistory: updatedHistory};
                    }
                    return o;
                }));
                setArchivedOrders(archivedOrders.map(o => {
                    if (o.id === orderId) {
                        const updatedHistory = [...(o.trackingHistory || []), {
                            status: newStatus,
                            date: new Date().toISOString(),
                            note: note || getStatusNote(newStatus)
                        }];
                        return {...o, deliveryStatus: newStatus, trackingHistory: updatedHistory};
                    }
                    return o;
                }));
                
                const statusMessage = newStatus === 'cancelled' 
                    ? '‚úÖ ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ∑ŸÑÿ® Ÿàÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÑŸÑŸÖÿÆÿ≤ŸàŸÜ'
                    : '‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ ÿ•ŸÑŸâ:\n' + getStatusNote(newStatus) + '\n\nÿ≥Ÿäÿ∏Ÿáÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÑŸÑŸÖÿ™ÿ¨ÿ± ŸÅŸä ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ™ÿ®ÿπ!';
                    
                alert(statusMessage);
            };
            
            const getStatusNote = (status) => {
                const notes = {
                    'pending': 'ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±',
                    'processing': 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ¨ŸáŸäÿ≤ ÿßŸÑÿ∑ŸÑÿ®',
                    'ready': 'ÿßŸÑÿ∑ŸÑÿ® ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ¥ÿ≠ŸÜ',
                    'shipped': 'ÿ™ŸÖ ÿ¥ÿ≠ŸÜ ÿßŸÑÿ∑ŸÑÿ®',
                    'out_for_delivery': 'ÿßŸÑÿ∑ŸÑÿ® ŸÅŸä ÿ∑ÿ±ŸäŸÇŸá ŸÑŸÑÿ™ÿ≥ŸÑŸäŸÖ',
                    'delivered': 'ÿ™ŸÖ ÿ™ÿ≥ŸÑŸäŸÖ ÿßŸÑÿ∑ŸÑÿ®',
                    'cancelled': 'ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ∑ŸÑÿ®',
                    'failed': 'ŸÅÿ¥ŸÑ ÿßŸÑÿ™ŸàÿµŸäŸÑ',
                    'returned': 'ÿ™ŸÖ ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ∑ŸÑÿ®'
                };
                return notes[status] || status;
            };
            
            const assignDriver = (orderId, driverId) => {
                const driver = deliveryDrivers.find(d => d.id === driverId);
                if (driver) {
                    setOrders(orders.map(o => {
                        if (o.id === orderId) {
                            const updatedHistory = [...(o.trackingHistory || []), {
                                status: 'assigned',
                                date: new Date().toISOString(),
                                note: `ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≥ÿßÿ¶ŸÇ: ${driver.name}`
                            }];
                            return {...o, driverId: driverId, driverName: driver.name, trackingHistory: updatedHistory};
                        }
                        return o;
                    }));
                    alert('ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≥ÿßÿ¶ŸÇ: ' + driver.name);
                }
            };
            
            const trackOrder = () => {
                if (!trackingNumber.trim()) {
                    alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ');
                    return;
                }
                
                // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ∑ŸÑÿ® ÿ®ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿØŸÇŸäŸÇ
                let order = orders.find(o => o.trackingNumber === trackingNumber.trim());
                let archivedOrder = archivedOrders.find(o => o.trackingNumber === trackingNumber.trim());
                
                // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸèÿπÿ´ÿ± ÿπŸÑŸäŸáÿå ÿ±ÿ®ŸÖÿß ŸáŸà ÿ±ŸÇŸÖ ÿ±ÿ¶Ÿäÿ≥Ÿä
                if (!order && !archivedOrder) {
                    // ÿßŸÑÿ®ÿ≠ÿ´ ÿ®ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä (ÿ®ÿØŸàŸÜ -1, -2, ÿ•ŸÑÿÆ)
                    const mainTracking = trackingNumber.trim().split('-').slice(0, -1).join('-');
                    if (mainTracking) {
                        order = orders.find(o => o.trackingNumber && o.trackingNumber.startsWith(mainTracking));
                        archivedOrder = archivedOrders.find(o => o.trackingNumber && o.trackingNumber.startsWith(mainTracking));
                    }
                }
                
                if (order || archivedOrder) {
                    setTrackingResult(order || archivedOrder);
                } else {
                    alert('ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
                    setTrackingResult(null);
                }
            };
            
            const addDeliveryDriver = () => {
                const name = prompt('ÿßÿ≥ŸÖ ÿßŸÑÿ≥ÿßÿ¶ŸÇ:');
                if (!name || !name.trim()) return;
                
                const phone = prompt('ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ:');
                if (!phone || !phone.trim()) return;
                
                const vehicle = prompt('ŸÜŸàÿπ ÿßŸÑŸÖÿ±ŸÉÿ®ÿ©:');
                if (!vehicle || !vehicle.trim()) return;
                
                const newDriver = {
                    id: Date.now(),
                    name: name.trim(),
                    phone: phone.trim(),
                    vehicle: vehicle.trim(),
                    status: 'active',
                    createdAt: new Date().toISOString()
                };
                
                setDeliveryDrivers([...deliveryDrivers, newDriver]);
                alert('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ≥ÿßÿ¶ŸÇ: ' + name);
            };
            
            const updateOrderStatus = (orderId, status) => {
                setOrders(orders.map(o => o.id === orderId ? {...o, status} : o));
                alert('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®');
            };
            
            const myOrders = currentSupplier ? orders.filter(o => o.supplierId === currentSupplier.id) : [];
            
            const myArchivedOrders = currentSupplier ? archivedOrders.filter(o => o.supplierId === currentSupplier.id) : [];
            
            const archiveOrder = (orderId) => {
                if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ŸÜŸÇŸÑ Ÿáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ® ÿ•ŸÑŸâ ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅÿü')) {
                    const order = orders.find(o => o.id === orderId);
                    if (order) {
                        setArchivedOrders([...archivedOrders, {...order, archivedAt: new Date().toISOString()}]);
                        setOrders(orders.filter(o => o.id !== orderId));
                        alert('ÿ™ŸÖ ŸÜŸÇŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ•ŸÑŸâ ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ!');
                    }
                }
            };
            
            const unarchiveOrder = (orderId) => {
                if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿßÿ≥ÿ™ÿπÿßÿØÿ© Ÿáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ® ŸÖŸÜ ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅÿü')) {
                    const order = archivedOrders.find(o => o.id === orderId);
                    if (order) {
                        const {archivedAt, ...orderWithoutArchiveDate} = order;
                        setOrders([...orders, orderWithoutArchiveDate]);
                        setArchivedOrders(archivedOrders.filter(o => o.id !== orderId));
                        alert('ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿ∑ŸÑÿ®!');
                    }
                }
            };
            
            const deleteArchivedOrder = (orderId) => {
                if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ® ŸÜŸáÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅÿü ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°.')) {
                    setArchivedOrders(archivedOrders.filter(o => o.id !== orderId));
                    alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ŸÑÿ® ŸÜŸáÿßÿ¶ŸäÿßŸã!');
                }
            };
            
            const getSupplierOrders = (supplierId) => {
                const activeOrders = orders.filter(o => o.supplierId === supplierId);
                const archived = archivedOrders.filter(o => o.supplierId === supplierId);
                
                return {
                    active: activeOrders,
                    archived: archived,
                    total: activeOrders.length + archived.length
                };
            };
            
            const approveSupplier = (id) => {
                const updated = suppliers.map(s => s.id === id ? {...s, status: 'active'} : s);
                safeSetJSON('suppliers', updated);
                setSuppliers(updated);
                alert('ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸàÿ±ÿØ!');
            };
            
            const rejectSupplier = (id) => {
                if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ±ŸÅÿ∂ Ÿáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ®ÿü')) {
                    const updated = suppliers.filter(s => s.id !== id);
                    safeSetJSON('suppliers', updated);
                    setSuppliers(updated);
                    alert('ÿ™ŸÖ ÿ±ŸÅÿ∂ ÿßŸÑÿ∑ŸÑÿ®');
                }
            };
            
            const toggleSupplierStatus = (id, currentStatus) => {
                const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
                const updated = suppliers.map(s => s.id === id ? {...s, status: newStatus} : s);
                safeSetJSON('suppliers', updated);
                setSuppliers(updated);
                alert(newStatus === 'active' ? 'ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸàÿ±ÿØ' : 'ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑŸÖŸàÿ±ÿØ');
            };
            
            const deleteSupplier = (id) => {
                if (confirm('ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿ±ÿØÿü ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ŸÖŸÜÿ™ÿ¨ÿßÿ™Ÿá ÿ£Ÿäÿ∂ÿßŸã.')) {
                    const updatedSuppliers = suppliers.filter(s => s.id !== id);
                    safeSetJSON('suppliers', updatedSuppliers);
                    setSuppliers(updatedSuppliers);
                    setProducts(products.filter(p => p.supplierId !== id));
                    alert('ÿ™ŸÖ ÿßŸÑÿ≠ÿ∞ŸÅ');
                }
            };
            
            const deleteProductAdmin = (id) => {
                if (confirm('ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨ÿü')) {
                    setProducts(products.filter(p => p.id !== id));
                    alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨');
                }
            };
            
            const printInvoice = (order) => {
                const printWindow = window.open('', '', 'width=800,height=600');
                printWindow.document.write(`
                    <html dir="rtl">
                    <head>
                        <title>ŸÅÿßÿ™Ÿàÿ±ÿ© ${order.orderNumber}</title>
                        <style>
                            body { font-family: Arial; padding: 2rem; }
                            h1 { text-align: center; color: #2c5f2d; }
                            table { width: 100%; border-collapse: collapse; margin-top: 2rem; }
                            th, td { border: 1px solid #ddd; padding: 0.8rem; text-align: right; }
                            th { background: #2c5f2d; color: white; }
                            .total { font-size: 1.5rem; font-weight: bold; margin-top: 2rem; text-align: left; }
                        </style>
                    </head>
                    <body>
                        <h1>ŸÅÿßÿ™Ÿàÿ±ÿ© ÿ∑ŸÑÿ® ${order.orderNumber}</h1>
                        <p><strong>ÿßŸÑŸÖÿ™ÿ¨ÿ±:</strong> ${order.storeName}</p>
                        <p><strong>ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ:</strong> ${order.ownerName}</p>
                        <p><strong>ÿßŸÑŸáÿßÿ™ŸÅ:</strong> ${order.phone}</p>
                        <p><strong>ÿßŸÑÿπŸÜŸàÿßŸÜ:</strong> ${order.address}</p>
                        <p><strong>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ:</strong> ${new Date(order.date).toLocaleString('ar-IQ')}</p>
                        <table>
                            <tr>
                                <th>ÿßŸÑŸÖŸÜÿ™ÿ¨</th>
                                <th>ÿßŸÑÿ≥ÿπÿ±</th>
                                <th>ÿßŸÑŸÉŸÖŸäÿ©</th>
                                <th>ÿßŸÑŸÖÿ¨ŸÖŸàÿπ</th>
                            </tr>
                            ${order.items.map(item => `
                                <tr>
                                    <td>${item.name}</td>
                                    <td>${item.price.toLocaleString()} ÿØ.ÿπ</td>
                                    <td>${item.qty}</td>
                                    <td>${(item.price * item.qty).toLocaleString()} ÿØ.ÿπ</td>
                                </tr>
                            `).join('')}
                        </table>
                        <p class="total">ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä: ${order.total.toLocaleString()} ÿØ.ÿπ</p>
                        <!DOCTYPE html>
<html>
<head>
    <!-- Your existing design CSS and settings are here -->
    <title>ŸÖŸÜÿµÿ© B2B ŸÑŸÑŸÖŸàÿßÿØ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© - ÿßŸÑÿπÿ±ÿßŸÇ</title>
</head>
<body>

    <!-- YOUR EXISTING DESIGN IS HERE -->
    <!-- Your images, text, forms, and layout are here -->
    <h1>ŸÖŸÜÿµÿ© B2B ŸÑŸÑŸÖŸàÿßÿØ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© - ÿßŸÑÿπÿ±ÿßŸÇ</h1>
    
    <!-- ... rest of your design ... -->


    <!-- ‚ñº‚ñº‚ñº PASTE THE CODE BELOW THIS LINE ‚ñº‚ñº‚ñº -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      const { createClient } = supabase;
      
      // REPLACE THESE WITH YOUR ACTUAL KEYS FROM SUPABASE
      const supabaseUrl = 'https://frolmfzkljlvqstvbrmt.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyb2xtZnprbGpsdnFzdHZicm10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyMzE3NTUsImV4cCI6MjA4NjgwNzc1NX0.z1NMSzEvq0rCbiEXL1VLYhnf-4mSfoWtYaaov-1EGv4';
      
      const _supabase = createClient(supabaseUrl, supabaseKey);

      // Example: Load data when page opens
      async function loadData() {
        console.log("Connected to Supabase!");
        // You can add your fetch logic here later
      }

      loadData();
    </script>
    <!-- ‚ñ≤‚ñ≤‚ñ≤ END OF CODE TO PASTE ‚ñ≤‚ñ≤‚ñ≤ -->

  <!-- <--- The code must be ABOVE this line -->

                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            };
            
            const startScanner = async () => {
                setShowScanner(true);
                setIsScanning(true);
                setScannerError('');
                setScannedBarcode('');
                
                try {
                    const codeReader = new ZXing.BrowserMultiFormatReader();
                    const videoElement = document.getElementById('scanner-video');
                    
                    const devices = await codeReader.listVideoInputDevices();
                    if (devices.length === 0) {
                        setScannerError('ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÉÿßŸÖŸäÿ±ÿß');
                        setIsScanning(false);
                        return;
                    }
                    
                    const backCamera = devices.find(device => 
                        device.label.toLowerCase().includes('back') || 
                        device.label.toLowerCase().includes('rear')
                    ) || devices[0];
                    
                    codeReader.decodeFromVideoDevice(backCamera.deviceId, videoElement, (result, err) => {
                        if (result) {
                            setScannedBarcode(result.text);
                            setIsScanning(false);
                            codeReader.reset();
                            fetchProductInfo(result.text);
                        }
                    });
                } catch (error) {
                    setScannerError('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß: ' + error.message);
                    setIsScanning(false);
                }
            };
            
            const stopScanner = () => {
                setShowScanner(false);
                setIsScanning(false);
                const videoElement = document.getElementById('scanner-video');
                if (videoElement && videoElement.srcObject) {
                    videoElement.srcObject.getTracks().forEach(track => track.stop());
                }
            };
            
            const fetchProductInfo = async (barcode) => {
                try {
                    const response = await fetch(`https://world.openfoodfacts.org/api/v0/product/${barcode}.json`);
                    const data = await response.json();
                    
                    if (data.status === 1 && data.product) {
                        const product = data.product;
                        setNewProduct({
                            ...newProduct,
                            name: product.product_name_ar || product.product_name || '',
                            company: product.brands || '',
                            images: product.image_url ? [product.image_url] : [],
                            imagePreviews: product.image_url ? [product.image_url] : []
                        });
                        alert('ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨! Ÿäÿ±ÿ¨Ÿâ ÿ•ŸÉŸÖÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ©.');
                    } else {
                        alert('ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸäÿØŸàŸäÿßŸã.\nÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ: ' + barcode);
                        setNewProduct({
                            ...newProduct,
                            name: 'ÿ®ÿßÿ±ŸÉŸàÿØ: ' + barcode
                        });
                    }
                } catch (error) {
                    alert('ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨. Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸäÿØŸàŸäÿßŸã.\nÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ: ' + barcode);
                    setNewProduct({
                        ...newProduct,
                        name: 'ÿ®ÿßÿ±ŸÉŸàÿØ: ' + barcode
                    });
                }
                setShowScanner(false);
            };
            
            const manualBarcodeEntry = () => {
                const barcode = prompt('ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ ŸäÿØŸàŸäÿßŸã:');
                if (barcode && barcode.trim()) {
                    setScannedBarcode(barcode.trim());
                    fetchProductInfo(barcode.trim());
                }
            };

            // ÿ≠ÿ∞ŸÅ ŸÖÿ™ÿ¨ÿ± Ÿàÿßÿ≠ÿØ (Admin)
            const deleteBuyer = (buyerId) => {
                const updated = buyers.filter(b => b.id !== buyerId);
                setBuyers(updated);
                safeSetJSON('buyers', updated);
                // ÿ≠ÿ∞ŸÅ ÿ≥ŸÑÿ© ÿßŸÑŸÖÿ™ÿ¨ÿ±
                safeStorage('remove', 'cart_' + buyerId);
                setSelectedBuyersAdmin(prev => { const n = new Set(prev); n.delete(buyerId); return n; });
            };

            // ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ™ÿßÿ¨ÿ± ÿßŸÑŸÖÿ≠ÿØÿØÿ© (Admin)
            const deleteSelectedBuyers = () => {
                if (selectedBuyersAdmin.size === 0) return;
                if (!confirm(`‚ö†Ô∏è ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ ${selectedBuyersAdmin.size} ŸÖÿ™ÿ¨ÿ±ÿü\nÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿßŸÑÿÆÿßÿµÿ© ÿ®ŸáŸÖ.\nŸÑŸÜ ÿ™ÿ™ÿ£ÿ´ÿ± ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™.`)) return;
                const ids = selectedBuyersAdmin;
                const updated = buyers.filter(b => !ids.has(b.id));
                setBuyers(updated);
                safeSetJSON('buyers', updated);
                ids.forEach(id => safeStorage('remove', 'cart_' + id));
                setSelectedBuyersAdmin(new Set());
                alert('‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ™ÿßÿ¨ÿ± ÿßŸÑŸÖÿ≠ÿØÿØÿ©');
            };

            // ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ™ÿßÿ¨ÿ± (Admin)
            const deleteAllBuyers = () => {
                if (!confirm(`‚ö†Ô∏è ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ™ÿßÿ¨ÿ± (${buyers.length} ŸÖÿ™ÿ¨ÿ±)ÿü\nÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿ≠ÿ≥ÿßÿ®ÿßÿ™ ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸäŸÜ.\nŸÑŸÜ ÿ™ÿ™ÿ£ÿ´ÿ± ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™.`)) return;
                const confirmation = prompt('ÿßŸÉÿ™ÿ® "ŸÖÿ≥ÿ≠" ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ:');
                if (confirmation !== 'ŸÖÿ≥ÿ≠') { alert('‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°'); return; }
                buyers.forEach(b => safeStorage('remove', 'cart_' + b.id));
                setBuyers([]);
                safeSetJSON('buyers', []);
                setSelectedBuyersAdmin(new Set());
                alert('‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ™ÿßÿ¨ÿ±');
            };

            // ÿ≠ÿ∞ŸÅ ÿ∑ŸÑÿ® Ÿàÿßÿ≠ÿØ ŸÑŸÑŸÖÿ¥ÿ™ÿ±Ÿä
            const deleteBuyerOrder = (orderId) => {
                const inActive = orders.find(o => o.id === orderId);
                const inArchived = archivedOrders.find(o => o.id === orderId);
                if (inActive) {
                    const updated = orders.filter(o => o.id !== orderId);
                    setOrders(updated);
                    safeSetJSON('orders', updated);
                }
                if (inArchived) {
                    const updated = archivedOrders.filter(o => o.id !== orderId);
                    setArchivedOrders(updated);
                    safeSetJSON('archivedOrders', updated);
                }
                setSelectedBuyerOrders(prev => { const n = new Set(prev); n.delete(orderId); return n; });
            };

            // ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖÿ≠ÿØÿØÿ© ŸÑŸÑŸÖÿ¥ÿ™ÿ±Ÿä
            const deleteSelectedBuyerOrders = () => {
                if (selectedBuyerOrders.size === 0) return;
                if (!confirm(`‚ö†Ô∏è ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ ${selectedBuyerOrders.size} ÿ∑ŸÑÿ®ÿü\nŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°.`)) return;
                const ids = selectedBuyerOrders;
                setOrders(orders.filter(o => !ids.has(o.id)));
                setArchivedOrders(archivedOrders.filter(o => !ids.has(o.id)));
                safeSetJSON('orders', orders.filter(o => !ids.has(o.id)));
                safeSetJSON('archivedOrders', archivedOrders.filter(o => !ids.has(o.id)));
                setSelectedBuyerOrders(new Set());
            };

            // ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä
            const deleteAllBuyerOrders = (buyerOrders) => {
                if (!confirm(`‚ö†Ô∏è ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿ∑ŸÑÿ®ÿßÿ™ŸÉ (${buyerOrders.length} ÿ∑ŸÑÿ®)ÿü\nŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°.`)) return;
                const ids = new Set(buyerOrders.map(o => o.id));
                const newOrders = orders.filter(o => !ids.has(o.id));
                const newArchived = archivedOrders.filter(o => !ids.has(o.id));
                setOrders(newOrders);
                setArchivedOrders(newArchived);
                safeSetJSON('orders', newOrders);
                safeSetJSON('archivedOrders', newArchived);
                setSelectedBuyerOrders(new Set());
            };

            return (
                <div>
                    <header className={`header ${admin ? 'admin' : currentBuyer ? 'buyer' : ''}`}>
                        <div className="header-content">
                            <div className="logo">üõí ŸÖŸÜÿµÿ© B2B ŸÑŸÑŸÖŸàÿßÿØ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ©</div>
                            <nav className="nav-tabs">
                                <button className={`nav-tab ${currentTab === 'shop' ? 'active' : ''}`} onClick={() => setCurrentTab('shop')}>
                                    ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
                                </button>
                                <button className={`nav-tab ${currentTab === 'cart' ? 'active' : ''}`} onClick={() => {
                                    if (!currentBuyer) { setShowBuyerAuth(true); setBuyerAuthMode('login'); return; }
                                    setCurrentTab('cart');
                                }}>
                                    üõí ÿßŸÑÿ≥ŸÑÿ©
                                    {totalItems > 0 && <span className="badge">{totalItems}</span>}
                                </button>
                                {currentBuyer && (
                                    <div style={{background: 'rgba(255,255,255,0.15)', padding: '0.5rem 1rem', borderRadius: '8px', fontSize: '0.9rem', display: 'flex', alignItems: 'center', gap: '0.4rem'}}>
                                        üè™ {currentBuyer.storeName}
                                    </div>
                                )}
                                <button className="nav-tab" onClick={() => setShowTrackingModal(true)}>
                                    üì¶ ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ¥ÿ≠ŸÜÿ©
                                </button>
                                {currentBuyer && (
                                    <button className={`nav-tab ${currentTab === 'myOrders' ? 'active' : ''}`} onClick={() => setCurrentTab('myOrders')}>
                                        üìã ÿ∑ŸÑÿ®ÿßÿ™Ÿä
                                    </button>
                                )}
                                {currentSupplier && (
                                    <>
                                        <button className={`nav-tab ${currentTab === 'orders' ? 'active' : ''}`} onClick={() => setCurrentTab('orders')}>
                                            ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™
                                            {myOrders.length > 0 && <span className="badge">{myOrders.length}</span>}
                                        </button>
                                        <button className={`nav-tab ${currentTab === 'products' ? 'active' : ''}`} onClick={() => setCurrentTab('products')}>
                                            ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
                                        </button>
                                    </>
                                )}
                                {admin && (
                                    <button className={`nav-tab ${currentTab === 'adminPanel' ? 'active' : ''}`} onClick={() => setCurrentTab('adminPanel')}>
                                        üîê ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ©
                                    </button>
                                )}
                            </nav>
                            {admin ? (
                                <div style={{display: 'flex', gap: '1rem', alignItems: 'center'}}>
                                    <div className="user-info">üîê {admin.name}</div>
                                    <button className="btn btn-secondary" onClick={logout}>ÿÆÿ±Ÿàÿ¨</button>
                                </div>
                            ) : currentSupplier ? (
                                <div style={{display: 'flex', gap: '1rem', alignItems: 'center'}}>
                                    <div className="user-info">üè≠ {currentSupplier.companyName}</div>
                                    <button className="btn btn-secondary" onClick={logout}>ÿÆÿ±Ÿàÿ¨</button>
                                </div>
                            ) : currentBuyer ? (
                                <div style={{display: 'flex', gap: '1rem', alignItems: 'center'}}>
                                    <div className="user-info">üè™ {currentBuyer.storeName}</div>
                                    <button className="btn btn-secondary" onClick={buyerLogout} style={{padding: '0.5rem 1rem', fontSize: '0.9rem'}}>ÿÆÿ±Ÿàÿ¨</button>
                                </div>
                            ) : (
                                <div style={{display: 'flex', gap: '0.5rem'}}>
                                    <button className="nav-tab" style={{background: 'rgba(255,255,255,0.3)', fontWeight: 'bold'}} onClick={() => { setShowBuyerAuth(true); setBuyerAuthMode('login'); }}>üè™ ÿØÿÆŸàŸÑ ÿßŸÑŸÖÿ™ÿ¨ÿ±</button>
                                    <button className="nav-tab" onClick={() => setShowAuthModal(true)}>üè≠ ÿØÿÆŸàŸÑ ÿßŸÑŸÖŸàÿ±ÿØ</button>
                                </div>
                            )}
                        </div>
                    </header>

                    <div className="container">
                        {currentTab === 'shop' && (
                            <div>
                                {!currentBuyer && !currentSupplier && !admin && (
                                    <div style={{background: 'linear-gradient(135deg, #2c5f2d 0%, #97bc62 100%)', color: 'white', padding: '1.5rem 2rem', borderRadius: '16px', marginBottom: '2rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem', boxShadow: '0 4px 12px rgba(44,95,45,0.3)'}}>
                                        <div>
                                            <h3 style={{marginBottom: '0.3rem', fontSize: '1.3rem'}}>üè™ ÿ≥ÿ¨ŸëŸÑ ÿØÿÆŸàŸÑŸÉ ŸÑŸÑÿ∑ŸÑÿ® Ÿàÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ŸÑÿ©</h3>
                                            <p style={{opacity: 0.9, fontSize: '0.95rem'}}>ŸÉŸÑ ŸÖÿ™ÿ¨ÿ± ŸÑŸá ÿ≥ŸÑÿ© ÿÆÿßÿµÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ≠ÿ™Ÿâ ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠</p>
                                        </div>
                                        <div style={{display: 'flex', gap: '0.8rem'}}>
                                            <button onClick={() => { setShowBuyerAuth(true); setBuyerAuthMode('login'); }} style={{background: 'white', color: '#2c5f2d', border: 'none', padding: '0.8rem 1.5rem', borderRadius: '8px', cursor: 'pointer', fontWeight: 'bold', fontSize: '1rem'}}>
                                                üîì ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
                                            </button>
                                            <button onClick={() => { setShowBuyerAuth(true); setBuyerAuthMode('register'); }} style={{background: 'rgba(255,255,255,0.2)', color: 'white', border: '2px solid white', padding: '0.8rem 1.5rem', borderRadius: '8px', cursor: 'pointer', fontWeight: 'bold', fontSize: '1rem'}}>
                                                ‚úèÔ∏è ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®
                                            </button>
                                        </div>
                                    </div>
                                )}
                                <div className="search-filter-bar">
                                    <div className="search-box">
                                        <input 
                                            type="text" 
                                            className="search-input" 
                                            placeholder="üîç ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÜÿ™ÿ¨ ÿ£Ÿà ÿ¥ÿ±ŸÉÿ©..."
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                        />
                                    </div>
                                    <div className="filter-group">
                                        <div className="filter-dropdown">
                                            <select 
                                                className="filter-btn"
                                                value={categoryFilter}
                                                onChange={(e) => setCategoryFilter(e.target.value)}
                                            >
                                                {categories.map(cat => (
                                                    <option key={cat} value={cat}>üìÅ {cat}</option>
                                                ))}
                                            </select>
                                        </div>
                                        
                                        <div className="filter-dropdown">
                                            <button 
                                                className={`filter-btn ${selectedSuppliers.length > 0 ? 'active' : ''}`}
                                                onClick={() => setShowSupplierDropdown(!showSupplierDropdown)}
                                            >
                                                üè≠ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ
                                                {selectedSuppliers.length > 0 && ` (${selectedSuppliers.length})`}
                                            </button>
                                            {showSupplierDropdown && (
                                                <div className="dropdown-menu">
                                                    {uniqueSuppliers.map(supplier => (
                                                        <div key={supplier} className="dropdown-item">
                                                            <input 
                                                                type="checkbox"
                                                                checked={selectedSuppliers.includes(supplier)}
                                                                onChange={(e) => {
                                                                    if (e.target.checked) {
                                                                        setSelectedSuppliers([...selectedSuppliers, supplier]);
                                                                    } else {
                                                                        setSelectedSuppliers(selectedSuppliers.filter(s => s !== supplier));
                                                                    }
                                                                }}
                                                            />
                                                            <span>{supplier}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        
                                        <div className="filter-dropdown">
                                            <button 
                                                className={`filter-btn ${selectedCompanies.length > 0 ? 'active' : ''}`}
                                                onClick={() => setShowCompanyDropdown(!showCompanyDropdown)}
                                            >
                                                üè¢ ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™
                                                {selectedCompanies.length > 0 && ` (${selectedCompanies.length})`}
                                            </button>
                                            {showCompanyDropdown && (
                                                <div className="dropdown-menu">
                                                    {uniqueCompanies.map(company => (
                                                        <div key={company} className="dropdown-item">
                                                            <input 
                                                                type="checkbox"
                                                                checked={selectedCompanies.includes(company)}
                                                                onChange={(e) => {
                                                                    if (e.target.checked) {
                                                                        setSelectedCompanies([...selectedCompanies, company]);
                                                                    } else {
                                                                        setSelectedCompanies(selectedCompanies.filter(c => c !== company));
                                                                    }
                                                                }}
                                                            />
                                                            <span>{company}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        
                                        {(categoryFilter !== 'ÿßŸÑŸÉŸÑ' || selectedSuppliers.length > 0 || selectedCompanies.length > 0 || searchTerm) && (
                                            <button 
                                                className="btn btn-secondary"
                                                onClick={() => {
                                                    setCategoryFilter('ÿßŸÑŸÉŸÑ');
                                                    setSelectedSuppliers([]);
                                                    setSelectedCompanies([]);
                                                    setSearchTerm('');
                                                }}
                                            >
                                                ‚ùå ŸÖÿ≥ÿ≠ ÿßŸÑŸÅŸÑÿßÿ™ÿ±
                                            </button>
                                        )}
                                    </div>
                                </div>

                                <div className="section">
                                    <h2 style={{marginBottom: '1.5rem'}}>ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ({filteredProducts.length})</h2>
                                    {filteredProducts.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-state-icon">üîç</div>
                                            <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™</h3>
                                            <p>ÿ¨ÿ±ÿ® ÿ™ÿ∫ŸäŸäÿ± ŸÖÿπÿßŸäŸäÿ± ÿßŸÑÿ®ÿ≠ÿ´</p>
                                        </div>
                                    ) : (
                                        <div className="products-grid">
                                            {filteredProducts.map(product => (
                                                <div key={product.id} className="product-card">
                                                    <div className="product-image">
                                                        <ImageSlider images={product.images || [product.image || 'üì¶']} />
                                                    </div>
                                                    <div className="product-name">{product.name}</div>
                                                    <div className="product-company">{product.company}</div>
                                                    <div className="product-badges">
                                                        <span className={`product-badge ${product.stock < 50 ? 'badge-warning' : 'badge-success'}`}>
                                                            {product.stock < 50 ? '‚ö†Ô∏è' : '‚úì'} ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ: {product.stock}
                                                        </span>
                                                        <ExpiryBadge expiryDate={product.expiryDate} />
                                                    </div>
                                                    <div className="product-price">{product.price.toLocaleString()} ÿØ.ÿπ</div>
                                                    <small style={{color: '#666'}}>{product.unit}</small>
                                                    <div style={{marginTop: '1rem', display: 'flex', gap: '0.5rem', alignItems: 'center'}}>
                                                        <input 
                                                            type="number" 
                                                            min="1" 
                                                            value={productQuantities[product.id] || 1}
                                                            onChange={(e) => setProductQuantities({...productQuantities, [product.id]: parseInt(e.target.value) || 1})}
                                                            style={{width: '60px', padding: '0.5rem', border: '2px solid #ddd', borderRadius: '6px'}}
                                                        />
                                                        <button className="btn btn-primary" style={{flex: 1}} onClick={() => {
                                                        if (!currentBuyer) {
                                                            if (window.confirm('Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÑŸÑÿ≥ŸÑÿ©\n\nŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿßŸÑÿ¢ŸÜÿü')) {
                                                                setShowBuyerAuth(true); setBuyerAuthMode('login');
                                                            }
                                                            return;
                                                        }
                                                        addToCart(product);
                                                    }}>
                                                            ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ≥ŸÑÿ©
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {currentTab === 'cart' && (
                            <div className="section">
                                <h2>ÿ≥ŸÑÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™</h2>
                                {cart.length === 0 ? (
                                    <div className="empty-state">
                                        <div className="empty-state-icon">üõí</div>
                                        <h3>ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ©</h3>
                                        <p>ÿ£ÿ∂ŸÅ ÿ®ÿπÿ∂ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÑŸÑÿ®ÿØÿ°</p>
                                    </div>
                                ) : (
                                    <>
                                        {cart.map(item => (
                                            <div key={item.id} className="cart-item">
                                                <div>
                                                    <strong>{item.name}</strong>
                                                    <div><small>{item.company}</small></div>
                                                    <div style={{marginTop: '0.5rem'}}>
                                                        <span>{item.price.toLocaleString()} ÿØ.ÿπ √ó {item.qty}</span>
                                                    </div>
                                                </div>
                                                <div style={{display: 'flex', gap: '1rem', alignItems: 'center'}}>
                                                    <div className="quantity-selector">
                                                        <button className="quantity-btn" onClick={() => updateCartQty(item.id, item.qty - 1)}>-</button>
                                                        <span style={{minWidth: '30px', textAlign: 'center'}}>{item.qty}</span>
                                                        <button className="quantity-btn" onClick={() => updateCartQty(item.id, item.qty + 1)}>+</button>
                                                    </div>
                                                    <strong>{(item.price * item.qty).toLocaleString()} ÿØ.ÿπ</strong>
                                                    <button className="btn btn-danger" onClick={() => removeFromCart(item.id)}>üóëÔ∏è</button>
                                                </div>
                                            </div>
                                        ))}
                                        <div style={{marginTop: '2rem', padding: '1.5rem', background: '#f5f5f5', borderRadius: '8px'}}>
                                            <div style={{display: 'flex', justifyContent: 'space-between', fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '1rem'}}>
                                                <span>ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä:</span>
                                                <span style={{color: '#2c5f2d'}}>{totalAmount.toLocaleString()} ÿØ.ÿπ</span>
                                            </div>
                                            <button className="btn btn-primary" style={{width: '100%', padding: '1rem', fontSize: '1.2rem'}} onClick={openCheckout}>
                                                ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®
                                            </button>
                                        </div>
                                    </>
                                )}
                            </div>
                        )}

                        {currentTab === 'myOrders' && currentBuyer && (() => {
                            const myBuyerOrders = [...orders, ...archivedOrders]
                                .filter(o => o.buyerId === currentBuyer.id)
                                .sort((a, b) => new Date(b.date) - new Date(a.date));
                            const allSelected = myBuyerOrders.length > 0 && myBuyerOrders.every(o => selectedBuyerOrders.has(o.id));
                            const someSelected = selectedBuyerOrders.size > 0;
                            return (
                                <div className="section">
                                    {/* Header */}
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem', flexWrap: 'wrap', gap: '1rem'}}>
                                        <h2>üìã ÿ∑ŸÑÿ®ÿßÿ™Ÿä - {currentBuyer.storeName}</h2>
                                        <div style={{display: 'flex', gap: '0.5rem', alignItems: 'center', flexWrap: 'wrap'}}>
                                            <span style={{background: '#e8f5e9', color: '#2e7d32', padding: '0.5rem 1rem', borderRadius: '8px', fontWeight: 'bold'}}>
                                                {myBuyerOrders.length} ÿ∑ŸÑÿ®
                                            </span>
                                            {someSelected && (
                                                <button
                                                    className="btn btn-danger"
                                                    onClick={deleteSelectedBuyerOrders}
                                                    style={{animation: 'pulse 1s infinite'}}
                                                >
                                                    üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≠ÿØÿØ ({selectedBuyerOrders.size})
                                                </button>
                                            )}
                                            {myBuyerOrders.length > 0 && (
                                                <button
                                                    className="btn"
                                                    style={{background: '#b71c1c', color: 'white'}}
                                                    onClick={() => deleteAllBuyerOrders(myBuyerOrders)}
                                                >
                                                    üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿßŸÑŸÉŸÑ
                                                </button>
                                            )}
                                        </div>
                                    </div>

                                    {/* ÿ¥ÿ±Ÿäÿ∑ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ */}
                                    {myBuyerOrders.length > 1 && (
                                        <div style={{background: '#f5f7fa', padding: '0.8rem 1.2rem', borderRadius: '10px', marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.8rem', border: '1px solid #e0e0e0'}}>
                                            <input
                                                type="checkbox"
                                                id="selectAll"
                                                checked={allSelected}
                                                onChange={() => {
                                                    if (allSelected) {
                                                        setSelectedBuyerOrders(new Set());
                                                    } else {
                                                        setSelectedBuyerOrders(new Set(myBuyerOrders.map(o => o.id)));
                                                    }
                                                }}
                                                style={{width: '18px', height: '18px', cursor: 'pointer', accentColor: '#c62828'}}
                                            />
                                            <label htmlFor="selectAll" style={{cursor: 'pointer', fontWeight: 'bold', color: '#555', userSelect: 'none'}}>
                                                ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ ({myBuyerOrders.length} ÿ∑ŸÑÿ®)
                                            </label>
                                            {someSelected && (
                                                <span style={{marginRight: 'auto', background: '#ffebee', color: '#c62828', padding: '0.3rem 0.8rem', borderRadius: '20px', fontSize: '0.9rem', fontWeight: 'bold'}}>
                                                    ‚úì ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ {selectedBuyerOrders.size}
                                                </span>
                                            )}
                                        </div>
                                    )}

                                    {myBuyerOrders.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-state-icon">üì¶</div>
                                            <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ÿ®ÿπÿØ</h3>
                                            <p>ÿßÿ®ÿØÿ£ ÿßŸÑÿ™ÿ≥ŸàŸÇ ÿßŸÑÿ¢ŸÜ!</p>
                                            <button className="btn btn-primary" onClick={() => setCurrentTab('shop')} style={{marginTop: '1rem'}}>
                                                üõçÔ∏è ÿ™ÿµŸÅÿ≠ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
                                            </button>
                                        </div>
                                    ) : (
                                        myBuyerOrders.map(order => {
                                            const isChecked = selectedBuyerOrders.has(order.id);
                                            return (
                                                <div key={order.id} style={{
                                                    background: isChecked ? '#fff8f8' : 'white',
                                                    border: isChecked ? '2px solid #ef9a9a' : '1px solid #e0e0e0',
                                                    borderRadius: '12px', padding: '1.2rem',
                                                    marginBottom: '1rem',
                                                    transition: 'all 0.2s',
                                                    boxShadow: isChecked ? '0 2px 8px rgba(198,40,40,0.1)' : '0 2px 6px rgba(0,0,0,0.06)'
                                                }}>
                                                    {/* ÿµŸÅ ÿßŸÑÿπŸÜŸàÿßŸÜ + checkbox */}
                                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', gap: '1rem'}}>
                                                        <div style={{display: 'flex', alignItems: 'flex-start', gap: '0.8rem', flex: 1}}>
                                                            <input
                                                                type="checkbox"
                                                                checked={isChecked}
                                                                onChange={() => {
                                                                    setSelectedBuyerOrders(prev => {
                                                                        const n = new Set(prev);
                                                                        if (n.has(order.id)) n.delete(order.id);
                                                                        else n.add(order.id);
                                                                        return n;
                                                                    });
                                                                }}
                                                                style={{width: '18px', height: '18px', cursor: 'pointer', marginTop: '3px', accentColor: '#c62828', flexShrink: 0}}
                                                            />
                                                            <div>
                                                                <div style={{fontWeight: 'bold', fontSize: '1.05rem'}}>{order.orderNumber}</div>
                                                                <div style={{fontSize: '0.85rem', color: '#999', marginTop: '0.2rem'}}>{new Date(order.date).toLocaleString('ar-IQ')}</div>
                                                                <div style={{marginTop: '0.4rem', fontSize: '0.9rem', color: '#666'}}>
                                                                    üì¶ <strong style={{color: '#1976d2'}}>{order.trackingNumber}</strong>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div style={{textAlign: 'left', flexShrink: 0}}>
                                                            <div style={{fontSize: '1.3rem', fontWeight: 'bold', color: '#2c5f2d', marginBottom: '0.3rem'}}>
                                                                {order.total.toLocaleString()} ÿØ.ÿπ
                                                            </div>
                                                            <span className={`product-badge ${
                                                                order.deliveryStatus === 'delivered' ? 'badge-success' :
                                                                order.deliveryStatus === 'cancelled' ? 'badge-danger' :
                                                                order.deliveryStatus === 'shipped' || order.deliveryStatus === 'out_for_delivery' ? 'badge-info' :
                                                                'badge-warning'
                                                            }`}>
                                                                {getStatusNote(order.deliveryStatus || 'pending')}
                                                            </span>
                                                        </div>
                                                    </div>

                                                    {/* ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ */}
                                                    <div style={{marginTop: '0.8rem'}}>
                                                        {order.items.map((item, i) => (
                                                            <div key={i} style={{padding: '0.35rem 0.8rem', background: '#f5f5f5', borderRadius: '6px', marginBottom: '0.3rem', fontSize: '0.9rem', display: 'flex', justifyContent: 'space-between'}}>
                                                                <span>{item.name} √ó {item.qty}</span>
                                                                <span style={{fontWeight: 'bold'}}>{(item.price * item.qty).toLocaleString()} ÿØ.ÿπ</span>
                                                            </div>
                                                        ))}
                                                    </div>

                                                    {/* ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± */}
                                                    <div style={{marginTop: '0.8rem', display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                                                        <button className="btn btn-primary" style={{padding: '0.5rem 1rem', fontSize: '0.9rem'}}
                                                            onClick={() => { setSelectedOrder(order); setShowOrderDetail(true); }}>
                                                            üìÑ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
                                                        </button>
                                                        <button className="btn btn-secondary" style={{padding: '0.5rem 1rem', fontSize: '0.9rem'}}
                                                            onClick={() => { setTrackingNumber(order.trackingNumber); setShowTrackingModal(true); trackOrder(); }}>
                                                            üìç ÿ™ÿ™ÿ®ÿπ
                                                        </button>
                                                        <button
                                                            className="btn btn-danger"
                                                            style={{padding: '0.5rem 1rem', fontSize: '0.9rem', marginRight: 'auto'}}
                                                            onClick={() => {
                                                                if (confirm(`ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ŸÑÿ® ${order.orderNumber}ÿü`))
                                                                    deleteBuyerOrder(order.id);
                                                            }}
                                                        >
                                                            üóëÔ∏è ÿ≠ÿ∞ŸÅ
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })
                                    )}
                                </div>
                            );
                        })()}

                        {currentTab === 'orders' && currentSupplier && (
                            <div className="section">
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem', flexWrap: 'wrap', gap: '1rem'}}>
                                    <h2>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™</h2>
                                    <div style={{display: 'flex', gap: '0.5rem'}}>
                                        <button 
                                            className={`btn ${!showArchived ? 'btn-primary' : 'btn-secondary'}`}
                                            onClick={() => setShowArchived(false)}
                                        >
                                            üìã ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ© ({myOrders.length})
                                        </button>
                                        <button 
                                            className={`btn ${showArchived ? 'btn-primary' : 'btn-secondary'}`}
                                            onClick={() => setShowArchived(true)}
                                        >
                                            üì¶ ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ ({myArchivedOrders.length})
                                        </button>
                                    </div>
                                </div>


                                {/* ÿ¨ÿØŸäÿØ: ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ™ÿ¨ÿ± ŸÅŸä ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖŸàÿ±ÿØ */}
                                <div style={{background: '#f5f7fa', padding: '1rem', borderRadius: '12px', marginBottom: '1.5rem', border: '2px solid #e0e0e0'}}>
                                    <input 
                                        type="text"
                                        value={supplierOrderSearchTerm}
                                        onChange={(e) => setSupplierOrderSearchTerm(e.target.value)}
                                        placeholder="üîç ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ™ÿ¨ÿ±..."
                                        style={{width: '100%', padding: '1rem 1.5rem', border: '2px solid #ddd', borderRadius: '10px', fontSize: '1rem', background: 'white'}}
                                        onFocus={(e) => e.target.style.borderColor = '#2c5f2d'}
                                        onBlur={(e) => e.target.style.borderColor = '#ddd'}
                                    />
                                </div>
                                {supplierOrderSearchTerm.trim() !== '' && (
                                    <div style={{background: '#e8f5e9', padding: '0.5rem 1rem', borderRadius: '6px', marginBottom: '1rem', color: '#2e7d32', fontWeight: 'bold', textAlign: 'center'}}>
                                        üìä ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ {(showArchived ? myArchivedOrders : myOrders).filter(o => o.storeName.toLowerCase().includes(supplierOrderSearchTerm.toLowerCase().trim())).length} ÿ∑ŸÑÿ®(ÿßÿ™)
                                    </div>
                                )}

                                {!showArchived ? (
                                    (supplierOrderSearchTerm.trim() === '' ? myOrders : myOrders.filter(o => o.storeName.toLowerCase().includes(supplierOrderSearchTerm.toLowerCase().trim()))).length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-state-icon">üì¶</div>
                                            <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™</h3>
                                        </div>
                                    ) : (
                                        <div>
                                            {(supplierOrderSearchTerm.trim() === '' ? myOrders : myOrders.filter(o => o.storeName.toLowerCase().includes(supplierOrderSearchTerm.toLowerCase().trim()))).sort((a, b) => new Date(b.date) - new Date(a.date)).map(order => (
                                                <div key={order.id} style={{background: 'white', padding: '1.5rem', borderRadius: '12px', border: '1px solid #ddd', marginBottom: '1rem'}}>
                                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem'}}>
                                                        <div>
                                                            <h3>{order.orderNumber}</h3>
                                                            {order.mainOrderNumber && order.mainOrderNumber !== order.orderNumber && (
                                                                <div style={{marginTop: '0.3rem'}}>
                                                                    <span className="product-badge badge-info" style={{fontSize: '0.8rem'}}>
                                                                        üì¶ ÿ¨ÿ≤ÿ° ŸÖŸÜ ÿ∑ŸÑÿ® ŸÖÿ¥ÿ™ÿ±ŸÉ - ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä: {order.mainOrderNumber}
                                                                    </span>
                                                                </div>
                                                            )}
                                                            <p style={{color: '#666', marginTop: '0.5rem'}}>
                                                                <strong>ÿßŸÑŸÖÿ™ÿ¨ÿ±:</strong> {order.storeName}<br/>
                                                                <strong>ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ:</strong> {order.ownerName}<br/>
                                                                <strong>ÿßŸÑŸÖÿ®ŸÑÿ∫:</strong> {order.total.toLocaleString()} ÿØ.ÿπ<br/>
                                                                <strong>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ:</strong> {new Date(order.date).toLocaleDateString('ar-IQ')}<br/>
                                                                <strong>ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ:</strong> 
                                                                <span className={`product-badge ${
                                                                    order.deliveryStatus === 'delivered' ? 'badge-success' :
                                                                    order.deliveryStatus === 'out_for_delivery' ? 'badge-info' :
                                                                    order.deliveryStatus === 'shipped' ? 'badge-warning' :
                                                                    order.deliveryStatus === 'cancelled' ? 'badge-danger' :
                                                                    'badge-warning'
                                                                }`} style={{marginRight: '0.5rem'}}>
                                                                    {getStatusNote(order.deliveryStatus || 'pending')}
                                                                </span>
                                                            </p>
                                                        </div>
                                                        <div style={{display: 'flex', gap: '0.5rem', flexDirection: 'column'}}>
                                                            <select 
                                                                value={order.deliveryStatus || 'pending'} 
                                                                onChange={(e) => {
                                                                    const note = prompt('ŸÖŸÑÿßÿ≠ÿ∏ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä):');
                                                                    updateDeliveryStatus(order.id, e.target.value, note);
                                                                }}
                                                                className="order-status-select"
                                                            >
                                                                <option value="pending">ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±</option>
                                                                <option value="processing">ŸÇŸäÿØ ÿßŸÑÿ™ÿ¨ŸáŸäÿ≤</option>
                                                                <option value="ready">ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ¥ÿ≠ŸÜ</option>
                                                                <option value="shipped">ÿ™ŸÖ ÿßŸÑÿ¥ÿ≠ŸÜ</option>
                                                                <option value="out_for_delivery">ŸÅŸä ÿ∑ÿ±ŸäŸÇŸá ŸÑŸÑÿ™ÿ≥ŸÑŸäŸÖ</option>
                                                                <option value="delivered">ÿ™ŸÖ ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ</option>
                                                                <option value="cancelled">ŸÖŸÑÿ∫Ÿä</option>
                                                            </select>
                                                            <button className="btn btn-primary" onClick={() => { setSelectedOrder(order); setShowOrderDetail(true); }}>
                                                                ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
                                                            </button>
                                                            <button className="btn btn-secondary" onClick={() => printInvoice(order)}>
                                                                üñ®Ô∏è ÿ∑ÿ®ÿßÿπÿ©
                                                            </button>
                                                            <button className="btn" style={{background: '#ff9800', color: 'white'}} onClick={() => archiveOrder(order.id)}>
                                                                üì¶ ÿ£ÿ±ÿ¥ŸÅÿ©
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )
                                ) : (
                                    (supplierOrderSearchTerm.trim() === '' ? myArchivedOrders : myArchivedOrders.filter(o => o.storeName.toLowerCase().includes(supplierOrderSearchTerm.toLowerCase().trim()))).length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-state-icon">üì¶</div>
                                            <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ŸÅŸä ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ</h3>
                                            <p>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖÿ§ÿ±ÿ¥ŸÅÿ© ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß</p>
                                        </div>
                                    ) : (
                                        <div>
                                            {(supplierOrderSearchTerm.trim() === '' ? myArchivedOrders : myArchivedOrders.filter(o => o.storeName.toLowerCase().includes(supplierOrderSearchTerm.toLowerCase().trim()))).sort((a, b) => new Date(b.archivedAt) - new Date(a.archivedAt)).map(order => (
                                                <div key={order.id} style={{background: '#f5f5f5', padding: '1.5rem', borderRadius: '12px', border: '1px solid #ccc', marginBottom: '1rem'}}>
                                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem'}}>
                                                        <div>
                                                            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem', flexWrap: 'wrap'}}>
                                                                <h3>{order.orderNumber}</h3>
                                                                <span className="product-badge badge-info">ŸÖÿ§ÿ±ÿ¥ŸÅ</span>
                                                                {order.mainOrderNumber && order.mainOrderNumber !== order.orderNumber && (
                                                                    <span className="product-badge badge-warning" style={{fontSize: '0.75rem'}}>
                                                                        üì¶ ÿ¨ÿ≤ÿ° ŸÖŸÜ ÿ∑ŸÑÿ® ŸÖÿ¥ÿ™ÿ±ŸÉ
                                                                    </span>
                                                                )}
                                                            </div>
                                                            <p style={{color: '#666', marginTop: '0.5rem'}}>
                                                                <strong>ÿßŸÑŸÖÿ™ÿ¨ÿ±:</strong> {order.storeName}<br/>
                                                                {order.mainOrderNumber && order.mainOrderNumber !== order.orderNumber && (
                                                                    <><strong>ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä:</strong> {order.mainOrderNumber}<br/></>
                                                                )}
                                                                <strong>ÿßŸÑŸÖÿ®ŸÑÿ∫:</strong> {order.total.toLocaleString()} ÿØ.ÿπ<br/>
                                                                <strong>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ŸÑÿ®:</strong> {new Date(order.date).toLocaleDateString('ar-IQ')}<br/>
                                                                <strong>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ£ÿ±ÿ¥ŸÅÿ©:</strong> {new Date(order.archivedAt).toLocaleDateString('ar-IQ')}<br/>
                                                                <strong>ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©:</strong> 
                                                                <span className={`product-badge ${
                                                                    order.deliveryStatus === 'delivered' ? 'badge-success' :
                                                                    order.deliveryStatus === 'cancelled' ? 'badge-danger' :
                                                                    'badge-info'
                                                                }`} style={{marginRight: '0.5rem'}}>
                                                                    {getStatusNote(order.deliveryStatus || 'pending')}
                                                                </span>
                                                            </p>
                                                        </div>
                                                        <div style={{display: 'flex', gap: '0.5rem', flexDirection: 'column'}}>
                                                            <button className="btn btn-primary" onClick={() => { setSelectedOrder(order); setShowOrderDetail(true); }}>
                                                                ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
                                                            </button>
                                                            <button className="btn btn-secondary" onClick={() => printInvoice(order)}>
                                                                üñ®Ô∏è ÿ∑ÿ®ÿßÿπÿ©
                                                            </button>
                                                            <button className="btn" style={{background: '#4caf50', color: 'white'}} onClick={() => unarchiveOrder(order.id)}>
                                                                ‚Ü©Ô∏è ÿßÿ≥ÿ™ÿπÿßÿØÿ©
                                                            </button>
                                                            <button className="btn btn-danger" onClick={() => deleteArchivedOrder(order.id)}>
                                                                üóëÔ∏è ÿ≠ÿ∞ŸÅ ŸÜŸáÿßÿ¶Ÿä
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )
                                )}
                            </div>
                        )}

                        {currentTab === 'products' && currentSupplier && (
                            <div className="section">
                                <div style={{background: '#e3f2fd', padding: '1rem', borderRadius: '8px', marginBottom: '1.5rem', border: '2px solid #2196f3'}}>
                                    <h4 style={{color: '#1976d2', marginBottom: '0.5rem'}}>ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸàÿ±ÿØ</h4>
                                    <div style={{fontSize: '0.9rem', color: '#666'}}>
                                        <strong>ÿßÿ≥ŸÖ ÿßŸÑÿ¥ÿ±ŸÉÿ©:</strong> {currentSupplier.companyName}<br/>
                                        <strong>ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ:</strong> {currentSupplier.username}<br/>
                                        <strong>ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖŸàÿ±ÿØ:</strong> {currentSupplier.id}<br/>
                                        <strong>ÿπÿØÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™Ÿä:</strong> {products.filter(p => p.supplierId === currentSupplier.id).length}
                                    </div>
                                </div>
                                
                                <h2>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</h2>
                                
                                {isEditing && (
                                    <div style={{background: '#fff3cd', padding: '1rem', borderRadius: '8px', marginBottom: '1rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                        <strong>üîÑ Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿπÿØŸäŸÑ</strong>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => {
                                                setIsEditing(false);
                                                setEditingProductId(null);
                                                setNewProduct({ name: '', company: '', category: '', price: '', unit: '', stock: '', expiryDate: '', images: [], imagePreviews: [] });
                                            }}
                                        >
                                            ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿπÿØŸäŸÑ
                                        </button>
                                    </div>
                                )}
                                
                                <form onSubmit={handleAddProduct} style={{marginBottom: '2rem', padding: '1.5rem', background: '#f9f9f9', borderRadius: '12px'}}>
                                    <h3 style={{marginBottom: '1rem'}}>{isEditing ? 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨' : 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨ ÿ¨ÿØŸäÿØ'}</h3>
                                    
                                    <div style={{background: '#e3f2fd', padding: '0.8rem', borderRadius: '8px', marginBottom: '1.5rem', border: '1px solid #2196f3'}}>
                                        <p style={{color: '#1976d2', fontSize: '0.9rem', margin: 0}}>
                                            ‚ÑπÔ∏è <strong>ŸÖŸÑÿßÿ≠ÿ∏ÿ©:</strong> ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßÿÆÿ™Ÿäÿßÿ±Ÿäÿ© - ÿßŸÖŸÑÿ£ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÑÿØŸäŸÉ ŸÅŸÇÿ∑
                                        </p>
                                    </div>
                                    
                                    {!isEditing && (
                                        <div style={{marginBottom: '1.5rem', display: 'flex', gap: '1rem', flexWrap: 'wrap'}}>
                                            <button 
                                                type="button" 
                                                className="btn scan-btn" 
                                                onClick={startScanner}
                                                style={{flex: 1, minWidth: '200px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem'}}
                                            >
                                                üì∑ ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ
                                            </button>
                                            <button 
                                                type="button" 
                                                className="btn btn-secondary"
                                                onClick={manualBarcodeEntry}
                                                style={{flex: 1, minWidth: '200px'}}
                                            >
                                                ‚å®Ô∏è ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ ŸäÿØŸàŸäÿßŸã
                                            </button>
                                        </div>
                                    )}
                                    
                                    {scannedBarcode && (
                                        <div className="barcode-result">
                                            <strong>‚úì ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ:</strong> {scannedBarcode}
                                            <button 
                                                type="button" 
                                                onClick={() => setScannedBarcode('')}
                                                style={{marginRight: '1rem', background: 'none', border: 'none', color: '#c62828', cursor: 'pointer', fontSize: '1.2rem'}}
                                            >
                                                √ó
                                            </button>
                                        </div>
                                    )}
                                    
                                    <div className="form-group">
                                        <label>ÿµŸàÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                                        
                                        {isUploadingImages && (
                                            <div style={{
                                                marginBottom: '1rem',
                                                padding: '1rem',
                                                background: '#e3f2fd',
                                                borderRadius: '8px',
                                                border: '1px solid #2196f3'
                                            }}>
                                                <div style={{display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '0.5rem'}}>
                                                    <div style={{fontSize: '1.5rem'}}>‚è≥</div>
                                                    <div style={{flex: 1}}>
                                                        <div style={{marginBottom: '0.3rem', color: '#1976d2', fontWeight: 'bold'}}>
                                                            ÿ¨ÿßÿ±Ÿä ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±...
                                                        </div>
                                                        <div style={{
                                                            width: '100%',
                                                            height: '8px',
                                                            background: '#bbdefb',
                                                            borderRadius: '4px',
                                                            overflow: 'hidden'
                                                        }}>
                                                            <div style={{
                                                                width: `${uploadProgress}%`,
                                                                height: '100%',
                                                                background: '#2196f3',
                                                                transition: 'width 0.3s ease'
                                                            }} />
                                                        </div>
                                                        <div style={{marginTop: '0.3rem', fontSize: '0.85rem', color: '#666'}}>
                                                            {uploadProgress}%
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        
                                        {/* Input ŸÑŸÑŸÉÿßŸÖŸäÿ±ÿß */}
                                        <input 
                                            type="file" 
                                            accept="image/*" 
                                            capture="environment"
                                            multiple 
                                            onChange={handleImageUpload}
                                            style={{display: 'none'}}
                                            id="image-upload-camera"
                                            disabled={isUploadingImages}
                                        />
                                        
                                        {/* Input ŸÑŸÑŸÖÿπÿ±ÿ∂ */}
                                        <input 
                                            type="file" 
                                            accept="image/jpeg,image/jpg,image/png,image/webp,image/gif" 
                                            multiple 
                                            onChange={handleImageUpload}
                                            style={{display: 'none'}}
                                            id="image-upload-gallery"
                                            disabled={isUploadingImages}
                                        />
                                        
                                        {/* ŸÖŸÜÿ∑ŸÇÿ© ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿµÿØÿ± */}
                                        <div style={{
                                            display: 'grid',
                                            gridTemplateColumns: 'repeat(2, 1fr)',
                                            gap: '1rem',
                                            marginBottom: '1rem'
                                        }}>
                                            {/* ÿ≤ÿ± ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß */}
                                            <label 
                                                htmlFor="image-upload-camera" 
                                                className="image-source-btn"
                                                style={{
                                                    display: 'flex',
                                                    flexDirection: 'column',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    padding: '2rem 1rem',
                                                    border: '2px solid #ddd',
                                                    borderRadius: '12px',
                                                    background: 'linear-gradient(135deg, #fff 0%, #f5f5f5 100%)',
                                                    cursor: isUploadingImages ? 'not-allowed' : 'pointer',
                                                    opacity: isUploadingImages ? 0.6 : 1,
                                                    transition: 'all 0.3s',
                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                                                }}
                                                onMouseEnter={(e) => {
                                                    if (!isUploadingImages) {
                                                        e.currentTarget.style.borderColor = '#2c5f2d';
                                                        e.currentTarget.style.background = 'linear-gradient(135deg, #f0f8f0 0%, #e8f5e9 100%)';
                                                        e.currentTarget.style.transform = 'translateY(-4px)';
                                                        e.currentTarget.style.boxShadow = '0 6px 12px rgba(0,0,0,0.15)';
                                                    }
                                                }}
                                                onMouseLeave={(e) => {
                                                    e.currentTarget.style.borderColor = '#ddd';
                                                    e.currentTarget.style.background = 'linear-gradient(135deg, #fff 0%, #f5f5f5 100%)';
                                                    e.currentTarget.style.transform = 'translateY(0)';
                                                    e.currentTarget.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
                                                }}
                                            >
                                                <div style={{fontSize: '3rem', marginBottom: '0.5rem'}}>üì∏</div>
                                                <div style={{fontWeight: 'bold', fontSize: '1.1rem', color: '#333', marginBottom: '0.3rem', textAlign: 'center'}}>
                                                    ÿßŸÑÿ™ŸÇÿßÿ∑ ŸÖŸÜ ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß
                                                </div>
                                                <div style={{fontSize: '0.85rem', color: '#666', textAlign: 'center'}}>
                                                    ÿßŸÅÿ™ÿ≠ ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß ŸàÿßŸÑÿ™ŸÇÿ∑ ÿµŸàÿ±ÿ©
                                                </div>
                                            </label>
                                            
                                            {/* ÿ≤ÿ± ÿßŸÑŸÖÿπÿ±ÿ∂ */}
                                            <label 
                                                htmlFor="image-upload-gallery" 
                                                className="image-source-btn"
                                                style={{
                                                    display: 'flex',
                                                    flexDirection: 'column',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    padding: '2rem 1rem',
                                                    border: '2px solid #ddd',
                                                    borderRadius: '12px',
                                                    background: 'linear-gradient(135deg, #fff 0%, #f5f5f5 100%)',
                                                    cursor: isUploadingImages ? 'not-allowed' : 'pointer',
                                                    opacity: isUploadingImages ? 0.6 : 1,
                                                    transition: 'all 0.3s',
                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                                                }}
                                                onMouseEnter={(e) => {
                                                    if (!isUploadingImages) {
                                                        e.currentTarget.style.borderColor = '#2c5f2d';
                                                        e.currentTarget.style.background = 'linear-gradient(135deg, #f0f8f0 0%, #e8f5e9 100%)';
                                                        e.currentTarget.style.transform = 'translateY(-4px)';
                                                        e.currentTarget.style.boxShadow = '0 6px 12px rgba(0,0,0,0.15)';
                                                    }
                                                }}
                                                onMouseLeave={(e) => {
                                                    e.currentTarget.style.borderColor = '#ddd';
                                                    e.currentTarget.style.background = 'linear-gradient(135deg, #fff 0%, #f5f5f5 100%)';
                                                    e.currentTarget.style.transform = 'translateY(0)';
                                                    e.currentTarget.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
                                                }}
                                            >
                                                <div style={{fontSize: '3rem', marginBottom: '0.5rem'}}>üñºÔ∏è</div>
                                                <div style={{fontWeight: 'bold', fontSize: '1.1rem', color: '#333', marginBottom: '0.3rem', textAlign: 'center'}}>
                                                    ÿßÿÆÿ™ÿ± ŸÖŸÜ ÿßŸÑŸÖÿπÿ±ÿ∂
                                                </div>
                                                <div style={{fontSize: '0.85rem', color: '#666', textAlign: 'center'}}>
                                                    ÿßÿÆÿ™ÿ± ÿµŸàÿ± ŸÖŸÜ ÿ¨Ÿáÿßÿ≤ŸÉ
                                                </div>
                                            </label>
                                        </div>
                                        
                                        <div style={{
                                            background: '#e8f5e9',
                                            padding: '0.8rem 1rem',
                                            borderRadius: '8px',
                                            border: '1px solid #4caf50',
                                            marginBottom: '1rem'
                                        }}>
                                            <div style={{fontSize: '0.8rem', color: '#2e7d32', lineHeight: '1.5'}}>
                                                üí° <strong>ŸÖÿπŸÑŸàŸÖÿßÿ™:</strong> ÿ≠ÿ™Ÿâ 10 ÿµŸàÿ± ‚Ä¢ ÿ≠ÿ¨ŸÖ ÿßŸÑÿµŸàÿ±ÿ© ÿ≠ÿ™Ÿâ 10MB ‚Ä¢ ÿßŸÑÿ£ŸÜŸàÿßÿπ ÿßŸÑŸÖÿØÿπŸàŸÖÿ©: JPG, PNG, WEBP, GIF
                                            </div>
                                        </div>
                                        {newProduct.imagePreviews.length > 0 && (
                                            <div style={{marginTop: '1rem'}}>
                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem'}}>
                                                    <span style={{fontSize: '0.9rem', color: '#666'}}>
                                                        ÿπÿØÿØ ÿßŸÑÿµŸàÿ±: {newProduct.imagePreviews.length}/10
                                                    </span>
                                                    <button
                                                        type="button"
                                                        onClick={() => setNewProduct(prev => ({...prev, images: [], imagePreviews: []}))}
                                                        style={{
                                                            background: '#c62828',
                                                            color: 'white',
                                                            border: 'none',
                                                            padding: '0.4rem 0.8rem',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '0.85rem'
                                                        }}
                                                    >
                                                        üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿßŸÑŸÉŸÑ
                                                    </button>
                                                </div>
                                                <div className="images-preview-grid">
                                                    {newProduct.imagePreviews.map((preview, i) => (
                                                        <div key={i} className="preview-image-item">
                                                            {typeof preview === 'string' && preview.startsWith('data:image') ? (
                                                                <img src={preview} alt={`ŸÖÿπÿßŸäŸÜÿ© ${i + 1}`} />
                                                            ) : preview.startsWith('http') ? (
                                                                <img src={preview} alt={`ŸÖÿπÿßŸäŸÜÿ© ${i + 1}`} />
                                                            ) : (
                                                                <div style={{width: '100%', height: '100px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '3rem', background: '#f5f5f5', borderRadius: '8px'}}>
                                                                    {preview}
                                                                </div>
                                                            )}
                                                            <button 
                                                                type="button" 
                                                                className="remove-preview-btn" 
                                                                onClick={() => removeImage(i)}
                                                                title="ÿ≠ÿ∞ŸÅ ÿßŸÑÿµŸàÿ±ÿ©"
                                                            >
                                                                √ó
                                                            </button>
                                                            <div style={{
                                                                position: 'absolute',
                                                                bottom: '5px',
                                                                right: '5px',
                                                                background: 'rgba(0,0,0,0.6)',
                                                                color: 'white',
                                                                padding: '0.2rem 0.4rem',
                                                                borderRadius: '4px',
                                                                fontSize: '0.7rem'
                                                            }}>
                                                                {i + 1}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem'}}>
                                        <div className="form-group">
                                            <label>ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨</label>
                                            <input 
                                                type="text" 
                                                value={newProduct.name}
                                                onChange={(e) => setNewProduct({...newProduct, name: e.target.value})}
                                                placeholder="ŸÖÿ´ÿßŸÑ: ÿ≠ŸÑŸäÿ® ÿ∑ÿßÿ≤ÿ¨"
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>ÿßŸÑÿ¥ÿ±ŸÉÿ© ÿßŸÑŸÖÿµŸÜÿπÿ©</label>
                                            <input 
                                                type="text" 
                                                value={newProduct.company}
                                                onChange={(e) => setNewProduct({...newProduct, company: e.target.value})}
                                                placeholder="ŸÖÿ´ÿßŸÑ: ÿ¥ÿ±ŸÉÿ© ÿßŸÑÿ£ŸÑÿ®ÿßŸÜ"
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>ÿßŸÑÿ™ÿµŸÜŸäŸÅ</label>
                                            <div style={{display: 'flex', gap: '0.5rem'}}>
                                                <select 
                                                    value={newProduct.category}
                                                    onChange={(e) => setNewProduct({...newProduct, category: e.target.value})}
                                                    style={{flex: 1}}
                                                >
                                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ™ÿµŸÜŸäŸÅ</option>
                                                    {categories.filter(c => c !== 'ÿßŸÑŸÉŸÑ').map(cat => (
                                                        <option key={cat} value={cat}>{cat}</option>
                                                    ))}
                                                </select>
                                                <button 
                                                    type="button"
                                                    className="btn btn-secondary"
                                                    onClick={() => {
                                                        const newCat = prompt('ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ¨ÿØŸäÿØ:');
                                                        if (newCat && newCat.trim()) {
                                                            if (categories.includes(newCat.trim())) {
                                                                alert('Ÿáÿ∞ÿß ÿßŸÑÿ™ÿµŸÜŸäŸÅ ŸÖŸàÿ¨ŸàÿØ ÿ®ÿßŸÑŸÅÿπŸÑ!');
                                                            } else {
                                                                setCategories([...categories, newCat.trim()]);
                                                                setNewProduct({...newProduct, category: newCat.trim()});
                                                                alert('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ: ' + newCat.trim());
                                                            }
                                                        }
                                                    }}
                                                    style={{padding: '0.8rem 1rem', whiteSpace: 'nowrap'}}
                                                >
                                                    ‚ûï ÿ¨ÿØŸäÿØ
                                                </button>
                                            </div>
                                        </div>
                                        <div className="form-group">
                                            <label>ÿßŸÑÿ≥ÿπÿ± (ÿØ.ÿπ)</label>
                                            <input 
                                                type="number" 
                                                value={newProduct.price}
                                                onChange={(e) => setNewProduct({...newProduct, price: e.target.value})}
                                                placeholder="5000"
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>ÿßŸÑŸàÿ≠ÿØÿ©</label>
                                            <input 
                                                type="text" 
                                                value={newProduct.unit}
                                                onChange={(e) => setNewProduct({...newProduct, unit: e.target.value})}
                                                placeholder="ÿπŸÑÿ®ÿ© 1 ŸÑÿ™ÿ±"
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>ÿßŸÑŸÉŸÖŸäÿ©</label>
                                            <input 
                                                type="number" 
                                                value={newProduct.stock}
                                                onChange={(e) => setNewProduct({...newProduct, stock: e.target.value})}
                                                placeholder="100"
                                            />
                                        </div>
                                        <div className="form-group" style={{gridColumn: '1 / -1'}}>
                                            <label>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©</label>
                                            <input 
                                                type="date" 
                                                value={newProduct.expiryDate}
                                                onChange={(e) => setNewProduct({...newProduct, expiryDate: e.target.value})}
                                                min={new Date().toISOString().split('T')[0]}
                                            />
                                        </div>
                                    </div>
                                    
                                    <button type="submit" className="btn btn-primary" style={{marginTop: '1rem', width: '100%', padding: '1rem', fontSize: '1.1rem'}}>
                                        {isEditing ? 'üíæ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÜÿ™ÿ¨' : '‚úì ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨'}
                                    </button>
                                </form>

                                <h3 style={{marginBottom: '1rem'}}>ŸÖŸÜÿ™ÿ¨ÿßÿ™Ÿä ({products.filter(p => p.supplierId === currentSupplier.id).length})</h3>
                                {products.filter(p => p.supplierId === currentSupplier.id).length === 0 ? (
                                    <div className="empty-state">
                                        <div className="empty-state-icon">üì¶</div>
                                        <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™</h3>
                                        <p>ÿßÿ®ÿØÿ£ ÿ®ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨ŸÉ ÿßŸÑÿ£ŸàŸÑ</p>
                                        <p style={{fontSize: '0.85rem', color: '#999', marginTop: '1rem'}}>
                                            ŸÖÿπÿ±ŸÅŸÉ: {currentSupplier.id}
                                        </p>
                                    </div>
                                ) : (
                                    <div className="products-grid">
                                        {products.filter(p => p.supplierId === currentSupplier.id).map(product => (
                                            <div key={product.id} className="product-card">
                                                <div className="product-image">
                                                    <ImageSlider images={product.images || [product.image || 'üì¶']} />
                                                </div>
                                                <div className="product-name">{product.name}</div>
                                                <div className="product-company">{product.company}</div>
                                                <div className="product-badges">
                                                    <span className="product-badge badge-info">ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ: {product.stock}</span>
                                                    <ExpiryBadge expiryDate={product.expiryDate} />
                                                </div>
                                                <div className="product-price">{product.price.toLocaleString()} ÿØ.ÿπ</div>
                                                <small>{product.unit}</small>
                                                <div style={{fontSize: '0.75rem', color: '#999', marginTop: '0.5rem'}}>
                                                    ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨: {product.supplierId}
                                                </div>
                                                <div style={{marginTop: '1rem', display: 'flex', gap: '0.5rem'}}>
                                                    <button className="btn btn-primary" style={{flex: 1}} onClick={() => editProduct(product)}>
                                                        ‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ
                                                    </button>
                                                    <button className="btn btn-danger" onClick={() => deleteProduct(product.id)}>
                                                        üóëÔ∏è ÿ≠ÿ∞ŸÅ
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {currentTab === 'adminPanel' && admin && (
                            <div className="section">
                                <h2 style={{color: '#1a237e', marginBottom: '2rem'}}>üîê ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ©</h2>
                                
                                <div className="admin-tabs">
                                    <button 
                                        className={`admin-tab ${adminTab === 'suppliers' ? 'active' : ''}`}
                                        onClick={() => setAdminTab('suppliers')}
                                    >
                                        ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ
                                    </button>
                                    <button 
                                        className={`admin-tab ${adminTab === 'products' ? 'active' : ''}`}
                                        onClick={() => setAdminTab('products')}
                                    >
                                        ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
                                    </button>
                                    <button 
                                        className={`admin-tab ${adminTab === 'orders' ? 'active' : ''}`}
                                        onClick={() => setAdminTab('orders')}
                                    >
                                        ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™
                                    </button>
                                    <button 
                                        className={`admin-tab ${adminTab === 'delivery' ? 'active' : ''}`}
                                        onClick={() => setAdminTab('delivery')}
                                    >
                                        ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸàÿßŸÑÿ¥ÿ≠ŸÜ
                                    </button>
                                    <button 
                                        className={`admin-tab ${adminTab === 'categories' ? 'active' : ''}`}
                                        onClick={() => setAdminTab('categories')}
                                    >
                                        ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™
                                    </button>
                                    <button 
                                        className={`admin-tab ${adminTab === 'system' ? 'active' : ''}`}
                                        onClick={() => setAdminTab('system')}
                                        style={{background: '#c62828', color: 'white'}}
                                    >
                                        ‚öôÔ∏è ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ
                                    </button>
                                </div>

                                {adminTab === 'suppliers' && (() => {
                                    const allSuppliers = suppliers;
                                    const pendingSuppliers = allSuppliers.filter(s => s.status === 'pending');
                                    const activeSuppliers = allSuppliers.filter(s => s.status === 'active');
                                    const inactiveSuppliers = allSuppliers.filter(s => s.status === 'inactive');
                                    
                                    return (
                                        <div>
                                            {pendingSuppliers.length > 0 && (
                                                <div style={{marginBottom: '2rem'}}>
                                                    <h3 style={{color: '#f57c00', marginBottom: '1rem'}}>‚è∞ ÿ∑ŸÑÿ®ÿßÿ™ ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ({pendingSuppliers.length})</h3>
                                                    {pendingSuppliers.map(s => {
                                                        const supplierOrders = getSupplierOrders(s.id);
                                                        return (
                                                            <div key={s.id} className="supplier-card pending">
                                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem'}}>
                                                                    <div>
                                                                        <h3>üè≠ {s.companyName}</h3>
                                                                        <p style={{color: '#666'}}>
                                                                            <strong>ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ:</strong> {s.username}<br/>
                                                                            <strong>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ:</strong> {new Date(s.createdAt).toLocaleDateString('ar-IQ')}<br/>
                                                                            {supplierOrders.total > 0 && <><strong>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™:</strong> {supplierOrders.total}<br/></>}
                                                                        </p>
                                                                    </div>
                                                                    <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                                                                        {supplierOrders.total > 0 && (
                                                                            <button 
                                                                                className="btn" 
                                                                                style={{background: '#2196f3', color: 'white'}}
                                                                                onClick={() => { 
                                                                                    setSelectedSupplier(s); 
                                                                                    setShowSupplierOrders(true); 
                                                                                }}
                                                                            >
                                                                                üìã ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ({supplierOrders.total})
                                                                            </button>
                                                                        )}
                                                                        <button className="btn btn-primary" onClick={() => approveSupplier(s.id)}>‚úì ŸÖŸàÿßŸÅŸÇÿ©</button>
                                                                        <button className="btn btn-danger" onClick={() => rejectSupplier(s.id)}>‚úó ÿ±ŸÅÿ∂</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            )}

                                            {activeSuppliers.length > 0 && (
                                                <div style={{marginBottom: '2rem'}}>
                                                    <h3 style={{color: '#2e7d32', marginBottom: '1rem'}}>‚úì ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ ÿßŸÑŸÜÿ¥ÿ∑ŸäŸÜ ({activeSuppliers.length})</h3>
                                                    {activeSuppliers.map(s => {
                                                        const supplierOrders = getSupplierOrders(s.id);
                                                        return (
                                                            <div key={s.id} className="supplier-card">
                                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem'}}>
                                                                    <div>
                                                                        <h3>üè≠ {s.companyName}</h3>
                                                                        <p style={{color: '#666'}}>
                                                                            <strong>ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ:</strong> {s.username}<br/>
                                                                            <strong>ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™:</strong> {products.filter(p => p.supplierId === s.id).length}<br/>
                                                                            <strong>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™:</strong> {supplierOrders.total} (ŸÜÿ¥ÿ∑ÿ©: {supplierOrders.active.length}, ŸÖÿ§ÿ±ÿ¥ŸÅÿ©: {supplierOrders.archived.length})
                                                                        </p>
                                                                        <span className="product-badge badge-success">‚úì ŸÜÿ¥ÿ∑</span>
                                                                    </div>
                                                                    <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                                                                        <button 
                                                                            className="btn btn-primary" 
                                                                            onClick={() => { 
                                                                                setSelectedSupplier(s); 
                                                                                setShowSupplierOrders(true); 
                                                                            }}
                                                                        >
                                                                            üìã ÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ({supplierOrders.total})
                                                                        </button>
                                                                        <button className="btn btn-secondary" onClick={() => toggleSupplierStatus(s.id, s.status)}>ÿ™ÿπÿ∑ŸäŸÑ</button>
                                                                        <button className="btn btn-danger" onClick={() => deleteSupplier(s.id)}>ÿ≠ÿ∞ŸÅ</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            )}

                                            {inactiveSuppliers.length > 0 && (
                                                <div>
                                                    <h3 style={{color: '#c62828', marginBottom: '1rem'}}>‚úó ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ ÿßŸÑŸÖÿπÿ∑ŸÑŸäŸÜ ({inactiveSuppliers.length})</h3>
                                                    {inactiveSuppliers.map(s => {
                                                        const supplierOrders = getSupplierOrders(s.id);
                                                        return (
                                                            <div key={s.id} className="supplier-card inactive">
                                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem'}}>
                                                                    <div>
                                                                        <h3>üè≠ {s.companyName}</h3>
                                                                        <p style={{color: '#666'}}>
                                                                            <strong>ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ:</strong> {s.username}<br/>
                                                                            {supplierOrders.total > 0 && <><strong>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™:</strong> {supplierOrders.total}<br/></>}
                                                                        </p>
                                                                        <span className="product-badge badge-danger">‚úó ŸÖÿπÿ∑ŸÑ</span>
                                                                    </div>
                                                                    <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                                                                        {supplierOrders.total > 0 && (
                                                                            <button 
                                                                                className="btn" 
                                                                                style={{background: '#2196f3', color: 'white'}}
                                                                                onClick={() => { 
                                                                                    setSelectedSupplier(s); 
                                                                                    setShowSupplierOrders(true); 
                                                                                }}
                                                                            >
                                                                                üìã ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ({supplierOrders.total})
                                                                            </button>
                                                                        )}
                                                                        <button className="btn btn-primary" onClick={() => toggleSupplierStatus(s.id, s.status)}>ÿ™ŸÅÿπŸäŸÑ</button>
                                                                        <button className="btn btn-danger" onClick={() => deleteSupplier(s.id)}>ÿ≠ÿ∞ŸÅ</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            )}

                                            {allSuppliers.length === 0 && (
                                                <div className="empty-state">
                                                    <div className="empty-state-icon">üè≠</div>
                                                    <h3>ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸàÿ±ÿØŸäŸÜ</h3>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })()}

                                {adminTab === 'products' && (
                                    <div>
                                        <h3 style={{marginBottom: '1rem'}}>ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ({products.length})</h3>
                                        {products.length === 0 ? (
                                            <div className="empty-state">
                                                <div className="empty-state-icon">üì¶</div>
                                                <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™</h3>
                                            </div>
                                        ) : (
                                            <div className="products-grid">
                                                {products.map(p => {
                                                    const allSuppliers = suppliers;
                                                    const supplierInfo = allSuppliers.find(s => s.id === p.supplierId);
                                                    return (
                                                        <div key={p.id} className="product-card">
                                                            <div className="product-image">
                                                                <ImageSlider images={p.images || [p.image || 'üì¶']} />
                                                            </div>
                                                            <div className="product-name">{p.name}</div>
                                                            <div className="product-company">{p.company}</div>
                                                            <div style={{fontSize: '0.85rem', color: '#666', marginBottom: '0.5rem'}}>
                                                                <strong>ÿßŸÑŸÖŸàÿ±ÿØ:</strong> {supplierInfo?.companyName || 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ'}
                                                            </div>
                                                            <div className="product-price">{p.price.toLocaleString()} ÿØ.ÿπ</div>
                                                            <small>ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ: {p.stock}</small>
                                                            <button 
                                                                className="btn btn-danger" 
                                                                style={{width: '100%', marginTop: '1rem'}}
                                                                onClick={() => deleteProductAdmin(p.id)}
                                                            >
                                                                üóëÔ∏è ÿ≠ÿ∞ŸÅ
                                                            </button>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {adminTab === 'orders' && (
                                    <div>
                                        {/* ÿ¨ÿØŸäÿØ: ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ™ÿ¨ÿ± */}
                                        <div style={{background: '#f5f7fa', padding: '1rem', borderRadius: '12px', marginBottom: '1.5rem', border: '2px solid #e0e0e0'}}>
                                            <input 
                                                type="text"
                                                value={orderSearchTerm}
                                                onChange={(e) => setOrderSearchTerm(e.target.value)}
                                                placeholder="üîç ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ™ÿ¨ÿ±..."
                                                style={{width: '100%', padding: '1rem 1.5rem', border: '2px solid #ddd', borderRadius: '10px', fontSize: '1rem', background: 'white'}}
                                                onFocus={(e) => e.target.style.borderColor = '#1a237e'}
                                                onBlur={(e) => e.target.style.borderColor = '#ddd'}
                                            />
                                        </div>
                                        {orderSearchTerm.trim() !== '' && (
                                            <div style={{background: '#e3f2fd', padding: '0.5rem 1rem', borderRadius: '6px', marginBottom: '1rem', color: '#1976d2', fontWeight: 'bold', textAlign: 'center'}}>
                                                üìä ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ {orders.filter(o => o.storeName.toLowerCase().includes(orderSearchTerm.toLowerCase().trim())).length} ÿ∑ŸÑÿ®(ÿßÿ™)
                                            </div>
                                        )}
                                        
                                        <h3 style={{marginBottom: '1rem'}}>ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ({orderSearchTerm.trim() === '' ? orders.length : orders.filter(o => o.storeName.toLowerCase().includes(orderSearchTerm.toLowerCase().trim())).length})</h3>
                                        {(orderSearchTerm.trim() === '' ? orders : orders.filter(o => o.storeName.toLowerCase().includes(orderSearchTerm.toLowerCase().trim()))).length === 0 ? (
                                            <div className="empty-state">
                                                <div className="empty-state-icon">üì¶</div>
                                                <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™</h3>
                                                {orderSearchTerm.trim() !== '' && <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÑŸÑÿ®ÿ≠ÿ´</p>}
                                            </div>
                                        ) : (
                                            <div>
                                                {(orderSearchTerm.trim() === '' ? orders : orders.filter(o => o.storeName.toLowerCase().includes(orderSearchTerm.toLowerCase().trim()))).sort((a, b) => new Date(b.date) - new Date(a.date)).map(o => (
                                                    <div key={o.id} style={{background: 'white', padding: '1.5rem', borderRadius: '12px', border: '1px solid #ddd', marginBottom: '1rem'}}>
                                                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem'}}>
                                                            <div>
                                                                <h3>{o.orderNumber}</h3>
                                                                <p style={{color: '#666'}}>
                                                                    <strong>ÿßŸÑŸÖÿ™ÿ¨ÿ±:</strong> {o.storeName}<br/>
                                                                    {o.buyerStoreName && o.buyerStoreName !== o.storeName && (
                                                                        <span style={{fontSize: '0.85rem', color: '#1976d2'}}>üè™ ÿ≠ÿ≥ÿßÿ®: {o.buyerStoreName}<br/></span>
                                                                    )}
                                                                    <strong>ÿßŸÑŸÖÿ®ŸÑÿ∫:</strong> {o.total.toLocaleString()} ÿØ.ÿπ
                                                                </p>
                                                            </div>
                                                            <button className="btn btn-primary" onClick={() => { setSelectedOrder(o); setShowOrderDetail(true); }}>
                                                                ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {adminTab === 'delivery' && (
                                    <div>
                                        <h3 style={{marginBottom: '1.5rem', color: '#1a237e'}}>üöö ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸàÿßŸÑÿ¥ÿ≠ŸÜ</h3>
                                        
                                        <div style={{marginBottom: '2rem'}}>
                                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem'}}>
                                                <h4>ÿßŸÑÿ≥ÿßÿ¶ŸÇŸäŸÜ ({deliveryDrivers.length})</h4>
                                                <button className="btn btn-primary" onClick={addDeliveryDriver}>
                                                    ‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿßÿ¶ŸÇ
                                                </button>
                                            </div>
                                            
                                            {deliveryDrivers.length === 0 ? (
                                                <div className="empty-state">
                                                    <div className="empty-state-icon">üöó</div>
                                                    <h3>ŸÑÿß ŸäŸàÿ¨ÿØ ÿ≥ÿßÿ¶ŸÇŸäŸÜ</h3>
                                                    <p>ÿ£ÿ∂ŸÅ ÿ≥ÿßÿ¶ŸÇŸäŸÜ ŸÑÿ™ÿπŸäŸäŸÜŸáŸÖ ÿπŸÑŸâ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™</p>
                                                </div>
                                            ) : (
                                                <div style={{display: 'grid', gap: '1rem'}}>
                                                    {deliveryDrivers.map(driver => (
                                                        <div key={driver.id} style={{background: 'white', padding: '1rem', borderRadius: '8px', border: '1px solid #ddd', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                                            <div>
                                                                <h4>üöó {driver.name}</h4>
                                                                <p style={{color: '#666', fontSize: '0.9rem'}}>
                                                                    üì± {driver.phone} | üöô {driver.vehicle}
                                                                </p>
                                                            </div>
                                                            <button 
                                                                className="btn btn-danger"
                                                                onClick={() => {
                                                                    if (confirm('ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿßÿ¶ŸÇ: ' + driver.name + 'ÿü')) {
                                                                        setDeliveryDrivers(deliveryDrivers.filter(d => d.id !== driver.id));
                                                                    }
                                                                }}
                                                            >
                                                                üóëÔ∏è ÿ≠ÿ∞ŸÅ
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        
                                        <div>
                                            <h4 style={{marginBottom: '1rem'}}>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÜÿ¥ÿ∑ÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ≠ÿ™ÿßÿ¨ ÿ™ŸàÿµŸäŸÑ ({orders.filter(o => o.deliveryStatus !== 'delivered').length})</h4>
                                            {orders.filter(o => o.deliveryStatus !== 'delivered').length === 0 ? (
                                                <div className="empty-state">
                                                    <div className="empty-state-icon">‚úÖ</div>
                                                    <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ÿ™ÿ≠ÿ™ÿßÿ¨ ÿ™ŸàÿµŸäŸÑ</h3>
                                                </div>
                                            ) : (
                                                <div style={{display: 'grid', gap: '1rem'}}>
                                                    {orders.filter(o => o.deliveryStatus !== 'delivered').sort((a, b) => new Date(b.date) - new Date(a.date)).map(order => (
                                                        <div key={order.id} style={{background: 'white', padding: '1.5rem', borderRadius: '12px', border: '1px solid #ddd'}}>
                                                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '1rem', flexWrap: 'wrap', gap: '1rem'}}>
                                                                <div style={{flex: 1}}>
                                                                    <h4>{order.orderNumber}</h4>
                                                                    <p style={{color: '#666', fontSize: '0.9rem', marginTop: '0.5rem'}}>
                                                                        üè™ {order.storeName}<br/>
                                                                        üë§ {order.ownerName} - üì± {order.phone}<br/>
                                                                        üìç {order.address}<br/>
                                                                        üí∞ {order.total.toLocaleString()} ÿØ.ÿπ<br/>
                                                                        üì¶ ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ: {order.trackingNumber}
                                                                    </p>
                                                                </div>
                                                                <div>
                                                                    <span className={`product-badge ${
                                                                        order.deliveryStatus === 'delivered' ? 'badge-success' :
                                                                        order.deliveryStatus === 'out_for_delivery' ? 'badge-info' :
                                                                        order.deliveryStatus === 'shipped' ? 'badge-warning' :
                                                                        'badge-warning'
                                                                    }`}>
                                                                        {getStatusNote(order.deliveryStatus || 'pending')}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            
                                                            <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                                                                <select 
                                                                    onChange={(e) => {
                                                                        if (e.target.value) {
                                                                            const note = prompt('ŸÖŸÑÿßÿ≠ÿ∏ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä):');
                                                                            updateDeliveryStatus(order.id, e.target.value, note);
                                                                            e.target.value = '';
                                                                        }
                                                                    }}
                                                                    style={{flex: 1, padding: '0.5rem', borderRadius: '6px', border: '2px solid #ddd'}}
                                                                >
                                                                    <option value="">ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ÿßŸÑÿ©</option>
                                                                    <option value="processing">ŸÇŸäÿØ ÿßŸÑÿ™ÿ¨ŸáŸäÿ≤</option>
                                                                    <option value="ready">ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ¥ÿ≠ŸÜ</option>
                                                                    <option value="shipped">ÿ™ŸÖ ÿßŸÑÿ¥ÿ≠ŸÜ</option>
                                                                    <option value="out_for_delivery">ŸÅŸä ÿ∑ÿ±ŸäŸÇŸá ŸÑŸÑÿ™ÿ≥ŸÑŸäŸÖ</option>
                                                                    <option value="delivered">ÿ™ŸÖ ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ</option>
                                                                    <option value="failed">ŸÅÿ¥ŸÑ ÿßŸÑÿ™ŸàÿµŸäŸÑ</option>
                                                                    <option value="returned">ÿ•ÿ±ÿ¨ÿßÿπ</option>
                                                                </select>
                                                                
                                                                {deliveryDrivers.length > 0 && (
                                                                    <select 
                                                                        value={order.driverId || ''}
                                                                        onChange={(e) => {
                                                                            if (e.target.value) {
                                                                                assignDriver(order.id, parseInt(e.target.value));
                                                                            }
                                                                        }}
                                                                        style={{flex: 1, padding: '0.5rem', borderRadius: '6px', border: '2px solid #ddd'}}
                                                                    >
                                                                        <option value="">ÿ™ÿπŸäŸäŸÜ ÿ≥ÿßÿ¶ŸÇ</option>
                                                                        {deliveryDrivers.map(driver => (
                                                                            <option key={driver.id} value={driver.id}>
                                                                                {driver.name} - {driver.vehicle}
                                                                            </option>
                                                                        ))}
                                                                    </select>
                                                                )}
                                                                
                                                                <button 
                                                                    className="btn btn-primary"
                                                                    onClick={() => { setSelectedOrder(order); setShowOrderDetail(true); }}
                                                                >
                                                                    üìã ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
                                                                </button>
                                                            </div>
                                                            
                                                            {order.driverName && (
                                                                <div style={{marginTop: '1rem', padding: '0.5rem', background: '#e3f2fd', borderRadius: '6px', fontSize: '0.9rem'}}>
                                                                    üöó ÿßŸÑÿ≥ÿßÿ¶ŸÇ: <strong>{order.driverName}</strong>
                                                                </div>
                                                            )}
                                                            
                                                            {order.latitude && order.longitude && (
                                                                <div style={{marginTop: '1rem', padding: '0.8rem', background: '#e8f5e9', borderRadius: '6px', border: '1px solid #4caf50'}}>
                                                                    <div style={{fontSize: '0.9rem', marginBottom: '0.5rem'}}>
                                                                        <strong style={{color: '#2e7d32'}}>üìç ŸÖŸàŸÇÿπ ÿßŸÑÿ™ŸàÿµŸäŸÑ GPS</strong>
                                                                    </div>
                                                                    <div style={{fontSize: '0.85rem', color: '#666', marginBottom: '0.5rem'}}>
                                                                        {order.latitude.toFixed(6)}, {order.longitude.toFixed(6)}
                                                                        {order.locationAccuracy && (
                                                                            <> (¬±{Math.round(order.locationAccuracy)}ŸÖ)</>
                                                                        )}
                                                                    </div>
                                                                    <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                                                                        <a 
                                                                            href={`https://www.google.com/maps?q=${order.latitude},${order.longitude}`}
                                                                            target="_blank"
                                                                            rel="noopener noreferrer"
                                                                            className="btn btn-primary"
                                                                            style={{fontSize: '0.8rem', padding: '0.4rem 0.8rem'}}
                                                                        >
                                                                            üó∫Ô∏è Google
                                                                        </a>
                                                                        <a 
                                                                            href={`https://waze.com/ul?ll=${order.latitude},${order.longitude}&navigate=yes`}
                                                                            target="_blank"
                                                                            rel="noopener noreferrer"
                                                                            className="btn btn-secondary"
                                                                            style={{fontSize: '0.8rem', padding: '0.4rem 0.8rem'}}
                                                                        >
                                                                            üöó Waze
                                                                        </a>
                                                                        <button
                                                                            type="button"
                                                                            className="btn btn-secondary"
                                                                            onClick={() => {
                                                                                navigator.clipboard.writeText(`${order.latitude},${order.longitude}`);
                                                                                alert('‚úÖ ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™!');
                                                                            }}
                                                                            style={{fontSize: '0.8rem', padding: '0.4rem 0.8rem'}}
                                                                        >
                                                                            üìã ŸÜÿ≥ÿÆ
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {adminTab === 'categories' && (
                                    <div>
                                        <h3 style={{marginBottom: '1.5rem'}}>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™</h3>
                                        
                                        <div style={{display: 'flex', gap: '1rem', marginBottom: '2rem'}}>
                                            <input 
                                                type="text"
                                                value={newCategory}
                                                onChange={(e) => setNewCategory(e.target.value)}
                                                placeholder="ÿßÿ≥ŸÖ ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ¨ÿØŸäÿØ"
                                                style={{flex: 1, padding: '0.8rem', border: '2px solid #ddd', borderRadius: '8px'}}
                                            />
                                            <button className="btn btn-primary" onClick={addCategory}>
                                                ‚úì ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿµŸÜŸäŸÅ
                                            </button>
                                        </div>

                                        <div>
                                            {categories.map(cat => (
                                                <div key={cat} className="category-item">
                                                    <span>{cat}</span>
                                                    {cat !== 'ÿßŸÑŸÉŸÑ' && (
                                                        <button className="btn btn-danger" onClick={() => deleteCategory(cat)}>
                                                            ÿ≠ÿ∞ŸÅ
                                                        </button>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {adminTab === 'system' && (
                                    <div>
                                        <h3 style={{marginBottom: '1.5rem', color: '#c62828'}}>‚öôÔ∏è ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ</h3>
                                        
                                        <div style={{background: '#ffebee', padding: '1.5rem', borderRadius: '12px', marginBottom: '2rem', border: '2px solid #c62828'}}>
                                            <h4 style={{color: '#c62828', marginBottom: '1rem'}}>‚ö†Ô∏è ÿ™ÿ≠ÿ∞Ÿäÿ±!</h4>
                                            <p style={{color: '#666', marginBottom: '0'}}>
                                                ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿßŸÑÿ™ÿßŸÑŸäÿ© ÿÆÿ∑Ÿäÿ±ÿ© ŸàŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸáÿß. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπŸÖŸÑ ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ŸÇÿ®ŸÑ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©.
                                            </p>
                                        </div>

                                        <div style={{display: 'grid', gap: '1.5rem'}}>
                                            <div style={{background: 'white', padding: '1.5rem', borderRadius: '12px', border: '1px solid #ddd'}}>
                                                <h4 style={{marginBottom: '1rem'}}>üóëÔ∏è ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ</h4>
                                                <p style={{color: '#666', fontSize: '0.9rem', marginBottom: '1rem'}}>
                                                    ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿ≠ÿ≥ÿßÿ®ÿßÿ™ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ (ÿßŸÑŸÜÿ¥ÿ∑ŸäŸÜÿå ÿßŸÑŸÖÿπŸÑŸÇŸäŸÜÿå ŸàÿßŸÑŸÖÿπÿ∑ŸÑŸäŸÜ). ŸÑŸÜ ÿ™ÿ™ÿ£ÿ´ÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™.
                                                </p>
                                                <button 
                                                    className="btn btn-danger"
                                                    onClick={() => {
                                                        if (confirm('‚ö†Ô∏è ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜÿü\n\nŸáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá!')) {
                                                            if (confirm('‚ö†Ô∏è‚ö†Ô∏è ÿ™ÿ£ŸÉŸäÿØ ŸÜŸáÿßÿ¶Ÿä: ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿ≠ÿ≥ÿßÿ®ÿßÿ™ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ!\n\nÿßŸÉÿ™ÿ® "ŸÜÿπŸÖ" ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ©')) {
                                                                safeStorage('remove', 'suppliers');
                                                                setSuppliers([]);
                                                                alert('‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ ÿ®ŸÜÿ¨ÿßÿ≠');
                                                                // Removed reload to stay in admin panel
                                                            }
                                                        }
                                                    }}
                                                >
                                                    üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ
                                                </button>
                                            </div>

                                            <div style={{background: 'white', padding: '1.5rem', borderRadius: '12px', border: '1px solid #ddd'}}>
                                                <h4 style={{marginBottom: '1rem'}}>üóëÔ∏è ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</h4>
                                                <p style={{color: '#666', fontSize: '0.9rem', marginBottom: '1rem'}}>
                                                    ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ.
                                                </p>
                                                <button 
                                                    className="btn btn-danger"
                                                    onClick={() => {
                                                        if (confirm('‚ö†Ô∏è ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ÿü\n\nŸáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá!')) {
                                                            if (confirm('‚ö†Ô∏è‚ö†Ô∏è ÿ™ÿ£ŸÉŸäÿØ ŸÜŸáÿßÿ¶Ÿä: ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ' + products.length + ' ŸÖŸÜÿ™ÿ¨!\n\nÿßŸÉÿ™ÿ® "ŸÜÿπŸÖ" ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ©')) {
                                                                setProducts([]);
                                                                alert('‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
                                                            }
                                                        }
                                                    }}
                                                >
                                                    üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ({products.length})
                                                </button>
                                            </div>

                                            <div style={{background: 'white', padding: '1.5rem', borderRadius: '12px', border: '1px solid #ddd'}}>
                                                <h4 style={{marginBottom: '1rem'}}>üóëÔ∏è ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™</h4>
                                                <p style={{color: '#666', fontSize: '0.9rem', marginBottom: '1rem'}}>
                                                    ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ (ÿßŸÑŸÜÿ¥ÿ∑ÿ© ŸàÿßŸÑŸÖÿ§ÿ±ÿ¥ŸÅÿ©).
                                                </p>
                                                <button 
                                                    className="btn btn-danger"
                                                    onClick={() => {
                                                        if (confirm('‚ö†Ô∏è ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ÿü\n\nŸáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá!')) {
                                                            if (confirm('‚ö†Ô∏è‚ö†Ô∏è ÿ™ÿ£ŸÉŸäÿØ ŸÜŸáÿßÿ¶Ÿä: ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ' + (orders.length + archivedOrders.length) + ' ÿ∑ŸÑÿ®!\n\nÿßŸÉÿ™ÿ® "ŸÜÿπŸÖ" ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ©')) {
                                                                setOrders([]);
                                                                setArchivedOrders([]);
                                                                alert('‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
                                                            }
                                                        }
                                                    }}
                                                >
                                                    üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ({orders.length + archivedOrders.length})
                                                </button>
                                            </div>

                                            <div style={{background: 'white', padding: '1.5rem', borderRadius: '12px', border: '1px solid #ddd'}}>
                                                <h4 style={{marginBottom: '1rem'}}>üóëÔ∏è ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ¶ŸÇŸäŸÜ</h4>
                                                <p style={{color: '#666', fontSize: '0.9rem', marginBottom: '1rem'}}>
                                                    ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ¶ŸÇŸäŸÜ ŸÖŸÜ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ.
                                                </p>
                                                <button 
                                                    className="btn btn-danger"
                                                    onClick={() => {
                                                        if (confirm('‚ö†Ô∏è ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ¶ŸÇŸäŸÜÿü')) {
                                                            setDeliveryDrivers([]);
                                                            alert('‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ¶ŸÇŸäŸÜ ÿ®ŸÜÿ¨ÿßÿ≠');
                                                        }
                                                    }}
                                                >
                                                    üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ¶ŸÇŸäŸÜ ({deliveryDrivers.length})
                                                </button>
                                            </div>

                                            <div style={{background: '#ffebee', padding: '1.5rem', borderRadius: '12px', border: '2px solid #c62828'}}>
                                                <h4 style={{color: '#c62828', marginBottom: '1rem'}}>üí£ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ</h4>
                                                <p style={{color: '#666', fontSize: '0.9rem', marginBottom: '1rem'}}>
                                                    <strong style={{color: '#c62828'}}>ÿÆÿ∑Ÿäÿ± ÿ¨ÿØÿßŸã!</strong> ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:
                                                    ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜÿå ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ÿå ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ÿå ÿßŸÑÿ≥ÿßÿ¶ŸÇŸäŸÜÿå ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™ÿå Ÿàÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™.
                                                    ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ≥ŸäÿπŸàÿØ ŸÉÿ£ŸÜŸá ÿ¨ÿØŸäÿØ ÿ™ŸÖÿßŸÖÿßŸã.
                                                </p>
                                                <button 
                                                    className="btn btn-danger"
                                                    style={{background: '#b71c1c', fontSize: '1.1rem', padding: '1rem 2rem'}}
                                                    onClick={() => {
                                                        if (confirm('üí£üí£üí£ ÿ™ÿ≠ÿ∞Ÿäÿ± ÿ¥ÿØŸäÿØ!\n\nŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ 100% ŸÖŸÜ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ®ÿßŸÑŸÉÿßŸÖŸÑÿü\n\nÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ:\n- ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ\n- ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™\n- ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™\n- ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ¶ŸÇŸäŸÜ\n- ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™\n\nŸáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá ÿ£ÿ®ÿØÿßŸã!')) {
                                                            const confirmation = prompt('‚ö†Ô∏è ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ©ÿå ÿßŸÉÿ™ÿ® ŸÉŸÑŸÖÿ© "ŸÖÿ≥ÿ≠" ÿ®ÿßŸÑÿπÿ±ÿ®Ÿä:');
                                                            if (confirmation === 'ŸÖÿ≥ÿ≠') {
                                                                // ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                                                                safeStorage('clear');
                                                                alert('‚úÖ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ!\n\nÿ≥Ÿäÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©...');
                                                                setSuppliers([]);
                                                                setProducts([]);
                                                                setOrders([]);
                                                                setArchivedOrders([]);
                                                                setDeliveryDrivers([]);
                                                                setCategories(["ÿßŸÑŸÉŸÑ", "ÿ≠ÿ®Ÿàÿ®", "ÿ®ŸÇÿßŸÑÿ©", "ÿ≤ŸäŸàÿ™", "ÿ£ŸÑÿ®ÿßŸÜ", "ŸÖÿ¥ÿ±Ÿàÿ®ÿßÿ™", "ŸÖÿπŸÑÿ®ÿßÿ™", "ÿ≠ŸÑŸàŸäÿßÿ™", "ÿ™ŸÜÿ∏ŸäŸÅ"]);
                                                                // Removed reload to stay in admin panel
                                                            } else {
                                                                alert('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿπŸÖŸÑŸäÿ© - ÿßŸÑŸÉŸÑŸÖÿ© ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©');
                                                            }
                                                        }
                                                    }}
                                                >
                                                    üí£ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ
                                                </button>
                                            </div>

                                            {/* ===== ŸÇÿ≥ŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ™ÿßÿ¨ÿ± ===== */}
                                            <div style={{background: 'white', padding: '1.5rem', borderRadius: '12px', border: '1px solid #ddd'}}>
                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem', flexWrap: 'wrap', gap: '0.5rem'}}>
                                                    <h4 style={{marginBottom: 0}}>üè™ ÿ•ÿØÿßÿ±ÿ© ÿ≠ÿ≥ÿßÿ®ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ¨ÿ± ({buyers.length})</h4>
                                                    <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                                                        {selectedBuyersAdmin.size > 0 && (
                                                            <button className="btn btn-danger" onClick={deleteSelectedBuyers} style={{animation: 'pulse 1s infinite'}}>
                                                                üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≠ÿØÿØ ({selectedBuyersAdmin.size})
                                                            </button>
                                                        )}
                                                        {buyers.length > 0 && (
                                                            <button className="btn" style={{background: '#b71c1c', color: 'white'}} onClick={deleteAllBuyers}>
                                                                üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿßŸÑŸÉŸÑ
                                                            </button>
                                                        )}
                                                    </div>
                                                </div>

                                                {/* ÿ¥ÿ±Ÿäÿ∑ ÿ®ÿ≠ÿ´ */}
                                                <input
                                                    type="text"
                                                    value={buyerSearchAdmin}
                                                    onChange={e => setBuyerSearchAdmin(e.target.value)}
                                                    placeholder="üîç ÿßÿ®ÿ≠ÿ´ ÿ®ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ™ÿ¨ÿ± ÿ£Ÿà ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ..."
                                                    style={{width: '100%', padding: '0.8rem 1rem', border: '2px solid #ddd', borderRadius: '8px', fontSize: '0.95rem', marginBottom: '1rem'}}
                                                />

                                                {buyers.length === 0 ? (
                                                    <div style={{textAlign: 'center', padding: '2rem', color: '#999'}}>
                                                        <div style={{fontSize: '3rem', marginBottom: '0.5rem'}}>üè™</div>
                                                        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ™ÿßÿ¨ÿ± ŸÖÿ≥ÿ¨ŸÑÿ©</p>
                                                    </div>
                                                ) : (() => {
                                                    const filtered = buyers.filter(b =>
                                                        !buyerSearchAdmin.trim() ||
                                                        b.storeName?.toLowerCase().includes(buyerSearchAdmin.toLowerCase()) ||
                                                        b.username?.toLowerCase().includes(buyerSearchAdmin.toLowerCase())
                                                    );
                                                    const allSel = filtered.length > 0 && filtered.every(b => selectedBuyersAdmin.has(b.id));
                                                    return (
                                                        <div>
                                                            {/* ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ */}
                                                            {filtered.length > 1 && (
                                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.8rem', padding: '0.7rem 1rem', background: '#f5f5f5', borderRadius: '8px', marginBottom: '0.8rem'}}>
                                                                    <input type="checkbox" id="selAllBuyers"
                                                                        checked={allSel}
                                                                        onChange={() => {
                                                                            if (allSel) {
                                                                                setSelectedBuyersAdmin(prev => {
                                                                                    const n = new Set(prev);
                                                                                    filtered.forEach(b => n.delete(b.id));
                                                                                    return n;
                                                                                });
                                                                            } else {
                                                                                setSelectedBuyersAdmin(prev => {
                                                                                    const n = new Set(prev);
                                                                                    filtered.forEach(b => n.add(b.id));
                                                                                    return n;
                                                                                });
                                                                            }
                                                                        }}
                                                                        style={{width: '17px', height: '17px', cursor: 'pointer', accentColor: '#c62828'}}
                                                                    />
                                                                    <label htmlFor="selAllBuyers" style={{cursor: 'pointer', fontWeight: 'bold', userSelect: 'none', color: '#555'}}>
                                                                        ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ ({filtered.length})
                                                                    </label>
                                                                    {selectedBuyersAdmin.size > 0 && (
                                                                        <span style={{marginRight: 'auto', background: '#ffebee', color: '#c62828', padding: '0.2rem 0.7rem', borderRadius: '20px', fontSize: '0.85rem', fontWeight: 'bold'}}>
                                                                            ‚úì {selectedBuyersAdmin.size} ŸÖÿ≠ÿØÿØ
                                                                        </span>
                                                                    )}
                                                                </div>
                                                            )}

                                                            {/* ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ™ÿßÿ¨ÿ± */}
                                                            {filtered.length === 0 ? (
                                                                <p style={{textAlign: 'center', color: '#999', padding: '1rem'}}>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨</p>
                                                            ) : filtered.map(buyer => {
                                                                const isSel = selectedBuyersAdmin.has(buyer.id);
                                                                const buyerOrderCount = [...orders, ...archivedOrders].filter(o => o.buyerId === buyer.id).length;
                                                                return (
                                                                    <div key={buyer.id} style={{
                                                                        display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                                                                        padding: '0.9rem 1rem', marginBottom: '0.5rem', borderRadius: '8px',
                                                                        border: isSel ? '2px solid #ef9a9a' : '1px solid #e0e0e0',
                                                                        background: isSel ? '#fff8f8' : '#fafafa',
                                                                        transition: 'all 0.2s', flexWrap: 'wrap', gap: '0.5rem'
                                                                    }}>
                                                                        <div style={{display: 'flex', alignItems: 'center', gap: '0.8rem'}}>
                                                                            <input type="checkbox" checked={isSel}
                                                                                onChange={() => setSelectedBuyersAdmin(prev => {
                                                                                    const n = new Set(prev);
                                                                                    if (n.has(buyer.id)) n.delete(buyer.id); else n.add(buyer.id);
                                                                                    return n;
                                                                                })}
                                                                                style={{width: '17px', height: '17px', cursor: 'pointer', accentColor: '#c62828'}}
                                                                            />
                                                                            <div>
                                                                                <div style={{fontWeight: 'bold', fontSize: '0.95rem'}}>üè™ {buyer.storeName}</div>
                                                                                <div style={{fontSize: '0.82rem', color: '#777', marginTop: '0.2rem'}}>
                                                                                    üë§ {buyer.username}
                                                                                    {buyer.phone && <> ¬∑ üì± {buyer.phone}</>}
                                                                                    {buyerOrderCount > 0 && <> ¬∑ üì¶ {buyerOrderCount} ÿ∑ŸÑÿ®</>}
                                                                                </div>
                                                                                <div style={{fontSize: '0.78rem', color: '#aaa', marginTop: '0.1rem'}}>
                                                                                    ÿ≥ÿ¨ŸëŸÑ: {new Date(buyer.createdAt).toLocaleDateString('ar-IQ')}
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <button className="btn btn-danger"
                                                                            style={{padding: '0.4rem 0.9rem', fontSize: '0.85rem'}}
                                                                            onClick={() => {
                                                                                if (confirm(`ÿ≠ÿ∞ŸÅ ŸÖÿ™ÿ¨ÿ± "${buyer.storeName}"ÿü`))
                                                                                    deleteBuyer(buyer.id);
                                                                            }}>
                                                                            üóëÔ∏è ÿ≠ÿ∞ŸÅ
                                                                        </button>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    );
                                                })()}
                                            </div>

                                            <div style={{background: '#e3f2fd', padding: '1.5rem', borderRadius: '12px', border: '1px solid #2196f3'}}>
                                                <h4 style={{color: '#1976d2', marginBottom: '1rem'}}>üìä ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ</h4>
                                                <div style={{display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem', fontSize: '0.95rem'}}>
                                                    <div>
                                                        <strong>ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ:</strong> {suppliers.length}
                                                    </div>
                                                    <div>
                                                        <strong>ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™:</strong> {products.length}
                                                    </div>
                                                    <div>
                                                        <strong>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÜÿ¥ÿ∑ÿ©:</strong> {orders.length}
                                                    </div>
                                                    <div>
                                                        <strong>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖÿ§ÿ±ÿ¥ŸÅÿ©:</strong> {archivedOrders.length}
                                                    </div>
                                                    <div>
                                                        <strong>ÿßŸÑÿ≥ÿßÿ¶ŸÇŸäŸÜ:</strong> {deliveryDrivers.length}
                                                    </div>
                                                    <div>
                                                        <strong>ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™:</strong> {categories.length - 1}
                                                    </div>
                                                    <div>
                                                        <strong>ÿßŸÑŸÖÿ™ÿßÿ¨ÿ± ÿßŸÑŸÖÿ≥ÿ¨ŸÑÿ©:</strong> {buyers.length}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {showBuyerAuth && (
                        <div className="modal-overlay" onClick={() => setShowBuyerAuth(false)}>
                            <div className="modal-box" onClick={(e) => e.stopPropagation()} style={{maxWidth: '480px'}}>
                                <button className="modal-close" onClick={() => setShowBuyerAuth(false)}>√ó</button>
                                
                                <div style={{textAlign: 'center', marginBottom: '1.5rem'}}>
                                    <div style={{fontSize: '3.5rem', marginBottom: '0.5rem'}}>üè™</div>
                                    <h2 style={{color: '#2c5f2d'}}>
                                        {buyerAuthMode === 'login' ? 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑŸÖÿ™ÿ¨ÿ±' : 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ŸÖÿ™ÿ¨ÿ± ÿ¨ÿØŸäÿØ'}
                                    </h2>
                                    <p style={{color: '#666', fontSize: '0.9rem', marginTop: '0.5rem'}}>
                                        {buyerAuthMode === 'login' ? 'ÿ≥ŸÑÿ™ŸÉ ŸÖÿ≠ŸÅŸàÿ∏ÿ© Ÿàÿ≥ÿ™Ÿèÿ≥ÿ™ÿπÿßÿØ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã' : 'ÿ≥ŸÑÿ™ŸÉ ÿ≥ÿ™Ÿèÿ≠ŸÅÿ∏ ÿØÿßÿ¶ŸÖÿßŸã ŸÑÿ≠ÿ≥ÿßÿ®ŸÉ'}
                                    </p>
                                </div>

                                <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1.5rem', background: '#f5f5f5', padding: '0.4rem', borderRadius: '10px'}}>
                                    <button
                                        onClick={() => setBuyerAuthMode('login')}
                                        style={{flex: 1, padding: '0.7rem', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: 'bold', fontSize: '0.95rem',
                                            background: buyerAuthMode === 'login' ? 'white' : 'transparent',
                                            color: buyerAuthMode === 'login' ? '#2c5f2d' : '#666',
                                            boxShadow: buyerAuthMode === 'login' ? '0 2px 8px rgba(0,0,0,0.1)' : 'none'
                                        }}
                                    >üîì ÿØÿÆŸàŸÑ</button>
                                    <button
                                        onClick={() => setBuyerAuthMode('register')}
                                        style={{flex: 1, padding: '0.7rem', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: 'bold', fontSize: '0.95rem',
                                            background: buyerAuthMode === 'register' ? 'white' : 'transparent',
                                            color: buyerAuthMode === 'register' ? '#2c5f2d' : '#666',
                                            boxShadow: buyerAuthMode === 'register' ? '0 2px 8px rgba(0,0,0,0.1)' : 'none'
                                        }}
                                    >‚úèÔ∏è ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ</button>
                                </div>

                                <form onSubmit={buyerAuthMode === 'login' ? buyerLogin : buyerRegister}>
                                    {buyerAuthMode === 'register' && (
                                        <>
                                            <div className="form-group">
                                                <label className="form-label">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ™ÿ¨ÿ± *</label>
                                                <input type="text" className="form-input" required placeholder="ŸÖÿ´ÿßŸÑ: ÿ≥Ÿàÿ®ÿ± ŸÖÿßÿ±ŸÉÿ™ ÿßŸÑŸÜŸàÿ±"
                                                    value={buyerAuthData.storeName}
                                                    onChange={(e) => setBuyerAuthData({...buyerAuthData, storeName: e.target.value})} />
                                            </div>
                                            <div className="form-group">
                                                <label className="form-label">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ *</label>
                                                <input type="text" className="form-input" placeholder="ÿßÿ≥ŸÖ ÿµÿßÿ≠ÿ® ÿßŸÑŸÖÿ™ÿ¨ÿ±"
                                                    value={buyerAuthData.ownerName}
                                                    onChange={(e) => setBuyerAuthData({...buyerAuthData, ownerName: e.target.value})} />
                                            </div>
                                            <div className="form-group">
                                                <label className="form-label">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</label>
                                                <input type="tel" className="form-input" placeholder="07XX XXX XXXX"
                                                    value={buyerAuthData.phone}
                                                    onChange={(e) => setBuyerAuthData({...buyerAuthData, phone: e.target.value})} />
                                            </div>
                                        </>
                                    )}
                                    <div className="form-group">
                                        <label className="form-label">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ *</label>
                                        <input type="text" className="form-input" required placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"
                                            value={buyerAuthData.username}
                                            onChange={(e) => setBuyerAuthData({...buyerAuthData, username: e.target.value})} />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± *</label>
                                        <input type="password" className="form-input" required placeholder="ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"
                                            value={buyerAuthData.password}
                                            onChange={(e) => setBuyerAuthData({...buyerAuthData, password: e.target.value})} />
                                    </div>
                                    <button type="submit" className="btn btn-primary" style={{width: '100%', padding: '1rem', fontSize: '1.1rem', marginTop: '0.5rem'}}>
                                        {buyerAuthMode === 'login' ? 'üîì ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ' : '‚úÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®'}
                                    </button>
                                </form>

                                {buyerAuthMode === 'login' && (
                                    <div style={{marginTop: '1.5rem', padding: '1rem', background: '#e8f5e9', borderRadius: '8px', border: '1px solid #4caf50'}}>
                                        <p style={{color: '#2e7d32', fontSize: '0.9rem', margin: 0, textAlign: 'center'}}>
                                            üí° ÿ≥ŸÑÿ™ŸÉ ÿ≥ÿ™Ÿèÿ≠ŸÅÿ∏ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿπŸÜÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ Ÿàÿ™ÿπŸàÿØ ÿπŸÜÿØ ÿØÿÆŸàŸÑŸÉ ŸÖÿ¨ÿØÿØÿßŸã
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {showAuthModal && (
                        <div className="modal-overlay" onClick={() => setShowAuthModal(false)}>
                            <div className="modal-box" onClick={(e) => e.stopPropagation()}>
                                <button className="modal-close" onClick={() => setShowAuthModal(false)}>√ó</button>
                                <h2 style={{marginBottom: '1rem'}}>{showLogin ? 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ' : 'ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖŸàÿ±ÿØ ÿ¨ÿØŸäÿØ'}</h2>
                                <form onSubmit={showLogin ? login : register}>
                                    {!showLogin && (
                                        <div className="form-group">
                                            <label>ÿßÿ≥ŸÖ ÿßŸÑÿ¥ÿ±ŸÉÿ© *</label>
                                            <input 
                                                type="text" 
                                                required 
                                                value={authData.companyName}
                                                onChange={(e) => setAuthData({...authData, companyName: e.target.value})}
                                                placeholder="ŸÖÿ´ÿßŸÑ: ÿ¥ÿ±ŸÉÿ© ÿßŸÑÿ£ŸÑÿ®ÿßŸÜ ÿßŸÑÿπÿ±ÿßŸÇŸäÿ©"
                                            />
                                        </div>
                                    )}
                                    <div className="form-group">
                                        <label>ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ *</label>
                                        <input 
                                            type="text" 
                                            required 
                                            value={authData.username}
                                            onChange={(e) => setAuthData({...authData, username: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± *</label>
                                        <input 
                                            type="password" 
                                            required 
                                            value={authData.password}
                                            onChange={(e) => setAuthData({...authData, password: e.target.value})}
                                        />
                                    </div>
                                    <button type="submit" className="btn btn-primary" style={{width: '100%'}}>
                                        {showLogin ? 'ÿØÿÆŸàŸÑ' : 'ÿ™ÿ≥ÿ¨ŸäŸÑ'}
                                    </button>
                                    <p style={{textAlign: 'center', marginTop: '1rem'}}>
                                        {showLogin ? 'ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ®ÿü' : 'ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ®ÿü'}
                                        {' '}
                                        <a 
                                            href="#" 
                                            onClick={(e) => { e.preventDefault(); setShowLogin(!showLogin); }}
                                            style={{color: '#2c5f2d', fontWeight: 'bold'}}
                                        >
                                            {showLogin ? 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ¨ÿØŸäÿØ' : 'ÿØÿÆŸàŸÑ'}
                                        </a>
                                    </p>
                                </form>
                            </div>
                        </div>
                    )}

                    {showCheckout && (() => {
                        // ÿ≠ÿ≥ÿßÿ® ÿπÿØÿØ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅŸäŸÜ ŸÅŸä ÿßŸÑÿ≥ŸÑÿ©
                        const supplierIds = new Set(
                            cart.map(item => {
                                const product = products.find(p => p.id === item.id);
                                return product ? product.supplierId : null;
                            }).filter(Boolean)
                        );
                        const multipleSuppliers = supplierIds.size > 1;
                        
                        return (
                            <div className="modal-overlay" onClick={() => setShowCheckout(false)}>
                                <div className="modal-box" onClick={(e) => e.stopPropagation()}>
                                    <button className="modal-close" onClick={() => setShowCheckout(false)}>√ó</button>
                                    <h2 style={{marginBottom: '1rem'}}>ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®</h2>
                                    
                                    {multipleSuppliers && (
                                        <div style={{background: '#e3f2fd', padding: '1rem', borderRadius: '8px', marginBottom: '1rem', border: '2px solid #2196f3'}}>
                                            <p style={{color: '#1976d2', marginBottom: '0.5rem'}}>
                                                <strong>‚ÑπÔ∏è ÿ™ŸÜÿ®ŸäŸá:</strong> ÿ≥ŸÑÿ™ŸÉ ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÜ {supplierIds.size} ŸÖŸàÿ±ÿØŸäŸÜ ŸÖÿÆÿ™ŸÑŸÅŸäŸÜ
                                            </p>
                                            <p style={{fontSize: '0.9rem', color: '#666', marginBottom: '0'}}>
                                                ÿ≥Ÿäÿ™ŸÖ ÿ™ŸÇÿ≥ŸäŸÖ ÿ∑ŸÑÿ®ŸÉ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ•ŸÑŸâ {supplierIds.size} ÿ∑ŸÑÿ®ÿßÿ™ ŸÖŸÜŸÅÿµŸÑÿ©. ŸÉŸÑ ŸÖŸàÿ±ÿØ ÿ≥Ÿäÿ≥ÿ™ŸÑŸÖ ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿÆÿßÿµ ÿ®Ÿá ŸÖŸÜ ÿßŸÑÿ∑ŸÑÿ®.
                                            </p>
                                        </div>
                                    )}
                                    
                                    <p style={{color: '#666', marginBottom: '1rem'}}>ÿßŸÖŸÑÿ£ ÿ®ŸäÿßŸÜÿßÿ™ŸÉ ŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®</p>
                                <form onSubmit={checkout}>
                                    <div className="form-group">
                                        <label>ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ™ÿ¨ÿ± *</label>
                                        <input 
                                            type="text" 
                                            required 
                                            value={buyerData.storeName}
                                            onChange={(e) => setBuyerData({...buyerData, storeName: e.target.value})}
                                            placeholder="ŸÖÿ´ÿßŸÑ: ÿ≥Ÿàÿ®ÿ± ŸÖÿßÿ±ŸÉÿ™ ÿßŸÑŸÜŸàÿ±"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ *</label>
                                        <input 
                                            type="text" 
                                            required 
                                            value={buyerData.ownerName}
                                            onChange={(e) => setBuyerData({...buyerData, ownerName: e.target.value})}
                                            placeholder="ŸÖÿ´ÿßŸÑ: ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ *</label>
                                        <input 
                                            type="tel" 
                                            required 
                                            value={buyerData.phone}
                                            onChange={(e) => setBuyerData({...buyerData, phone: e.target.value})}
                                            placeholder="07XX XXX XXXX"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>ÿßŸÑÿπŸÜŸàÿßŸÜ *</label>
                                        <div style={{background: '#fff3e0', padding: '0.5rem', borderRadius: '6px', marginBottom: '0.5rem', fontSize: '0.85rem', border: '1px solid #ffb74d'}}>
                                            üí° <strong>ŸÜÿµŸäÿ≠ÿ©:</strong> ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ≤ÿ± GPS ŸÑÿ™ÿ≠ÿØŸäÿØ ŸÖŸàŸÇÿπŸÉ ÿßŸÑÿØŸÇŸäŸÇ ŸÑÿ™ÿ≥ŸáŸäŸÑ ÿπŸÖŸÑŸäÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ
                                        </div>
                                        <div style={{display: 'flex', gap: '0.5rem', marginBottom: '0.5rem'}}>
                                            <input 
                                                type="text" 
                                                required 
                                                value={buyerData.address}
                                                onChange={(e) => setBuyerData({...buyerData, address: e.target.value})}
                                                placeholder="ÿ®ÿ∫ÿØÿßÿØ - ÿßŸÑŸÉÿ±ÿßÿØÿ©"
                                                style={{flex: 1}}
                                            />
                                            <button 
                                                type="button"
                                                className="btn btn-primary"
                                                onClick={getCurrentLocation}
                                                disabled={isGettingLocation}
                                                style={{whiteSpace: 'nowrap', padding: '0.8rem 1.2rem'}}
                                                title="ÿ™ÿ≠ÿØŸäÿØ ŸÖŸàŸÇÿπŸä ÿßŸÑÿ≠ÿßŸÑŸä"
                                            >
                                                {isGettingLocation ? '‚è≥ ÿ¨ÿßÿ±Ÿä...' : 'üìç GPS'}
                                            </button>
                                        </div>
                                        {buyerData.latitude && buyerData.longitude && (
                                            <div style={{background: '#e8f5e9', padding: '0.8rem', borderRadius: '8px', fontSize: '0.9rem', marginTop: '0.5rem', border: '1px solid #4caf50'}}>
                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem'}}>
                                                    <strong style={{color: '#2e7d32'}}>‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ</strong>
                                                    <button 
                                                        type="button"
                                                        onClick={() => setBuyerData({...buyerData, latitude: null, longitude: null, locationAccuracy: null})}
                                                        style={{background: 'none', border: 'none', color: '#c62828', cursor: 'pointer', fontSize: '1.2rem'}}
                                                        title="ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÖŸàŸÇÿπ"
                                                    >
                                                        √ó
                                                    </button>
                                                </div>
                                                <div style={{fontSize: '0.85rem', color: '#666'}}>
                                                    <strong>üìç ÿßŸÑÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™:</strong><br/>
                                                    ÿÆÿ∑ ÿßŸÑÿπÿ±ÿ∂: {buyerData.latitude.toFixed(6)}<br/>
                                                    ÿÆÿ∑ ÿßŸÑÿ∑ŸàŸÑ: {buyerData.longitude.toFixed(6)}<br/>
                                                    {buyerData.locationAccuracy && (
                                                        <>ÿßŸÑÿØŸÇÿ©: ~{Math.round(buyerData.locationAccuracy)} ŸÖÿ™ÿ±<br/></>
                                                    )}
                                                </div>
                                                <a 
                                                    href={`https://www.google.com/maps?q=${buyerData.latitude},${buyerData.longitude}`}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    style={{display: 'inline-block', marginTop: '0.5rem', color: '#1976d2', textDecoration: 'none', fontSize: '0.9rem'}}
                                                >
                                                    üó∫Ô∏è ÿπÿ±ÿ∂ ÿπŸÑŸâ ÿÆÿ±ÿßÿ¶ÿ∑ Google ‚Üí
                                                </a>
                                            </div>
                                        )}
                                    </div>
                                    <div className="form-group">
                                        <label>ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ *</label>
                                        <select 
                                            required
                                            value={buyerData.deliveryMethod}
                                            onChange={(e) => setBuyerData({...buyerData, deliveryMethod: e.target.value})}
                                        >
                                            <option value="standard">ÿ™ŸàÿµŸäŸÑ ÿπÿßÿØŸä (2,000 ÿØ.ÿπ - 3-5 ÿ£ŸäÿßŸÖ)</option>
                                            <option value="express">ÿ™ŸàÿµŸäŸÑ ÿ≥ÿ±Ÿäÿπ (5,000 ÿØ.ÿπ - 1-2 ŸäŸàŸÖ)</option>
                                            <option value="pickup">ÿßÿ≥ÿ™ŸÑÿßŸÖ ŸÖŸÜ ÿßŸÑŸÖÿ™ÿ¨ÿ± (ŸÖÿ¨ÿßŸÜÿßŸã)</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©</label>
                                        <textarea 
                                            value={buyerData.notes}
                                            onChange={(e) => setBuyerData({...buyerData, notes: e.target.value})}
                                            rows="3"
                                            placeholder="ÿ£Ÿä ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™..."
                                        />
                                    </div>
                                    <div style={{background: '#f5f5f5', padding: '1rem', borderRadius: '8px', marginBottom: '1rem'}}>
                                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                            <span>ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÅÿ±ÿπŸä:</span>
                                            <strong>{totalAmount.toLocaleString()} ÿØ.ÿπ</strong>
                                        </div>
                                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                            <span>ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ:</span>
                                            <strong>{(buyerData.deliveryMethod === 'express' ? 5000 : buyerData.deliveryMethod === 'pickup' ? 0 : 2000).toLocaleString()} ÿØ.ÿπ</strong>
                                        </div>
                                        <div style={{display: 'flex', justifyContent: 'space-between', paddingTop: '0.5rem', borderTop: '2px solid #ddd'}}>
                                            <span style={{fontSize: '1.2rem', fontWeight: 'bold'}}>ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä:</span>
                                            <strong style={{fontSize: '1.2rem', color: '#2c5f2d'}}>
                                                {(totalAmount + (buyerData.deliveryMethod === 'express' ? 5000 : buyerData.deliveryMethod === 'pickup' ? 0 : 2000)).toLocaleString()} ÿØ.ÿπ
                                            </strong>
                                        </div>
                                    </div>
                                    <button type="submit" className="btn btn-primary" style={{width: '100%', padding: '1rem'}}>
                                        ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®
                                    </button>
                                </form>
                            </div>
                        </div>
                    );
                    })()}

                    {showOrderDetail && selectedOrder && (
                        <div className="modal-overlay" onClick={() => setShowOrderDetail(false)}>
                            <div className="modal-box" onClick={(e) => e.stopPropagation()}>
                                <button className="modal-close" onClick={() => setShowOrderDetail(false)}>√ó</button>
                                <h2 style={{marginBottom: '1rem'}}>ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ® {selectedOrder.orderNumber}</h2>
                                
                                {selectedOrder.mainOrderNumber && selectedOrder.orderNumber !== selectedOrder.mainOrderNumber && (
                                    <div style={{background: '#fff3e0', padding: '1rem', borderRadius: '8px', marginBottom: '1rem', border: '2px solid #f57c00'}}>
                                        <p style={{color: '#e65100', marginBottom: '0.5rem'}}>
                                            <strong>üì¶ Ÿáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ® ÿ¨ÿ≤ÿ° ŸÖŸÜ ÿ∑ŸÑÿ® ŸÖŸÇÿ≥ŸÖ</strong>
                                        </p>
                                        <p style={{fontSize: '0.9rem', color: '#666'}}>
                                            <strong>ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä:</strong> {selectedOrder.mainOrderNumber}
                                        </p>
                                    </div>
                                )}
                                
                                <div style={{background: '#f5f5f5', padding: '1rem', borderRadius: '8px', marginBottom: '1rem'}}>
                                    <p><strong>ÿßŸÑŸÖÿ™ÿ¨ÿ±:</strong> {selectedOrder.storeName}</p>
                                    <p><strong>ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ:</strong> {selectedOrder.ownerName}</p>
                                    <p><strong>ÿßŸÑŸáÿßÿ™ŸÅ:</strong> {selectedOrder.phone}</p>
                                    <p><strong>ÿßŸÑÿπŸÜŸàÿßŸÜ:</strong> {selectedOrder.address}</p>
                                    {selectedOrder.latitude && selectedOrder.longitude && (
                                        <div style={{background: '#e3f2fd', padding: '0.8rem', borderRadius: '6px', marginTop: '0.5rem', border: '1px solid #2196f3'}}>
                                            <p style={{marginBottom: '0.5rem'}}><strong style={{color: '#1976d2'}}>üìç ŸÖŸàŸÇÿπ GPS:</strong></p>
                                            <p style={{fontSize: '0.85rem', color: '#666', marginBottom: '0.5rem'}}>
                                                ÿÆÿ∑ ÿßŸÑÿπÿ±ÿ∂: {selectedOrder.latitude.toFixed(6)}<br/>
                                                ÿÆÿ∑ ÿßŸÑÿ∑ŸàŸÑ: {selectedOrder.longitude.toFixed(6)}
                                                {selectedOrder.locationAccuracy && (
                                                    <><br/>ÿßŸÑÿØŸÇÿ©: ~{Math.round(selectedOrder.locationAccuracy)} ŸÖÿ™ÿ±</>
                                                )}
                                            </p>
                                            <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                                                <a 
                                                    href={`https://www.google.com/maps?q=${selectedOrder.latitude},${selectedOrder.longitude}`}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    className="btn btn-primary"
                                                    style={{fontSize: '0.85rem', padding: '0.5rem 1rem'}}
                                                >
                                                    üó∫Ô∏è Google Maps
                                                </a>
                                                <a 
                                                    href={`https://www.openstreetmap.org/?mlat=${selectedOrder.latitude}&mlon=${selectedOrder.longitude}&zoom=16`}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    className="btn btn-secondary"
                                                    style={{fontSize: '0.85rem', padding: '0.5rem 1rem'}}
                                                >
                                                    üó∫Ô∏è OpenStreetMap
                                                </a>
                                                <a 
                                                    href={`https://waze.com/ul?ll=${selectedOrder.latitude},${selectedOrder.longitude}&navigate=yes`}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    className="btn btn-secondary"
                                                    style={{fontSize: '0.85rem', padding: '0.5rem 1rem'}}
                                                >
                                                    üöó Waze
                                                </a>
                                                <button
                                                    type="button"
                                                    className="btn btn-secondary"
                                                    onClick={() => {
                                                        navigator.clipboard.writeText(`${selectedOrder.latitude},${selectedOrder.longitude}`);
                                                        alert('‚úÖ ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™!');
                                                    }}
                                                    style={{fontSize: '0.85rem', padding: '0.5rem 1rem'}}
                                                >
                                                    üìã ŸÜÿ≥ÿÆ
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                    {selectedOrder.trackingNumber && <p><strong>üì¶ ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ:</strong> {selectedOrder.trackingNumber}</p>}
                                    {selectedOrder.deliveryMethod && (
                                        <p><strong>ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ:</strong> {
                                            selectedOrder.deliveryMethod === 'express' ? 'ÿ™ŸàÿµŸäŸÑ ÿ≥ÿ±Ÿäÿπ' :
                                            selectedOrder.deliveryMethod === 'pickup' ? 'ÿßÿ≥ÿ™ŸÑÿßŸÖ ŸÖŸÜ ÿßŸÑŸÖÿ™ÿ¨ÿ±' :
                                            'ÿ™ŸàÿµŸäŸÑ ÿπÿßÿØŸä'
                                        }</p>
                                    )}
                                    {selectedOrder.driverName && <p><strong>üöó ÿßŸÑÿ≥ÿßÿ¶ŸÇ:</strong> {selectedOrder.driverName}</p>}
                                    {selectedOrder.deliveryStatus && (
                                        <p><strong>ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ:</strong> <span className="product-badge badge-info">{getStatusNote(selectedOrder.deliveryStatus)}</span></p>
                                    )}
                                    <p><strong>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ:</strong> {new Date(selectedOrder.date).toLocaleString('ar-IQ')}</p>
                                    {selectedOrder.notes && <p><strong>ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™:</strong> {selectedOrder.notes}</p>}
                                </div>
                                <h3 style={{marginBottom: '1rem'}}>ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</h3>
                                {selectedOrder.items.map((item, index) => {
                                    console.log(`ÿπŸÜÿµÿ± ${index + 1}:`, item); // ŸÑŸÑÿ™ÿ™ÿ®ÿπ
                                    return (
                                        <div key={item.id} className="cart-item">
                                            <div>
                                                <strong>{item.name}</strong>
                                                <div><small>{item.company}</small></div>
                                            </div>
                                            <div style={{display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: '0.5rem'}}>
                                                <div style={{display: 'flex', alignItems: 'center', gap: '1rem'}}>
                                                    <span style={{color: '#666'}}>ÿßŸÑÿ≥ÿπÿ±: {(item.price || 0).toLocaleString()} ÿØ.ÿπ</span>
                                                    <span style={{color: '#666'}}>ÿßŸÑŸÉŸÖŸäÿ©: <strong style={{color: '#2c5f2d'}}>{item.qty || 1}</strong></span>
                                                </div>
                                                <strong style={{fontSize: '1.1rem', color: '#2c5f2d'}}>
                                                    ÿßŸÑŸÖÿ¨ŸÖŸàÿπ: {((item.price || 0) * (item.qty || 1)).toLocaleString()} ÿØ.ÿπ
                                                </strong>
                                            </div>
                                        </div>
                                    );
                                })}
                                <div style={{marginTop: '1rem', padding: '1rem', background: '#f5f5f5', borderRadius: '8px'}}>
                                    {selectedOrder.subtotal && (
                                        <>
                                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                <span>ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÅÿ±ÿπŸä:</span>
                                                <span>{selectedOrder.subtotal.toLocaleString()} ÿØ.ÿπ</span>
                                            </div>
                                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                <span>ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ:</span>
                                                <span>{(selectedOrder.deliveryFee || 0).toLocaleString()} ÿØ.ÿπ</span>
                                            </div>
                                            <div style={{borderTop: '2px solid #ddd', paddingTop: '0.5rem', marginTop: '0.5rem'}}></div>
                                        </>
                                    )}
                                    <div style={{display: 'flex', justifyContent: 'space-between', fontSize: '1.3rem', fontWeight: 'bold'}}>
                                        <span>ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä:</span>
                                        <span style={{color: '#2c5f2d'}}>{selectedOrder.total.toLocaleString()} ÿØ.ÿπ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {showSupplierOrders && selectedSupplier && (() => {
                        const supplierOrders = getSupplierOrders(selectedSupplier.id);
                        return (
                            <div className="modal-overlay" onClick={() => setShowSupplierOrders(false)}>
                                <div className="modal-box" onClick={(e) => e.stopPropagation()} style={{maxWidth: '900px'}}>
                                    <button className="modal-close" onClick={() => setShowSupplierOrders(false)}>√ó</button>
                                    <h2 style={{marginBottom: '1rem'}}>üìã ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖŸàÿ±ÿØ: {selectedSupplier.companyName}</h2>
                                    
                                    <div style={{background: '#e3f2fd', padding: '1rem', borderRadius: '8px', marginBottom: '1.5rem'}}>
                                        <p><strong>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™:</strong> {supplierOrders.total}</p>
                                        <p><strong>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÜÿ¥ÿ∑ÿ©:</strong> {supplierOrders.active.length}</p>
                                        <p><strong>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖÿ§ÿ±ÿ¥ŸÅÿ©:</strong> {supplierOrders.archived.length}</p>
                                    </div>

                                    {supplierOrders.total === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-state-icon">üì¶</div>
                                            <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™</h3>
                                            <p>ŸÑŸÖ Ÿäÿ≥ÿ™ŸÑŸÖ Ÿáÿ∞ÿß ÿßŸÑŸÖŸàÿ±ÿØ ÿ£Ÿä ÿ∑ŸÑÿ®ÿßÿ™ ÿ®ÿπÿØ</p>
                                        </div>
                                    ) : (
                                        <>
                                            {supplierOrders.active.length > 0 && (
                                                <div style={{marginBottom: '2rem'}}>
                                                    <h3 style={{color: '#2e7d32', marginBottom: '1rem'}}>‚úì ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÜÿ¥ÿ∑ÿ© ({supplierOrders.active.length})</h3>
                                                    {supplierOrders.active.sort((a, b) => new Date(b.date) - new Date(a.date)).map(order => (
                                                        <div key={order.id} style={{background: 'white', padding: '1rem', borderRadius: '8px', border: '1px solid #ddd', marginBottom: '0.5rem'}}>
                                                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '0.5rem'}}>
                                                                <div>
                                                                    <strong>{order.orderNumber}</strong>
                                                                    <div style={{fontSize: '0.9rem', color: '#666', marginTop: '0.3rem'}}>
                                                                        ÿßŸÑŸÖÿ™ÿ¨ÿ±: {order.storeName} | ÿßŸÑŸÖÿ®ŸÑÿ∫: {order.total.toLocaleString()} ÿØ.ÿπ
                                                                    </div>
                                                                    <div style={{fontSize: '0.85rem', color: '#999', marginTop: '0.2rem'}}>
                                                                        {new Date(order.date).toLocaleDateString('ar-IQ')}
                                                                    </div>
                                                                </div>
                                                                <div style={{display: 'flex', gap: '0.5rem', alignItems: 'center'}}>
                                                                    <span className={`product-badge ${
                                                                        order.status === 'delivered' ? 'badge-success' :
                                                                        order.status === 'cancelled' ? 'badge-danger' :
                                                                        order.status === 'ready' ? 'badge-info' :
                                                                        'badge-warning'
                                                                    }`}>
                                                                        {order.status === 'pending' && 'ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±'}
                                                                        {order.status === 'processing' && 'ŸÇŸäÿØ ÿßŸÑÿ™ÿ¨ŸáŸäÿ≤'}
                                                                        {order.status === 'ready' && 'ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ¥ÿ≠ŸÜ'}
                                                                        {order.status === 'delivered' && 'ÿ™ŸÖ ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ'}
                                                                        {order.status === 'cancelled' && 'ŸÖŸÑÿ∫Ÿä'}
                                                                    </span>
                                                                    <button 
                                                                        className="btn btn-primary" 
                                                                        style={{padding: '0.5rem 1rem', fontSize: '0.9rem'}}
                                                                        onClick={() => { 
                                                                            setSelectedOrder(order); 
                                                                            setShowOrderDetail(true); 
                                                                        }}
                                                                    >
                                                                        ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}

                                            {supplierOrders.archived.length > 0 && (
                                                <div>
                                                    <h3 style={{color: '#757575', marginBottom: '1rem'}}>üì¶ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖÿ§ÿ±ÿ¥ŸÅÿ© ({supplierOrders.archived.length})</h3>
                                                    {supplierOrders.archived.sort((a, b) => new Date(b.archivedAt) - new Date(a.archivedAt)).map(order => (
                                                        <div key={order.id} style={{background: '#f5f5f5', padding: '1rem', borderRadius: '8px', border: '1px solid #ccc', marginBottom: '0.5rem'}}>
                                                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '0.5rem'}}>
                                                                <div>
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                                        <strong>{order.orderNumber}</strong>
                                                                        <span className="product-badge badge-info" style={{fontSize: '0.75rem'}}>ŸÖÿ§ÿ±ÿ¥ŸÅ</span>
                                                                    </div>
                                                                    <div style={{fontSize: '0.9rem', color: '#666', marginTop: '0.3rem'}}>
                                                                        ÿßŸÑŸÖÿ™ÿ¨ÿ±: {order.storeName} | ÿßŸÑŸÖÿ®ŸÑÿ∫: {order.total.toLocaleString()} ÿØ.ÿπ
                                                                    </div>
                                                                    <div style={{fontSize: '0.85rem', color: '#999', marginTop: '0.2rem'}}>
                                                                        ÿßŸÑÿ∑ŸÑÿ®: {new Date(order.date).toLocaleDateString('ar-IQ')} | 
                                                                        ÿßŸÑÿ£ÿ±ÿ¥ŸÅÿ©: {new Date(order.archivedAt).toLocaleDateString('ar-IQ')}
                                                                    </div>
                                                                </div>
                                                                <button 
                                                                    className="btn btn-secondary" 
                                                                    style={{padding: '0.5rem 1rem', fontSize: '0.9rem'}}
                                                                    onClick={() => { 
                                                                        setSelectedOrder(order); 
                                                                        setShowOrderDetail(true); 
                                                                    }}
                                                                >
                                                                    ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </>
                                    )}
                                </div>
                            </div>
                        );
                    })()}

                    {showScanner && (
                        <div className="modal-overlay" onClick={() => stopScanner()}>
                            <div className="modal-box" onClick={(e) => e.stopPropagation()}>
                                <button className="modal-close" onClick={() => stopScanner()}>√ó</button>
                                <h2 style={{marginBottom: '1rem'}}>üì∑ ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ</h2>
                                
                                {scannerError ? (
                                    <div style={{background: '#ffebee', color: '#c62828', padding: '1rem', borderRadius: '8px', marginBottom: '1rem'}}>
                                        ‚ö†Ô∏è {scannerError}
                                    </div>
                                ) : (
                                    <>
                                        <div className="scanner-container">
                                            <video 
                                                id="scanner-video" 
                                                className="scanner-video"
                                                autoPlay
                                                playsInline
                                            ></video>
                                            {isScanning && (
                                                <div className="scanner-overlay">
                                                    <div className="scanner-line"></div>
                                                </div>
                                            )}
                                        </div>
                                        <div className="scanner-hint">
                                            {isScanning ? (
                                                <>
                                                    üéØ Ÿàÿ¨ŸëŸá ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß ŸÜÿ≠Ÿà ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ<br/>
                                                    ÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ∂Ÿàÿ≠ ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ ŸÅŸä ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿ£ÿÆÿ∂ÿ±
                                                </>
                                            ) : (
                                                '‚è≥ ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨...'
                                            )}
                                        </div>
                                        <div style={{marginTop: '1.5rem', display: 'flex', gap: '1rem', justifyContent: 'center'}}>
                                            <button className="btn btn-secondary" onClick={() => stopScanner()}>
                                                ÿ•ŸÑÿ∫ÿßÿ°
                                            </button>
                                            <button className="btn btn-primary" onClick={manualBarcodeEntry}>
                                                ‚å®Ô∏è ÿ•ÿØÿÆÿßŸÑ ŸäÿØŸàŸä
                                            </button>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    {showTrackingModal && (
                        <div className="modal-overlay" onClick={() => { setShowTrackingModal(false); setTrackingResult(null); setTrackingNumber(''); }}>
                            <div className="modal-box" onClick={(e) => e.stopPropagation()} style={{maxWidth: '700px'}}>
                                <button className="modal-close" onClick={() => { setShowTrackingModal(false); setTrackingResult(null); setTrackingNumber(''); }}>√ó</button>
                                <h2 style={{marginBottom: '1.5rem', color: '#1a237e'}}>üì¶ ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ¥ÿ≠ŸÜÿ©</h2>
                                
                                <div style={{marginBottom: '1.5rem'}}>
                                    <div style={{display: 'flex', gap: '1rem'}}>
                                        <input 
                                            type="text"
                                            value={trackingNumber}
                                            onChange={(e) => setTrackingNumber(e.target.value)}
                                            placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ (ŸÖÿ´ÿßŸÑ: TRK-1234567890)"
                                            style={{flex: 1, padding: '1rem', border: '2px solid #ddd', borderRadius: '8px', fontSize: '1rem'}}
                                            onKeyPress={(e) => e.key === 'Enter' && trackOrder()}
                                        />
                                        <button className="btn btn-primary" onClick={trackOrder} style={{padding: '1rem 2rem'}}>
                                            üîç ÿ™ÿ™ÿ®ÿπ
                                        </button>
                                    </div>
                                </div>
                                
                                {trackingResult && (
                                    <div>
                                        {trackingResult.mainOrderNumber && (() => {
                                            const relatedOrders = [...orders, ...archivedOrders].filter(o => 
                                                o.mainOrderNumber === trackingResult.mainOrderNumber && o.id !== trackingResult.id
                                            );
                                            return relatedOrders.length > 0 && (
                                                <div style={{background: '#fff3e0', padding: '1rem', borderRadius: '8px', marginBottom: '1rem', border: '2px solid #f57c00'}}>
                                                    <h4 style={{color: '#e65100', marginBottom: '0.5rem'}}>üì¶ ÿ∑ŸÑÿ® ŸÖŸÇÿ≥ŸÖ ({relatedOrders.length + 1} ÿ£ÿ¨ÿ≤ÿßÿ°)</h4>
                                                    <p style={{fontSize: '0.9rem', color: '#666', marginBottom: '0.5rem'}}>
                                                        Ÿáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ® ÿ™ŸÖ ÿ™ŸÇÿ≥ŸäŸÖŸá ŸÑÿπÿØÿ© ŸÖŸàÿ±ÿØŸäŸÜ. ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ£ÿÆÿ±Ÿâ:
                                                    </p>
                                                    {relatedOrders.map((ro, i) => (
                                                        <div key={ro.id} style={{fontSize: '0.85rem', color: '#666', paddingRight: '1rem'}}>
                                                            ‚Ä¢ {ro.trackingNumber} - {ro.total.toLocaleString()} ÿØ.ÿπ
                                                        </div>
                                                    ))}
                                                </div>
                                            );
                                        })()}
                                        
                                        <div style={{background: '#e3f2fd', padding: '1.5rem', borderRadius: '12px', marginBottom: '1.5rem'}}>
                                            <h3 style={{marginBottom: '1rem', color: '#1976d2'}}>ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ∑ŸÑÿ®</h3>
                                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '0.5rem', fontSize: '0.95rem'}}>
                                                <div><strong>ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®:</strong> {trackingResult.orderNumber}</div>
                                                <div><strong>ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ:</strong> {trackingResult.trackingNumber}</div>
                                                <div><strong>ÿßŸÑŸÖÿ™ÿ¨ÿ±:</strong> {trackingResult.storeName}</div>
                                                <div><strong>ÿßŸÑŸáÿßÿ™ŸÅ:</strong> {trackingResult.phone}</div>
                                                <div style={{gridColumn: '1 / -1'}}><strong>ÿßŸÑÿπŸÜŸàÿßŸÜ:</strong> {trackingResult.address}</div>
                                                {trackingResult.latitude && trackingResult.longitude && (
                                                    <div style={{gridColumn: '1 / -1', background: '#fff', padding: '0.8rem', borderRadius: '6px', marginTop: '0.5rem'}}>
                                                        <strong style={{color: '#1976d2'}}>üìç ŸÖŸàŸÇÿπ ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ GPS:</strong>
                                                        <div style={{fontSize: '0.85rem', color: '#666', marginTop: '0.3rem'}}>
                                                            ÿÆÿ∑ ÿßŸÑÿπÿ±ÿ∂: {trackingResult.latitude.toFixed(6)} | 
                                                            ÿÆÿ∑ ÿßŸÑÿ∑ŸàŸÑ: {trackingResult.longitude.toFixed(6)}
                                                            {trackingResult.locationAccuracy && (
                                                                <> | ÿßŸÑÿØŸÇÿ©: ~{Math.round(trackingResult.locationAccuracy)} ŸÖÿ™ÿ±</>
                                                            )}
                                                        </div>
                                                        <a 
                                                            href={`https://www.google.com/maps?q=${trackingResult.latitude},${trackingResult.longitude}`}
                                                            target="_blank"
                                                            rel="noopener noreferrer"
                                                            style={{display: 'inline-block', marginTop: '0.5rem', color: '#1976d2', textDecoration: 'none', fontSize: '0.9rem'}}
                                                        >
                                                            üó∫Ô∏è ÿπÿ±ÿ∂ ÿπŸÑŸâ ÿÆÿ±ÿßÿ¶ÿ∑ Google ‚Üí
                                                        </a>
                                                    </div>
                                                )}
                                                <div><strong>ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ:</strong> {
                                                    trackingResult.deliveryMethod === 'express' ? 'ÿ™ŸàÿµŸäŸÑ ÿ≥ÿ±Ÿäÿπ' :
                                                    trackingResult.deliveryMethod === 'pickup' ? 'ÿßÿ≥ÿ™ŸÑÿßŸÖ ŸÖŸÜ ÿßŸÑŸÖÿ™ÿ¨ÿ±' :
                                                    'ÿ™ŸàÿµŸäŸÑ ÿπÿßÿØŸä'
                                                }</div>
                                                <div><strong>ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÉŸÑŸä:</strong> {trackingResult.total.toLocaleString()} ÿØ.ÿπ</div>
                                                {trackingResult.driverName && (
                                                    <div style={{gridColumn: '1 / -1'}}><strong>üöó ÿßŸÑÿ≥ÿßÿ¶ŸÇ:</strong> {trackingResult.driverName}</div>
                                                )}
                                            </div>
                                        </div>
                                        
                                        <h3 style={{marginBottom: '1rem', color: '#2e7d32'}}>ŸÖÿ±ÿßÿ≠ŸÑ ÿßŸÑÿ¥ÿ≠ŸÜÿ©</h3>
                                        <div style={{position: 'relative', paddingRight: '2rem'}}>
                                            <div style={{position: 'absolute', right: '0.75rem', top: '1rem', bottom: '1rem', width: '2px', background: '#ddd'}}></div>
                                            
                                            {trackingResult.trackingHistory && trackingResult.trackingHistory.length > 0 ? (
                                                trackingResult.trackingHistory.slice().reverse().map((item, index) => (
                                                    <div key={index} style={{position: 'relative', marginBottom: '1.5rem', paddingRight: '1rem'}}>
                                                        <div style={{
                                                            position: 'absolute',
                                                            right: '0.25rem',
                                                            top: '0.25rem',
                                                            width: '1rem',
                                                            height: '1rem',
                                                            borderRadius: '50%',
                                                            background: index === 0 ? '#4caf50' : '#2196f3',
                                                            border: '3px solid white',
                                                            boxShadow: '0 0 0 2px ' + (index === 0 ? '#4caf50' : '#2196f3')
                                                        }}></div>
                                                        
                                                        <div style={{
                                                            background: index === 0 ? '#e8f5e9' : 'white',
                                                            padding: '1rem',
                                                            borderRadius: '8px',
                                                            border: '1px solid ' + (index === 0 ? '#4caf50' : '#ddd')
                                                        }}>
                                                            <div style={{fontWeight: 'bold', color: index === 0 ? '#2e7d32' : '#333', marginBottom: '0.3rem'}}>
                                                                {item.note}
                                                            </div>
                                                            <div style={{fontSize: '0.85rem', color: '#666'}}>
                                                                {new Date(item.date).toLocaleString('ar-IQ')}
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))
                                            ) : (
                                                <div style={{textAlign: 'center', padding: '2rem', color: '#999'}}>
                                                    ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ÿ≠ÿØŸäÿ´ÿßÿ™ ŸÑŸÑÿ¥ÿ≠ŸÜÿ© ÿ≠ÿßŸÑŸäÿßŸã
                                                </div>
                                            )}
                                        </div>
                                        
                                        <div style={{marginTop: '1.5rem', padding: '1rem', background: '#fff3e0', borderRadius: '8px', textAlign: 'center'}}>
                                            <strong style={{color: '#f57c00'}}>ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©:</strong>{' '}
                                            <span style={{fontSize: '1.1rem', fontWeight: 'bold', color: '#e65100'}}>
                                                {getStatusNote(trackingResult.deliveryStatus || 'pending')}
                                            </span>
                                        </div>
                                    </div>
                                )}
                                
                                {trackingNumber && !trackingResult && (
                                    <div className="empty-state">
                                        <div className="empty-state-icon">üîç</div>
                                        <h3>ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑÿ¥ÿ≠ŸÜÿ©</h3>
                                        <p>ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ Ÿàÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {showOrderConfirmation && confirmedOrders.length > 0 && (
                        <div className="modal-overlay" onClick={() => setShowOrderConfirmation(false)}>
                            <div className="modal-box" onClick={(e) => e.stopPropagation()} style={{maxWidth: '600px'}}>
                                <button className="modal-close" onClick={() => setShowOrderConfirmation(false)}>√ó</button>
                                <div style={{textAlign: 'center', marginBottom: '1.5rem'}}>
                                    <div style={{fontSize: '4rem', marginBottom: '0.5rem'}}>‚úÖ</div>
                                    <h2 style={{color: '#2e7d32', marginBottom: '0.5rem'}}>ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠!</h2>
                                    <p style={{color: '#666'}}>ÿßÿ≠ŸÅÿ∏ ÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ∑ŸÑÿ® ŸàÿßŸÑÿ™ÿ™ÿ®ÿπ ŸÑŸÑŸÖÿ±ÿßÿ¨ÿπÿ©</p>
                                </div>

                                {confirmedOrders.length > 1 && (
                                    <div style={{background: '#fff3e0', padding: '1rem', borderRadius: '8px', marginBottom: '1.5rem', border: '2px solid #f57c00'}}>
                                        <p style={{color: '#e65100', marginBottom: '0.5rem', fontWeight: 'bold'}}>
                                            üì¶ ÿ™ŸÖ ÿ™ŸÇÿ≥ŸäŸÖ ÿ∑ŸÑÿ®ŸÉ ÿ•ŸÑŸâ {confirmedOrders.length} ÿ∑ŸÑÿ®ÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ
                                        </p>
                                        <p style={{color: '#666', fontSize: '0.9rem', margin: 0}}>
                                            ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä: <strong>{confirmedOrders[0].mainOrderNumber}</strong>
                                        </p>
                                    </div>
                                )}

                                <div style={{display: 'grid', gap: '1rem', marginBottom: '1.5rem'}}>
                                    {confirmedOrders.map((order, index) => (
                                        <div key={order.id} style={{background: '#f5f5f5', padding: '1.5rem', borderRadius: '12px', border: '1px solid #ddd'}}>
                                            {confirmedOrders.length > 1 && (
                                                <h4 style={{color: '#1976d2', marginBottom: '1rem'}}>ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑŸÅÿ±ÿπŸä {index + 1}</h4>
                                            )}
                                            
                                            <div style={{marginBottom: '1rem'}}>
                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem'}}>
                                                    <strong style={{color: '#666'}}>ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®:</strong>
                                                    <button 
                                                        className="btn btn-secondary"
                                                        onClick={() => {
                                                            const textarea = document.createElement('textarea');
                                                            textarea.value = order.orderNumber;
                                                            textarea.style.position = 'fixed';
                                                            textarea.style.opacity = '0';
                                                            document.body.appendChild(textarea);
                                                            textarea.select();
                                                            try {
                                                                document.execCommand('copy');
                                                                alert('‚úÖ ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®:\n\n' + order.orderNumber);
                                                            } catch (err) {
                                                                alert('ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®:\n' + order.orderNumber);
                                                            }
                                                            document.body.removeChild(textarea);
                                                        }}
                                                        style={{padding: '0.5rem 1rem', fontSize: '0.9rem'}}
                                                    >
                                                        üìã ŸÜÿ≥ÿÆ
                                                    </button>
                                                </div>
                                                <div style={{background: 'white', padding: '0.8rem', borderRadius: '6px', fontFamily: 'monospace', fontSize: '1.1rem', textAlign: 'center', fontWeight: 'bold'}}>
                                                    {order.orderNumber}
                                                </div>
                                            </div>

                                            <div>
                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem'}}>
                                                    <strong style={{color: '#666'}}>ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ:</strong>
                                                    <button 
                                                        className="btn btn-secondary"
                                                        onClick={() => {
                                                            const textarea = document.createElement('textarea');
                                                            textarea.value = order.trackingNumber;
                                                            textarea.style.position = 'fixed';
                                                            textarea.style.opacity = '0';
                                                            document.body.appendChild(textarea);
                                                            textarea.select();
                                                            try {
                                                                document.execCommand('copy');
                                                                alert('‚úÖ ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ:\n\n' + order.trackingNumber);
                                                            } catch (err) {
                                                                alert('ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ:\n' + order.trackingNumber);
                                                            }
                                                            document.body.removeChild(textarea);
                                                        }}
                                                        style={{padding: '0.5rem 1rem', fontSize: '0.9rem'}}
                                                    >
                                                        üìã ŸÜÿ≥ÿÆ
                                                    </button>
                                                </div>
                                                <div style={{background: 'white', padding: '0.8rem', borderRadius: '6px', fontFamily: 'monospace', fontSize: '1.1rem', textAlign: 'center', fontWeight: 'bold', color: '#1976d2'}}>
                                                    {order.trackingNumber}
                                                </div>
                                            </div>

                                            <div style={{marginTop: '1rem', padding: '0.8rem', background: '#e3f2fd', borderRadius: '6px', textAlign: 'center'}}>
                                                <strong>ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÉŸÑŸä:</strong> <span style={{fontSize: '1.2rem', color: '#2e7d32'}}>{order.total.toLocaleString()} ÿØ.ÿπ</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div style={{display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem'}}>
                                    <button 
                                        className="btn btn-primary"
                                        onClick={() => {
                                            const mainOrder = confirmedOrders[0];
                                            let content = '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
                                            content += '          ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®\n';
                                            content += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
                                            
                                            if (confirmedOrders.length > 1) {
                                                content += 'üì¶ ÿ∑ŸÑÿ® ŸÖŸÇÿ≥ŸÖ ÿ•ŸÑŸâ ' + confirmedOrders.length + ' ÿ∑ŸÑÿ®ÿßÿ™\n\n';
                                                content += 'ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä: ' + mainOrder.mainOrderNumber + '\n';
                                                const mainTracking = mainOrder.trackingNumber.split('-').slice(0, -1).join('-');
                                                if (mainTracking) {
                                                    content += 'ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä: ' + mainTracking + '\n\n';
                                                }
                                                content += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n';
                                            }
                                            
                                            confirmedOrders.forEach((order, index) => {
                                                if (confirmedOrders.length > 1) {
                                                    content += 'üîπ ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑŸÅÿ±ÿπŸä ' + (index + 1) + ':\n';
                                                }
                                                content += 'ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®: ' + order.orderNumber + '\n';
                                                content += 'ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ: ' + order.trackingNumber + '\n';
                                                content += 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ™ÿ¨ÿ±: ' + order.storeName + '\n';
                                                content += 'ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ: ' + order.ownerName + '\n';
                                                content += 'ÿßŸÑŸáÿßÿ™ŸÅ: ' + order.phone + '\n';
                                                content += 'ÿßŸÑÿπŸÜŸàÿßŸÜ: ' + order.address + '\n';
                                                content += 'ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ: ' + (
                                                    order.deliveryMethod === 'express' ? 'ÿ™ŸàÿµŸäŸÑ ÿ≥ÿ±Ÿäÿπ' :
                                                    order.deliveryMethod === 'pickup' ? 'ÿßÿ≥ÿ™ŸÑÿßŸÖ ŸÖŸÜ ÿßŸÑŸÖÿ™ÿ¨ÿ±' :
                                                    'ÿ™ŸàÿµŸäŸÑ ÿπÿßÿØŸä'
                                                ) + '\n';
                                                content += 'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ: ' + new Date(order.date).toLocaleString('ar-IQ') + '\n\n';
                                                
                                                content += 'ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™:\n';
                                                order.items.forEach((item, i) => {
                                                    content += '  ' + (i + 1) + '. ' + item.name + ' √ó ' + item.qty + ' = ' + (item.price * item.qty).toLocaleString() + ' ÿØ.ÿπ\n';
                                                });
                                                content += '\nÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÅÿ±ÿπŸä: ' + order.subtotal.toLocaleString() + ' ÿØ.ÿπ\n';
                                                content += 'ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ: ' + order.deliveryFee.toLocaleString() + ' ÿØ.ÿπ\n';
                                                content += 'ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä: ' + order.total.toLocaleString() + ' ÿØ.ÿπ\n';
                                                
                                                if (index < confirmedOrders.length - 1) {
                                                    content += '\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n';
                                                }
                                            });
                                            
                                            content += '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
                                            content += 'ÿ¥ŸÉÿ±ÿßŸã ŸÑÿ™ÿ≥ŸàŸÇŸÉŸÖ ŸÖÿπŸÜÿß!\n';
                                            content += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
                                            
                                            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                                            const url = URL.createObjectURL(blob);
                                            const a = document.createElement('a');
                                            a.href = url;
                                            a.download = 'order-' + mainOrder.orderNumber + '.txt';
                                            document.body.appendChild(a);
                                            a.click();
                                            document.body.removeChild(a);
                                            URL.revokeObjectURL(url);
                                            alert('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÑŸÅ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®!');
                                        }}
                                    >
                                        üíæ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
                                    </button>
                                    <button 
                                        className="btn btn-primary"
                                        onClick={() => setShowOrderConfirmation(false)}
                                    >
                                        ‚úì ÿ™ŸÖ
                                    </button>
                                </div>

                                <div style={{marginTop: '1.5rem', padding: '1rem', background: '#e8f5e9', borderRadius: '8px', border: '1px solid #4caf50', textAlign: 'center'}}>
                                    <p style={{color: '#2e7d32', fontSize: '0.9rem', margin: 0}}>
                                        üí° ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ™ÿ®ÿπ ÿ∑ŸÑÿ®ŸÉ ŸÅŸä ÿ£Ÿä ŸàŸÇÿ™ ŸÖŸÜ ÿ≤ÿ± "üì¶ ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ¥ÿ≠ŸÜÿ©"
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
